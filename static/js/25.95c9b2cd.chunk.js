"use strict";(self.webpackChunkdemo_dapp_web3_onboard=self.webpackChunkdemo_dapp_web3_onboard||[]).push([[25],{25:function(e,t,n){n.r(t),n.d(t,{Wallet:function(){return ca},getWallet:function(){return da},initWallet:function(){return fa},sequence:function(){return _a}});var r={};n.r(r),n.d(r,{walletContracts:function(){return g}});var i={};n.r(i),n.d(i,{API:function(){return O},SequenceAPIClient:function(){return Z},SmartRampOrderStatus:function(){return C},SortOrder:function(){return E},WebRPCSchemaHash:function(){return _},WebRPCSchemaVersion:function(){return S},WebRPCVersion:function(){return I}});var a={};n.r(a),n.d(a,{AllowProvider:function(){return Je},CachedProvider:function(){return ze},ChainId:function(){return xe},EagerProvider:function(){return Ye},JsonRpcExternalProvider:function(){return Ke},JsonRpcRouter:function(){return Le},JsonRpcSender:function(){return Ve},JsonRpcVersion:function(){return Ue},PublicProvider:function(){return rt},SigningProvider:function(){return nt},allowProviderMiddleware:function(){return $e},checkNetworkConfig:function(){return Ae},createJsonRpcMiddlewareStack:function(){return Be},createNetworkConfig:function(){return Te},ensureUniqueNetworks:function(){return Oe},ensureValidNetworks:function(){return _e},exceptionProviderMiddleware:function(){return Qe},findNetworkConfig:function(){return Ze},getAuthNetwork:function(){return Ie},getChainId:function(){return Ce},isJsonRpcHandler:function(){return Ge},isJsonRpcProvider:function(){return Fe},isNetworkConfig:function(){return be},isValidNetworkConfig:function(){return Se},loggingProviderMiddleware:function(){return Xe},mainnetNetworks:function(){return De},maybeChainId:function(){return Ee},networkProviderMiddleware:function(){return et},networks:function(){return Re},networksIndex:function(){return Pe},sequenceContext:function(){return We},sortNetworks:function(){return Me},testnetNetworks:function(){return qe},updateNetworkConfig:function(){return Ne}});var s={};n.r(s),n.d(s,{Multicall:function(){return lt},providers:function(){return gt}});var o={};n.r(o),n.d(o,{ConfigFinder:function(){return At},SequenceUtilsFinder:function(){return Rt},SignatureType:function(){return Mt},WalletContractBytecode:function(){return vt},addressOf:function(){return It},buildStubSignature:function(){return $t},compareAddr:function(){return Nt},createWalletConfig:function(){return xt},decodeSignature:function(){return Bt},editConfig:function(){return Tt},encodeSignature:function(){return Vt},genConfig:function(){return Zt},imageHash:function(){return St},isConfigEqual:function(){return Ot},isDecodedAddress:function(){return Dt},isDecodedEOASigner:function(){return Wt},isDecodedEOASplitSigner:function(){return Ut},isDecodedFullSigner:function(){return Lt},isDecodedSigner:function(){return qt},isUsableConfig:function(){return Ct},isValidConfigSigners:function(){return Et},joinSignatures:function(){return jt},joinTwoSignatures:function(){return Ht},mutateSignature:function(){return Jt},recoverEOASigner:function(){return Gt},signerOf:function(){return Kt},sortConfig:function(){return _t},splitDecodedEOASigner:function(){return Ft}});var u={};n.r(u),n.d(u,{ContractType:function(){return Qt},EventLogDataType:function(){return en},EventLogType:function(){return Xt},Indexer:function(){return un},SequenceIndexerClient:function(){return fn},SequenceIndexerServices:function(){return on},SortOrder:function(){return nn},TxnTransferType:function(){return tn},WebRPCSchemaHash:function(){return sn},WebRPCSchemaVersion:function(){return an},WebRPCVersion:function(){return rn}});var c={};n.r(c),n.d(c,{ContractType:function(){return hn},Metadata:function(){return mn},SequenceMetadataClient:function(){return xn},SortOrder:function(){return gn},SwapType:function(){return pn},WebRPCSchemaHash:function(){return yn},WebRPCSchemaVersion:function(){return wn},WebRPCVersion:function(){return vn}});var l={};n.r(l),n.d(l,{MetaTransactionsType:function(){return _n},appendNonce:function(){return Gn},computeMetaTxnHash:function(){return An},decodeNonce:function(){return Kn},digestOfTransactions:function(){return Tn},digestOfTransactionsNonce:function(){return Zn},encodeNonce:function(){return Vn},flattenAuxTransactions:function(){return Rn},fromTransactionish:function(){return $n},hasSequenceTransactions:function(){return Ln},isAsyncSendable:function(){return Wn},isSequenceTransaction:function(){return Un},isSignedTransactions:function(){return Jn},makeAfterNonce:function(){return Hn},makeExpirable:function(){return jn},packMetaTransactionsData:function(){return On},packMetaTransactionsNonceData:function(){return Nn},readSequenceNonce:function(){return Bn},sequenceTxAbiEncode:function(){return Fn},toSequenceTransaction:function(){return Dn},toSequenceTransactions:function(){return Pn}});var f={};n.r(f),n.d(f,{BaseRelayer:function(){return ar},BaseRelayerDefaults:function(){return ir},LocalRelayer:function(){return gr},ProviderRelayer:function(){return cr},ProviderRelayerDefaults:function(){return or},RpcRelayer:function(){return xr},RpcRelayerProto:function(){return mr},isBaseRelayerOptions:function(){return rr},isLocalRelayerOptions:function(){return lr},isProviderRelayerOptions:function(){return ur},isRelayer:function(){return Er},isRpcRelayerOptions:function(){return br},proto:function(){return mr}});var d={};n.r(d),n.d(d,{AuthError:function(){return Qr},DEFAULT_SESSION_EXPIRATION:function(){return Vr},ErrAccountIsRequired:function(){return Xr},LONG_SESSION_EXPIRATION:function(){return Kr},Session:function(){return Jr},ValidateSequenceDeployedWalletProof:function(){return ei},ValidateSequenceUndeployedWalletProof:function(){return ti},signAuthorization:function(){return Yr}});var h={};n.r(h),n.d(h,{GuarddService:function(){return si},WebRPCSchemaHash:function(){return ai},WebRPCSchemaVersion:function(){return ii},WebRPCVersion:function(){return ri}});var p={};n.r(p),n.d(p,{BaseInjectedTransport:function(){return na},BaseProviderTransport:function(){return xi},BaseWalletTransport:function(){return Hi},CHANNEL_ID:function(){return Xi},DefaultProviderConfig:function(){return la},ErrSignedInRequired:function(){return yi},EventType:function(){return hi},ExtensionMessageHandler:function(){return ea},ExtensionMessageProvider:function(){return ta},InitState:function(){return gi},LocalStorage:function(){return Li},LocalStore:function(){return Gi},LocalWeb3Provider:function(){return _i},MuxMessageProvider:function(){return zi},OpenState:function(){return pi},PROVIDER_OPEN_TIMEOUT:function(){return mi},ProviderError:function(){return wi},ProxyMessageChannel:function(){return Vi},ProxyMessageChannelPort:function(){return Ki},ProxyMessageHandler:function(){return $i},ProxyMessageProvider:function(){return Ji},UnrealMessageHandler:function(){return oa},UnrealMessageProvider:function(){return sa},Wallet:function(){return ca},WalletRequestHandler:function(){return Ci},Web3Provider:function(){return Ii},Web3Signer:function(){return Oi},WindowMessageHandler:function(){return Qi},WindowMessageProvider:function(){return Yi},WindowSessionParams:function(){return vi},getWallet:function(){return da},initWallet:function(){return fa},isBrowserExtension:function(){return Wi},isSequenceProvider:function(){return Si},isValidMessageSignature:function(){return Ri},isValidSignature:function(){return Mi},isValidTypedDataSignature:function(){return Di},isWalletUpToDate:function(){return Ui},messageToBytes:function(){return Ai},nextMessageIdx:function(){return bi},prefixEIP191Message:function(){return Pi},recoverWalletConfig:function(){return qi}});var g={erc1271:Object.freeze({__proto__:null,abi:[{type:"function",name:"isValidSignature",constant:!0,inputs:[{type:"bytes32"},{type:"bytes"}],outputs:[{type:"bytes4"}],payable:!1,stateMutability:"view"}],returns:{isValidSignatureBytes32:"0x1626ba7e"}}),factory:Object.freeze({__proto__:null,abi:[{type:"function",name:"deploy",constant:!1,inputs:[{type:"address"},{type:"bytes32"}],outputs:[],payable:!0,stateMutability:"payable"}]}),mainModule:Object.freeze({__proto__:null,abi:[{type:"function",name:"nonce",constant:!0,inputs:[],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"readNonce",constant:!0,inputs:[{type:"uint256"}],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"updateImplementation",constant:!1,inputs:[{type:"address"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"selfExecute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"execute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"},{type:"uint256"},{type:"bytes"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"createContract",inputs:[{type:"bytes"}],payable:!0,stateMutability:"payable"}]}),mainModuleUpgradable:Object.freeze({__proto__:null,abi:[{type:"function",name:"updateImageHash",constant:!0,inputs:[{type:"bytes32"}],outputs:[],payable:!1,stateMutability:"view"},{type:"function",name:"imageHash",constant:!0,inputs:[],outputs:[{type:"bytes32"}],payable:!1,stateMutability:"view"}]}),sequenceUtils:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_mainModule",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"bytes32",name:"_imageHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"_threshold",type:"uint256"},{indexed:!1,internalType:"bytes",name:"_signers",type:"bytes"}],name:"RequiredConfig",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"address",name:"_signer",type:"address"}],name:"RequiredSigner",type:"event"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callBalanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_i",type:"uint256"}],name:"callBlockhash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"callChainId",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCode",outputs:[{internalType:"bytes",name:"code",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeHash",outputs:[{internalType:"bytes32",name:"codeHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeSize",outputs:[{internalType:"uint256",name:"size",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callCoinbase",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callDifficulty",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLeft",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLimit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callOrigin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"knownImageHashes",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"lastImageHashUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastSignerUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastWalletUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bool",name:"delegateCall",type:"bool"},{internalType:"bool",name:"revertOnError",type:"bool"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IModuleCalls.Transaction[]",name:"_txs",type:"tuple[]"}],name:"multiCall",outputs:[{internalType:"bool[]",name:"_successes",type:"bool[]"},{internalType:"bytes[]",name:"_results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_threshold",type:"uint256"},{components:[{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"address",name:"signer",type:"address"}],internalType:"struct RequireUtils.Member[]",name:"_members",type:"tuple[]"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishConfig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"uint256",name:"_sizeMembers",type:"uint256"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishInitialSigners",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_nonce",type:"uint256"}],name:"requireMinNonce",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_expiration",type:"uint256"}],name:"requireNonExpired",outputs:[],stateMutability:"view",type:"function"}]}),requireFreshSigner:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"",type:"address"}],name:"requireFreshSigner",outputs:[],stateMutability:"nonpayable",type:"function"}]})},v=n(136),w=n(3668),y=n(5671),m=n(3144),k=n(4255),b=n.n(k);function x(){return x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},x.apply(this,arguments)}var C,E,I="v1",S="v0.4.0",_="d026b8c7eb9ac3c9c5ed52994a34e2463c1aaa14";!function(e){e.UNKNOWN="UNKNOWN",e.RUNNING_CHECKS="RUNNING_CHECKS",e.PROCESSING="PROCESSING",e.FAILED="FAILED",e.COMPLETE="COMPLETE"}(C||(C={})),function(e){e.DESC="DESC",e.ASC="ASC"}(E||(E={}));var O=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/API/",this.ping=function(e){return r.fetch(r.url("Ping"),N({},e)).then((function(e){return T(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),N({},e)).then((function(e){return T(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),N({},e)).then((function(e){return T(e).then((function(e){return{status:e.status}}))}))},this.getSequenceContext=function(e){return r.fetch(r.url("GetSequenceContext"),N({},e)).then((function(e){return T(e).then((function(e){return{data:e.data}}))}))},this.getAuthToken=function(e,t){return r.fetch(r.url("GetAuthToken"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user}}))}))},this.sendPasswordlessLink=function(e,t){return r.fetch(r.url("SendPasswordlessLink"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status}}))}))},this.friendList=function(e,t){return r.fetch(r.url("FriendList"),N(e,t)).then((function(e){return T(e).then((function(e){return{page:e.page,friends:e.friends}}))}))},this.getFriendByAddress=function(e,t){return r.fetch(r.url("GetFriendByAddress"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status,friend:e.friend}}))}))},this.searchFriends=function(e,t){return r.fetch(r.url("SearchFriends"),N(e,t)).then((function(e){return T(e).then((function(e){return{friends:e.friends}}))}))},this.addFriend=function(e,t){return r.fetch(r.url("AddFriend"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status,friend:e.friend}}))}))},this.updateFriendNickname=function(e,t){return r.fetch(r.url("UpdateFriendNickname"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status,friend:e.friend}}))}))},this.removeFriend=function(e,t){return r.fetch(r.url("RemoveFriend"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status}}))}))},this.contractCall=function(e,t){return r.fetch(r.url("ContractCall"),N(e,t)).then((function(e){return T(e).then((function(e){return{returns:e.returns}}))}))},this.decodeContractCall=function(e,t){return r.fetch(r.url("DecodeContractCall"),N(e,t)).then((function(e){return T(e).then((function(e){return{call:e.call}}))}))},this.lookupContractCallSelectors=function(e,t){return r.fetch(r.url("LookupContractCallSelectors"),N(e,t)).then((function(e){return T(e).then((function(e){return{signatures:e.signatures}}))}))},this.userStorageFetch=function(e,t){return r.fetch(r.url("UserStorageFetch"),N(e,t)).then((function(e){return T(e).then((function(e){return{object:e.object}}))}))},this.userStorageSave=function(e,t){return r.fetch(r.url("UserStorageSave"),N(e,t)).then((function(e){return T(e).then((function(e){return{ok:e.ok}}))}))},this.userStorageDelete=function(e,t){return r.fetch(r.url("UserStorageDelete"),N(e,t)).then((function(e){return T(e).then((function(e){return{ok:e.ok}}))}))},this.userStorageFetchAll=function(e,t){return r.fetch(r.url("UserStorageFetchAll"),N(e,t)).then((function(e){return T(e).then((function(e){return{objects:e.objects}}))}))},this.getMoonpayLink=function(e,t){return r.fetch(r.url("GetMoonpayLink"),N(e,t)).then((function(e){return T(e).then((function(e){return{signedUrl:e.signedUrl}}))}))},this.isUsingGoogleMail=function(e,t){return r.fetch(r.url("IsUsingGoogleMail"),N(e,t)).then((function(e){return T(e).then((function(e){return{yes:e.yes}}))}))},this.isValidSignature=function(e,t){return r.fetch(r.url("IsValidSignature"),N(e,t)).then((function(e){return T(e).then((function(e){return{isValid:e.isValid}}))}))},this.isValidMessageSignature=function(e,t){return r.fetch(r.url("IsValidMessageSignature"),N(e,t)).then((function(e){return T(e).then((function(e){return{isValid:e.isValid}}))}))},this.isValidTypedDataSignature=function(e,t){return r.fetch(r.url("IsValidTypedDataSignature"),N(e,t)).then((function(e){return T(e).then((function(e){return{isValid:e.isValid}}))}))},this.isValidETHAuthProof=function(e,t){return r.fetch(r.url("IsValidETHAuthProof"),N(e,t)).then((function(e){return T(e).then((function(e){return{isValid:e.isValid}}))}))},this.getCoinPrices=function(e,t){return r.fetch(r.url("GetCoinPrices"),N(e,t)).then((function(e){return T(e).then((function(e){return{tokenPrices:e.tokenPrices}}))}))},this.getCollectiblePrices=function(e,t){return r.fetch(r.url("GetCollectiblePrices"),N(e,t)).then((function(e){return T(e).then((function(e){return{tokenPrices:e.tokenPrices}}))}))},this.getExchangeRate=function(e,t){return r.fetch(r.url("GetExchangeRate"),N(e,t)).then((function(e){return T(e).then((function(e){return{exchangeRate:e.exchangeRate}}))}))},this.listPayCardsOnFile=function(e){return r.fetch(r.url("ListPayCardsOnFile"),N({},e)).then((function(e){return T(e).then((function(e){return{payCards:e.payCards}}))}))},this.savePayCard=function(e,t){return r.fetch(r.url("SavePayCard"),N(e,t)).then((function(e){return T(e).then((function(e){return{ok:e.ok,payCard:e.payCard}}))}))},this.updatePayCardCVC=function(e,t){return r.fetch(r.url("UpdatePayCardCVC"),N(e,t)).then((function(e){return T(e).then((function(e){return{ok:e.ok}}))}))},this.deletePayCard=function(e,t){return r.fetch(r.url("DeletePayCard"),N(e,t)).then((function(e){return T(e).then((function(e){return{ok:e.ok}}))}))},this.smartRampQuote=function(e,t){return r.fetch(r.url("SmartRampQuote"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status,quoteDetails:e.quoteDetails}}))}))},this.smartRampPurchase=function(e,t){return r.fetch(r.url("SmartRampPurchase"),N(e,t)).then((function(e){return T(e).then((function(e){return{processing:e.processing,receipt:e.receipt}}))}))},this.smartRampWaitOrderConfirmation=function(e,t){return r.fetch(r.url("SmartRampWaitOrderConfirmation"),N(e,t)).then((function(e){return T(e).then((function(e){return{done:e.done,receipt:e.receipt}}))}))},this.smartRampGetOrder=function(e,t){return r.fetch(r.url("SmartRampGetOrder"),N(e,t)).then((function(e){return T(e).then((function(e){return{order:e.order}}))}))},this.smartRampCheckCardAuthorization=function(e,t){return r.fetch(r.url("SmartRampCheckCardAuthorization"),N(e,t)).then((function(e){return T(e).then((function(e){return{cardAuth:e.cardAuth}}))}))},this.smartRampSubmitCardAuthorization=function(e,t){return r.fetch(r.url("SmartRampSubmitCardAuthorization"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status}}))}))},this.smartRampOrdersList=function(e,t){return r.fetch(r.url("SmartRampOrdersList"),N(e,t)).then((function(e){return T(e).then((function(e){return{page:e.page,orders:e.orders}}))}))},this.getInviteInfo=function(e){return r.fetch(r.url("GetInviteInfo"),N({},e)).then((function(e){return T(e).then((function(e){return{inviteInfo:e.inviteInfo}}))}))},this.isValidAccessCode=function(e,t){return r.fetch(r.url("IsValidAccessCode"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status}}))}))},this.internalClaimAccessCode=function(e,t){return r.fetch(r.url("InternalClaimAccessCode"),N(e,t)).then((function(e){return T(e).then((function(e){return{status:e.status}}))}))},this.walletRecover=function(e,t){return r.fetch(r.url("WalletRecover"),N(e,t)).then((function(e){return T(e).then((function(e){return{encryptedWallet:e.encryptedWallet}}))}))},this.hostname=t,this.fetch=n}return(0,m.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:x({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},T=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},Z=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e.endsWith("/")?e.slice(0,-1):e,b())).jwtAuth=r,i._fetch=function(e,t){var n={};return i.jwtAuth&&i.jwtAuth.length>0&&(n.Authorization="BEARER ".concat(i.jwtAuth)),t.headers=x({},t.headers,n),b()(e,t)},i.fetch=i._fetch,i}return(0,m.Z)(n)}(O),A=n(8664),P=n(885),M=n(5647),R=n(2982),D=n(5861),q=n(7757),W=n.n(q),U=n(7169),L=n(4029),B=n(9716),F=n(8062),G=n(1420),j=n(5992),H=n(2876),V=n(8134),K=function(){return K=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},K.apply(this,arguments)};function J(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(t){a(t)}}function o(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))}function $(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(o){a=[6,o],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var z,Y=function(e){return j.E.hash(e.domain,e.types,e.message)},Q=function(){function e(e){this.prefix=ie,this.address=(null===e||void 0===e?void 0:e.address)?e.address.toLowerCase():"",this.claims=(null===e||void 0===e?void 0:e.claims)?e.claims:{app:"",iat:0,exp:0,v:re},this.signature=(null===e||void 0===e?void 0:e.signature)?e.signature:"",this.extra=(null===e||void 0===e?void 0:e.extra)?e.extra:""}return e.prototype.setIssuedAtNow=function(){this.claims.iat=Math.round((new Date).getTime()/1e3)},e.prototype.setExpiryIn=function(e){this.claims.exp=Math.round((new Date).getTime()/1e3)+e},e.prototype.validateClaims=function(){return X(this.claims)},e.prototype.messageDigest=function(){var e=this.validateClaims();if(e.err)throw e.err;return B.arrayify(Y(this.messageTypedData()))},e.prototype.messageTypedData=function(){var e={domain:K({},ae),types:{Claims:[]},message:{}};return this.claims.app&&this.claims.app.length>0&&(e.types.Claims.push({name:"app",type:"string"}),e.message.app=this.claims.app),this.claims.iat&&this.claims.iat>0&&(e.types.Claims.push({name:"iat",type:"int64"}),e.message.iat=this.claims.iat),this.claims.exp&&this.claims.exp>0&&(e.types.Claims.push({name:"exp",type:"int64"}),e.message.exp=this.claims.exp),this.claims.n&&this.claims.n>0&&(e.types.Claims.push({name:"n",type:"uint64"}),e.message.n=this.claims.n),this.claims.typ&&this.claims.typ.length>0&&(e.types.Claims.push({name:"typ",type:"string"}),e.message.typ=this.claims.typ),this.claims.ogn&&this.claims.ogn.length>0&&(e.types.Claims.push({name:"ogn",type:"string"}),e.message.ogn=this.claims.ogn),this.claims.v&&this.claims.v.length>0&&(e.types.Claims.push({name:"v",type:"string"}),e.message.v=this.claims.v),e},e}(),X=function(e){if(""===e.app)return{ok:!1,err:new Error("claims: app is empty")};var t=Math.round((new Date).getTime()/1e3),n=31536300;return""===e.v?{ok:!1,err:new Error("claims: ethauth version is empty")}:e.iat&&0!==e.iat&&(e.iat>t+300||e.iat<t-n)?{ok:!1,err:new Error("claims: iat is invalid")}:e.exp<t-300||e.exp>t+n?{ok:!1,err:new Error("claims: token has expired")}:{ok:!0}},ee=function(e,t,n){return J(void 0,void 0,void 0,(function(){var e,t;return $(this,(function(r){return e=n.messageDigest(),"0x"===(t=H.verifyMessage(e,n.signature)).slice(0,2)&&42===t.length&&t.toLowerCase()===n.address.toLowerCase()?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}))}))},te=function(e,t,n){return J(void 0,void 0,void 0,(function(){var t,r,i;return $(this,(function(a){switch(a.label){case 0:return e&&void 0!==e?(t=n.messageDigest(),[4,e.getCode(n.address)]):[2,{isValid:!1}];case 1:if("0x"===(r=a.sent())||r.length<=2)throw new Error("ValidateContractAccountProof failed. unable to fetch wallet contract code");return i=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],[4,new L.CH(n.address,i,e).isValidSignature(t,B.arrayify(n.signature))];case 2:return a.sent()===ne?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}}))}))},ne="0x1626ba7e",re="1",ie="eth",ae={name:"ETHAuth",version:re},se=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.configJsonRpcProvider=function(t){return J(e,void 0,void 0,(function(){var e;return $(this,(function(n){switch(n.label){case 0:return this.provider=new G.r(t),[4,this.provider.send("net_version",[])];case 1:if(e=n.sent(),this.chainId=parseInt(e),!this.chainId||0===this.chainId||NaN===this.chainId)throw new Error("ethauth: unable to get chainId");return this.ethereumJsonRpcURL=t,[2]}}))}))},this.configValidators=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0==t.length)throw new Error("validators list is empty");e.validators=t},this.encodeProof=function(t,n){return void 0===n&&(n=!1),J(e,void 0,void 0,(function(){var e,r;return $(this,(function(i){switch(i.label){case 0:if(42!==t.address.length||"0x"!==t.address.slice(0,2))throw new Error("ethauth: invalid address");if(""===t.signature||"0x"!==t.signature.slice(0,2))throw new Error("ethauth: invalid signature");if(t.extra&&"0x"!==t.extra.slice(0,2))throw new Error("ethauth: invalid extra encoding, expecting hex data");return[4,this.validateProof(t,n)];case 1:if(!i.sent())throw new Error("ethauth: proof is invalid");return e=JSON.stringify(t.claims),r=ie+"."+t.address.toLowerCase()+"."+V.DS.encode(e,!0)+"."+t.signature,t.extra&&t.extra.length>0&&(r+="."+t.extra),[2,r]}}))}))},this.decodeProof=function(t,n){return void 0===n&&(n=!1),J(e,void 0,void 0,(function(){var e,r,i,a,s,o,u,c,l;return $(this,(function(f){switch(f.label){case 0:if((e=t.split(".")).length<4||e.length>5)throw new Error("ethauth: invalid proof string");if(r=e[0],i=e[1],a=e[2],s=e[3],o=e[4],r!==ie)throw new Error("ethauth: not an ethauth proof");return u=V.DS.decode(a),c=JSON.parse(u),l=new Q({address:i,claims:c,signature:s,extra:o}),[4,this.validateProof(l,n)];case 1:if(!f.sent())throw new Error("ethauth: proof is invalid");return[2,l]}}))}))},this.validateProof=function(t,n){return void 0===n&&(n=!1),J(e,void 0,void 0,(function(){var e;return $(this,(function(r){switch(r.label){case 0:if((e=this.validateProofClaims(t)).err)throw new Error("ethauth: proof claims are invalid ".concat(e.err));return!0===n?[3,2]:[4,this.validateProofSignature(t)];case 1:if(!0!==r.sent())throw new Error("ethauth: proof signature is invalid");r.label=2;case 2:return[2,!0]}}))}))},this.validateProofSignature=function(t){return J(e,void 0,void 0,(function(){var e,n,r;return $(this,(function(i){switch(i.label){case 0:e=[],r=0,i.label=1;case 1:if(!(r<this.validators.length))return[3,6];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,(0,this.validators[r])(this.provider,this.chainId,t)];case 3:return!0===(n=i.sent().isValid)?[2,!0]:(e.push(n),[3,5]);case 4:return i.sent(),e.push(!1),[3,5];case 5:return r++,[3,1];case 6:for(r=0;r<e.length;r++)if(e[r])return[2,!0];return[2,!1]}}))}))},this.validateProofClaims=function(e){return e.validateClaims()},0==t.length?this.validators=[ee,te]:this.validators=t},oe=n(8408),ue=n(2257),ce=n(7419),le=n(4530),fe=n(5054),de=n(5452),he=n(5422),pe=n(4867),ge=n(9894),ve=n(7326),we=n(7303),ye=n(4069),me=n(4942);function ke(){return ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ke.apply(this,arguments)}function be(e){return e&&void 0!==e.chainId&&void 0!==e.name&&void 0!==e.rpcUrl&&void 0!==e.relayer}var xe,Ce=function(e){return"number"===typeof e?e:e.chainId?e.chainId:ue.O$.from(e).toNumber()},Ee=function(e){if(e)return Ce(e)},Ie=function(e){return e.find((function(e){return e.isAuthChain}))},Se=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)throw new Error("invalid network config: empty config");var r=[];if(Array.isArray(e)?r.push.apply(r,(0,R.Z)(e)):r.push(e),0===r.length){if(t)throw new Error("invalid network config: empty config");return!1}var i=r.map((function(e){return e.chainId})).sort(),a=i.filter((function(e,t){return i.indexOf(e)!==t}));if(a.length>0){if(t)throw new Error("invalid network config: duplicate chainIds ".concat(a));return!1}r.forEach((function(e){return e.name=e.name.toLowerCase()}));var s=r.map((function(e){return e.name})).sort(),o=s.filter((function(e,t){return s.indexOf(e)!==t}));if(o.length>0){if(t)throw new Error("invalid network config: duplicate network names ".concat(o));return!1}for(var u=!1,c=!1,l=0;l<r.length;l++){var f=r[l];if((!f.rpcUrl||""===f.rpcUrl)&&!f.provider){if(t)throw new Error("invalid network config for chainId ".concat(f.chainId,": rpcUrl or provider must be provided"));return!1}if(!n&&!f.relayer){if(t)throw new Error("invalid network config for chainId ".concat(f.chainId,": relayer must be provided"));return!1}if(f.isDefaultChain){if(u){if(t)throw new Error("invalid network config for chainId ".concat(f.chainId,": DefaultChain is already set by another config"));return!1}u=!0}if(f.isAuthChain){if(c&&t)throw new Error("invalid network config for chainId ".concat(f.chainId,": AuthChain is already set by another config"));c=!0}}if(!u){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!c){if(t)throw new Error("invalid network config: AuthChain must be set");return!1}return!0},_e=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Se(e,!0,t),e},Oe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.map((function(e){return e.chainId})).sort(),r=n.filter((function(e,t){return n.indexOf(e)!==t}));if(r.length>0){if(t)throw new Error("invalid network config: duplicate chainIds ".concat(r));return!1}return!0},Ne=function(e,t){if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer),e.ensAddress&&(t.ensAddress=e.ensAddress)}},Te=function(e,t,n){var r=[];if(r="function"===typeof e&&n?e(n):e,t){r.forEach((function(e){return e.isDefaultChain=!1}));var i=r.filter((function(e){return e.chainId===t}));if(!i||0===i.length)throw new Error("defaultChainId ".concat(t," cannot be found in network list"));i[0].isDefaultChain=!0}return _e(Me(r))},Ze=function(e,t){if("string"===typeof t){if(t.startsWith("0x")){var n=ue.O$.from(t).toNumber();return e.find((function(e){return e.chainId===n}))}return e.find((function(e){return e.name===t}))}return"number"===typeof t?e.find((function(e){return e.chainId===t})):t.chainId?e.find((function(e){return e.chainId===t.chainId})):void 0},Ae=function(e,t){return!!e&&(e.name===t||e.chainId===t)},Pe=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].name]=e[n];return t},Me=function(e){if(!e)return[];var t=e.sort((function(e,t){return e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1})),n=t.findIndex((function(e){return e.isDefaultChain}));n>0&&t.splice(0,0,t.splice(n,1)[0]);var r=t.findIndex((function(e){return e.isAuthChain&&!0!==e.isDefaultChain}));return r>0&&t.splice(1,0,t.splice(r,1)[0]),t};!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_TESTNET=421611]="ARBITRUM_TESTNET",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET"}(xe||(xe={}));var Re=(z={},(0,me.Z)(z,xe.MAINNET,{chainId:xe.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"}}),(0,me.Z)(z,xe.ROPSTEN,{chainId:xe.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"}}),(0,me.Z)(z,xe.RINKEBY,{chainId:xe.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"}}),(0,me.Z)(z,xe.GOERLI,{chainId:xe.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"}}),(0,me.Z)(z,xe.KOVAN,{chainId:xe.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}}),(0,me.Z)(z,xe.POLYGON,{chainId:xe.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}}),(0,me.Z)(z,xe.POLYGON_MUMBAI,{chainId:xe.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}}),(0,me.Z)(z,xe.BSC,{chainId:xe.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}}),(0,me.Z)(z,xe.BSC_TESTNET,{chainId:xe.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}}),(0,me.Z)(z,xe.OPTIMISM,{chainId:xe.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}}),(0,me.Z)(z,xe.OPTIMISM_TESTNET,{chainId:xe.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}}),(0,me.Z)(z,xe.ARBITRUM,{chainId:xe.ARBITRUM,name:"arbitrum",title:"Arbitrum",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}}),(0,me.Z)(z,xe.ARBITRUM_TESTNET,{chainId:xe.ARBITRUM_TESTNET,name:"arbitrum-testnet",title:"Arbitrum Testnet",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}}),(0,me.Z)(z,xe.AVALANCHE,{chainId:xe.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}}),(0,me.Z)(z,xe.AVALANCHE_TESTNET,{chainId:xe.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}}),(0,me.Z)(z,xe.FANTOM,{chainId:xe.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}}),(0,me.Z)(z,xe.FANTOM_TESTNET,{chainId:xe.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}}),(0,me.Z)(z,xe.GNOSIS,{chainId:xe.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}}),(0,me.Z)(z,xe.AURORA,{chainId:xe.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}}),(0,me.Z)(z,xe.AURORA_TESTNET,{chainId:xe.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}}),z),De=Te((function(e){return[ke({},Re[xe.MAINNET],{ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",rpcUrl:(0,ge.urlClean)("".concat(e.baseRpcUrl,"/mainnet")),relayer:{url:(0,ge.urlClean)("".concat(e.baseRelayerUrl,"/mainnet"))},isDefaultChain:!0}),ke({},Re[xe.POLYGON],{rpcUrl:"https://rpc-mainnet.matic.network",relayer:{url:(0,ge.urlClean)("".concat(e.baseRelayerUrl,"/matic"))},isAuthChain:!0})]}),1,{baseRpcUrl:"https://nodes.sequence.app",baseRelayerUrl:"https://relayers.sequence.app"}),qe=Te((function(e){return[ke({},Re[xe.RINKEBY],{ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",rpcUrl:(0,ge.urlClean)("".concat(e.baseRpcUrl,"/rinkeby")),relayer:{url:(0,ge.urlClean)("".concat(e.baseRelayerUrl,"/rinkeby"))},isDefaultChain:!0}),ke({},Re[xe.GOERLI],{ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",rpcUrl:(0,ge.urlClean)("".concat(e.baseRpcUrl,"/goerli")),relayer:{url:(0,ge.urlClean)("".concat(e.baseRelayerUrl,"/goerli"))},isAuthChain:!0})]}),void 0,{baseRpcUrl:"https://nodes.sequence.app",baseRelayerUrl:"https://relayers.sequence.app"}),We={factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}},Ue="2.0",Le=function(){function e(t,n){(0,y.Z)(this,e),this.sender=void 0,this.handler=void 0,this.sender=n,t&&this.setMiddleware(t)}return(0,m.Z)(e,[{key:"setMiddleware",value:function(e){this.handler=Be(e,this.sender.sendAsync)}},{key:"sendAsync",value:function(e,t,n){try{this.handler(e,t,n)}catch(r){t(r,void 0)}}}]),e}(),Be=function(e,t){if(0===e.length)return t;var n,r=function(e){return e.sendAsyncMiddleware?e.sendAsyncMiddleware:e};n=r(e[e.length-1])(t);for(var i=e.length-2;i>=0;i--)n=r(e[i])(n);return n};function Fe(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}function Ge(e){return void 0!==e&&void 0!==e.sendAsync}var je,He=0,Ve=(0,m.Z)((function e(t,n){var r=this;(0,y.Z)(this,e),this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=function(e,t,n){r.send(e.method,e.params,n||r.defaultChainId).then((function(n){t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((function(e){t(e,void 0)}))},this.defaultChainId=n,Fe(t)?this.send=t.send.bind(t):Ge(t)?this.send=function(e,n,i){return new Promise((function(a,s){t.sendAsync({jsonrpc:Ue,id:++He,method:e,params:n},(function(e,t){e?s(e):a(t?t.result:void 0)}),i||r.defaultChainId)}))}:this.send=t,this.request=function(e,t){return r.send(e.method,e.params,t)}})),Ke=(0,m.Z)((function e(t){var n=this;(0,y.Z)(this,e),this.provider=t,this.sendAsync=function(e,t){n.provider.send(e.method,e.params).then((function(n){t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((function(e){t(e,void 0)}))},this.send=this.sendAsync})),Je=function(){function e(t){(0,y.Z)(this,e),this.sendAsyncMiddleware=void 0,this.isAllowedFunc=void 0,this.isAllowedFunc=t||function(e){return!0},this.sendAsyncMiddleware=$e(this.isAllowedFunc)}return(0,m.Z)(e,[{key:"setIsAllowedFunc",value:function(e){this.isAllowedFunc=e,this.sendAsyncMiddleware=$e(this.isAllowedFunc)}}]),e}(),$e=function(e){return function(t){return function(n,r,i){if(!e(n))throw new Error("allowProvider middleware precondition is unmet.");t(n,r,i)}}},ze=function(){function e(t){var n=this;(0,y.Z)(this,e),this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cache=void 0,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=function(e){return function(t,r,i){if(n.cachableJsonRpcMethods.includes(t.method)){var a=n.cacheKey(t.method,t.params,i||n.defaultChainId),s=n.getCacheValue(a);if(s&&""!==s)return void r(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,(function(e,i,a){if(n.cachableJsonRpcMethods.includes(t.method)&&i&&i.result){var s=n.cacheKey(t.method,t.params,a||n.defaultChainId);n.setCacheValue(s,i.result)}r(e,i)}),i||n.defaultChainId)}},this.cacheKey=function(e,t,n){var r="";return r=n?"".concat(n,":").concat(e,":"):":".concat(e,":"),t&&0!==t.length?r+JSON.stringify(t):r+"[]"},this.getCache=function(){return n.cache},this.setCache=function(e){n.cache=e,n.onUpdateCallback&&n.onUpdateCallback()},this.getCacheValue=function(e){return n.cache[e]},this.setCacheValue=function(e,t){n.cache[e]=t,n.onUpdateCallback&&n.onUpdateCallback(e,t)},this.clearCache=function(){n.cache={}},this.cache={},this.defaultChainId=t}return(0,m.Z)(e,[{key:"onUpdate",value:function(e){this.onUpdateCallback=e}}]),e}(),Ye=(0,m.Z)((function e(t){var n=this;(0,y.Z)(this,e),this.props=void 0,this.sendAsyncMiddleware=function(e){return function(t,r,i){var a=t.id;switch(t.method){case"net_version":if(n.props.chainId)return void r(void 0,{jsonrpc:"2.0",id:a,result:"".concat(n.props.chainId)});break;case"eth_chainId":if(n.props.chainId)return void r(void 0,{jsonrpc:"2.0",id:a,result:B.hexlify(n.props.chainId)});break;case"eth_accounts":if(n.props.accountAddress)return void r(void 0,{jsonrpc:"2.0",id:a,result:[ce.getAddress(n.props.accountAddress)]});break;case"sequence_getWalletContext":if(n.props.walletContext)return void r(void 0,{jsonrpc:"2.0",id:a,result:n.props.walletContext})}e(t,r,i)}},this.props=t})),Qe=function(e){return function(t,n,r){e(t,(function(e,t){if(!e&&t&&t.error)throw"string"===typeof t.error?new Error(t.error):new Error(t.error.message);n(e,t)}),r)}},Xe=function(e){return function(t,n,r){var i=r?" chainId:".concat(r):"";ge.logger.info("[provider request]".concat(i," id:").concat(t.id," method:").concat(t.method," params:"),t.params),e(t,(function(e,r){e?ge.logger.warn("[provider response]".concat(i," id:").concat(t.id," method:").concat(t.method," params:"),t.params,"error:",e):ge.logger.info("[provider response]".concat(i," id:").concat(t.id," method:").concat(t.method," params:"),t.params,"response:",r),n(e,r)}),r)}},et=function(e){return function(t){return function(n,r,i){var a=e(n),s=n.id;switch(n.method){case"net_version":return void r(void 0,{jsonrpc:"2.0",id:s,result:"".concat(a)});case"eth_chainId":return void r(void 0,{jsonrpc:"2.0",id:s,result:B.hexlify(a)})}t(n,r,i)}}},tt=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_estimateGasLimits","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],nt=(0,m.Z)((function e(t){var n=this;(0,y.Z)(this,e),this.provider=void 0,this.sendAsyncMiddleware=function(e){return function(t,r,i){tt.includes(t.method)?n.provider.sendAsync(t,r,i):e(t,r,i)}},this.provider=t})),rt=function(){function e(t){var n=this;(0,y.Z)(this,e),this.privateJsonRpcMethods=["net_version","eth_chainId","eth_accounts"].concat(tt),this.provider=void 0,this.rpcUrl=void 0,this.sendAsyncMiddleware=function(e){return function(t,r){!n.provider||n.privateJsonRpcMethods.includes(t.method)?(ge.logger.debug("[public-provider] sending request to signer window",t.method),e(t,r)):n.provider.send(t.method,t.params).then((function(e){r(void 0,{jsonrpc:"2.0",id:t.id,result:e})})).catch((function(e){return r(e)}))}},t&&this.setRpcUrl(t)}return(0,m.Z)(e,[{key:"getRpcUrl",value:function(){return this.rpcUrl}},{key:"setRpcUrl",value:function(e){e&&""!==e?(this.rpcUrl=e,this.provider=new G.r(e)):(this.rpcUrl=void 0,this.provider=void 0)}}]),e}();function it(){return it=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},it.apply(this,arguments)}function at(e,t){return st.apply(this,arguments)}function st(){return(st=(0,D.Z)(W().mark((function e(t,n){var r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),r=n instanceof Function?n(e.t0):n,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function ot(e,t){return e.reduce((function(e,n,r){return t(n,r)?e[0].push(n):e[1].push(n),e}),[[],[]])}function ut(e){if(void 0===e)return"latest";switch(e){case"earliest":case"latest":case"pending":return e}return ue.O$.from(e)}!function(e){e.ethCall="eth_call",e.ethGetBalance="eth_getBalance",e.ethGetCode="eth_getCode"}(je||(je={}));var ct={batchSize:50,timeWindow:50,contract:We.sequenceUtils,verbose:!1},lt=function(){function e(t){var n=this;(0,y.Z)(this,e);var r=this;if(this.batchableJsonRpcMethods=[je.ethCall,je.ethGetCode,je.ethGetBalance],this.multicallInterface=new we.vU(g.sequenceUtils.abi),this.options=void 0,this.timeout=void 0,this.queue=[],this.scheduleExecution=function(){n.queue.length>0&&(n.timeout&&clearTimeout(n.timeout),n.timeout=setTimeout(n.run,n.options.timeWindow))},this.handle=function(e,t,r){return n.batchableJsonRpcMethods.find((function(e){return e===t.method}))?(n.queue.push({request:t,callback:r,next:e}),n.options.verbose&&console.log("Scheduling call",t.method),void n.scheduleExecution()):(n.options.verbose&&console.log("Forwarded call",t.method),e(t,r))},this.run=(0,D.Z)(W().mark((function e(){var t,n,i,a,s,o,u,c,l,f,d,h,p,g;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.options.verbose&&console.log("Processing multicall"),0!==(t=Math.min(r.options.batchSize,r.queue.length))){e.next=4;break}return e.abrupt("return");case 4:if(1!==t){e.next=9;break}return r.forward(r.queue[0]),r.queue=[],r.options.verbose&&console.log("Skip multicall, single item"),e.abrupt("return");case 9:if(r.options.verbose&&console.log("Resolving",t),n=r.queue.slice(0,t),r.queue=t===r.queue.length?[]:r.queue.slice(t),r.options.verbose&&console.log("Updated queue",r.queue.length),0!==r.queue.length&&r.scheduleExecution(),i=n[0].next,s=ot(n,(function(e){try{if(e.next!==i)return!1;switch(e.request.method){case je.ethCall:if(e.request.params[0].from||e.request.params[0].gasPrice||e.request.params[0].value)return!1;case je.ethGetBalance:case je.ethGetCode:var t=ut(e.request.params[1]);if(void 0===a&&(a=t),(n=t)!==(r=a)&&!(ue.O$.isBigNumber(n)?ue.O$.isBigNumber(r)&&n.eq(r):!ue.O$.isBigNumber(r)&&n===r))return!1}return!0}catch(s){return!1}var n,r})),o=(0,P.Z)(s,2),n=o[0],0===(u=o[1]).length){e.next=21;break}if(r.options.verbose&&console.log("Forwarding incompatible calls",u.length),r.forward(u),0!==n.length){e.next=21;break}return e.abrupt("return");case 21:if(c=n.map((function(e){try{switch(e.request.method){case je.ethCall:return{delegateCall:!1,revertOnError:!1,target:e.request.params[0].to,data:e.request.params[0].data,gasLimit:e.request.params[0].gas?e.request.params[0].gas:0,value:0};case je.ethGetCode:return{delegateCall:!1,revertOnError:!1,target:r.options.contract,gasLimit:0,value:0,data:r.multicallInterface.encodeFunctionData(r.multicallInterface.getFunction("callCode"),[e.request.params[0]])};case je.ethGetBalance:return{delegateCall:!1,revertOnError:!1,target:r.options.contract,gasLimit:0,value:0,data:r.multicallInterface.encodeFunctionData(r.multicallInterface.getFunction("callBalanceOf"),[e.request.params[0]])};default:return null}}catch(t){return null}})),l=ot(n,(function(e,t){return void 0!==c[t]})),f=(0,P.Z)(l,2),n=f[0],u=f[1],c=c.filter((function(e){return e})),0===u.length){e.next=29;break}if(r.options.verbose&&console.log("Forwarding calls on error",u.length),r.forward(u),0!==n.length){e.next=29;break}return e.abrupt("return");case 29:e.prev=29,d=r.multicallInterface.encodeFunctionData(r.multicallInterface.getFunction("multiCall"),[c]),e.next=37;break;case 33:return e.prev=33,e.t0=e.catch(29),r.forward(n),e.abrupt("return");case 37:return h=(0,ge.getRandomInt)(),e.next=40,at((0,ge.promisify)(i)({id:h,jsonrpc:Ue,method:je.ethCall,params:[{to:r.options.contract,value:0,data:d},ue.O$.isBigNumber(a)?a.toNumber():a]}),(function(e){return{jsonrpc:Ue,id:h,result:void 0,error:e}}));case 40:if(!(p=e.sent).error){e.next=43;break}return e.abrupt("return",r.forward(n));case 43:e.prev=43,g=r.multicallInterface.decodeFunctionResult(r.multicallInterface.getFunction("multiCall"),p.result),e.next=51;break;case 47:return e.prev=47,e.t1=e.catch(43),r.forward(n),e.abrupt("return");case 51:r.options.verbose&&console.log("Got response for",n.length),n.forEach((function(e,t){if(g[0][t])switch(e.request.method){case je.ethCall:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:g[1][t]});break;case je.ethGetCode:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:fe.$.decode(["bytes"],g[1][t])[0]});break;case je.ethGetBalance:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:fe.$.decode(["uint256"],g[1][t])[0]})}else r.forward(e)}));case 53:case"end":return e.stop()}}),e,null,[[29,33],[43,47]])}))),this.options=t?it({},e.DefaultOptions,t):e.DefaultOptions,this.options.batchSize<=0)throw new Error("Invalid batch size of ".concat(this.options.batchSize))}return(0,m.Z)(e,[{key:"forward",value:function(e){Array.isArray(e)?e.forEach((function(e){return e.next(e.request,e.callback)})):e.next(e.request,e.callback)}}],[{key:"isMulticall",value:function(t){return t&&void 0!==t.handle&&void 0!==t.conf&&e.isMulticallOptions(t.options)}},{key:"isMulticallOptions",value:function(e){return void 0!==e&&void 0!==e.batchSize&&void 0!==e.timeWindow&&void 0!==e.contract}}]),e}();lt.DefaultOptions=it({},ct);var ft,dt=["getNetwork","getBlockNumber","getGasPrice","getTransactionCount","getStorageAt","sendTransaction","estimateGas","getBlock","getTransaction","getTransactionReceipt","getLogs","emit","litenerCount","addListener","removeListener","waitForTransaction","detectNetwork","getBlockWithTransactions"],ht=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){var i,a;return(0,y.Z)(this,n),i=t.call(this,e.getNetwork()),a=(0,ve.Z)(i),i.provider=e,i.multicall=void 0,i.listenerCount=i.provider.listenerCount,i.getResolver=function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=a.provider).getResolver){e.next=12;break}return e.t0=n,e.next=5,t;case 5:return e.t1=e.sent,e.next=8,e.t0.getResolver.call(e.t0,e.t1);case 8:if(r=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",new ye.H2(a,r.address,r.name));case 12:return e.t2=n,e.next=15,t;case 15:return e.t3=e.sent,e.abrupt("return",e.t2.getResolver.call(e.t2,e.t3));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.next=function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.t0=t.method,e.next=e.t0===je.ethCall?4:e.t0===je.ethGetCode?12:e.t0===je.ethGetBalance?20:28;break;case 4:return e.t1=a,e.t2=t,e.t3=n,e.next=9,a.provider.call(t.params[0],t.params[1]);case 9:return e.t4=e.sent,e.t1.callback.call(e.t1,e.t2,e.t3,e.t4),e.abrupt("break",28);case 12:return e.t5=a,e.t6=t,e.t7=n,e.next=17,a.provider.getCode(t.params[0],t.params[1]);case 17:return e.t8=e.sent,e.t5.callback.call(e.t5,e.t6,e.t7,e.t8),e.abrupt("break",28);case 20:return e.t9=a,e.t10=t,e.t11=n,e.next=25,a.provider.getBalance(t.params[0],t.params[1]);case 25:return e.t12=e.sent,e.t9.callback.call(e.t9,e.t10,e.t11,e.t12),e.abrupt("break",28);case 28:e.next=33;break;case 30:e.prev=30,e.t13=e.catch(0),a.callback(t,n,void 0,e.t13);case 33:case"end":return e.stop()}}),e,null,[[0,30]])})));return function(t,n){return e.apply(this,arguments)}}(),i.multicall=lt.isMulticall(r)?r:new lt(r),dt.forEach((function(t){void 0!==e[t]&&(i[t]=function(){return e[t].apply(e,arguments)})})),i}return(0,m.Z)(n,[{key:"callback",value:function(e,t,n,r){t(r,{jsonrpc:Ue,id:e.id,result:n,error:r})}},{key:"call",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rpcCall(je.ethCall,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCode",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rpcCall(je.ethGetCode,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getBalance",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rpcCall(je.ethGetBalance,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"rpcCall",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=(0,ge.getRandomInt)(),r=o.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=o[a];return e.next=4,(0,ge.promisify)(this.multicall.handle)(this.next,{jsonrpc:Ue,id:n,method:t,params:i});case 4:return s=e.sent,e.abrupt("return",s.result);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ye.Zk),pt=function(){function e(t,n){var r=this;if((0,y.Z)(this,e),this.provider=t,this.multicall=void 0,this.multicall=lt.isMulticall(n)?n:new lt(n),t.send){var i=function(){var e=(0,D.Z)(W().mark((function e(n,r){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.send(n,r);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();this.send=function(e,t){r.multicall.handle(i,e,t)}}if(t.sendAsync){var a=function(){var e=(0,D.Z)(W().mark((function e(n,r){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.sendAsync(n,r);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();this.sendAsync=function(e,t){r.multicall.handle(a,e,t)}}}return(0,m.Z)(e,[{key:"isMetaMask",get:function(){return this.provider.isMetaMask}},{key:"isStatus",get:function(){return this.provider.isStatus}}]),e}(),gt=Object.freeze({__proto__:null,ProxyMethods:dt,MulticallProvider:ht,MulticallExternalProvider:pt,multicallMiddleware:function(e){return function(t){var n=lt.isMulticall(e)?e:new lt(e);return function(e,r){return n.handle(t,e,r)}}}}),vt="0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3",wt="@sequence.config.imageHashes",yt=function(e){return"@sequence.config.".concat(e)};try{ft=localStorage}catch(Oa){var mt=new Map;ft={getItem:function(e){var t;return null!=(t=mt.get(e))?t:null},setItem:function(e,t){return mt.set(e,t)},removeItem:function(e){return mt.delete(e)}}}function kt(e){var t,n=JSON.parse(null!=(t=ft.getItem(yt(e)))?t:"null");return n?(bt(e),n):void 0}function bt(e){var t,n=JSON.parse(null!=(t=ft.getItem(wt))?t:"[]");for((n=n.filter((function(t){return t!==e}))).push(e);n.length>10;)ft.removeItem(yt(n.shift()));ft.setItem(wt,JSON.stringify(n))}var xt=function(){var e=(0,D.Z)(W().mark((function e(t,n){var r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={threshold:t,signers:[]},n.forEach(function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.signers,e.t1=t.weight,!oe.E.isSigner(t.signer)){e.next=8;break}return e.next=5,t.signer.getAddress();case 5:e.t2=e.sent,e.next=9;break;case 8:e.t2=t.signer;case 9:e.t3=e.t2,e.t4={weight:e.t1,address:e.t3},e.t0.push.call(e.t0,e.t4);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ct(r)){e.next=4;break}throw new Error("wallet config is not usable");case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ct=function(e){return e.signers.reduce((function(e,t){return ue.O$.from(t.weight).add(e)}),he._Y).gte(ue.O$.from(e.threshold))},Et=function(e,t){if(0===t.length)return!0;var n=e.signers.map((function(e){return ce.getAddress(e.address)})),r=t.map((function(e){return ce.getAddress(e)})),i=!0;return r.forEach((function(e){n.includes(e)||(i=!1)})),i},It=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"===typeof t){var i=F.keccak256(le.pack(["bytes","bytes32"],[vt,B.hexZeroPad(n.mainModule,32)])),a=F.keccak256(le.pack(["bytes1","address","bytes32","bytes32"],["0xff",n.factory,t,i]));return ce.getAddress(B.hexDataSlice(a,12))}return t.address&&!r?t.address:e(St(t),n)},St=function(e){var t=(e=_t(e)).signers.reduce((function(e,t){return F.keccak256(fe.$.encode(["bytes32","uint8","address"],[e,t.weight,t.address]))}),le.pack(["uint256"],[e.threshold]));return function(e,t){ft.setItem(yt(e),JSON.stringify(t)),bt(e)}(t,e),t},_t=function(e){e.signers.sort((function(e,t){return Nt(e.address,t.address)})),e.signers.forEach((function(e){return e.address=ce.getAddress(e.address)})),e.address&&(e.address=ce.getAddress(e.address));var t=e.signers.map((function(e){return e.address}));if(t.filter((function(e,n){return t.indexOf(e)!==n})).length>0)throw new Error("invalid wallet config: duplicate signer addresses detected in the config, ${signerDupes}");return e},Ot=function(e,t){return St(e)===St(t)},Nt=function(e,t){var n=ue.O$.from(e),r=ue.O$.from(t);return n.lt(r)?-1:n.eq(r)?0:1};function Tt(e,t){var n,r=function(e){return{weight:ue.O$.from(e.weight).toNumber(),address:ce.getAddress(e.address)}},i=e.signers.map(r),a=t.set?t.set.map(r):[],s=t.del?t.del.map((function(e){return ce.getAddress(e.address)})):[],o=a.map((function(e){return e.address})),u=(n=i.filter((function(e){return-1===s.indexOf(e.address)&&-1===o.indexOf(e.address)}))).concat.apply(n,(0,R.Z)(a));return _t({address:e.address,threshold:t.threshold?ue.O$.from(t.threshold).toNumber():e.threshold,signers:u})}function Zt(e,t){return _t({threshold:ue.O$.from(e).toNumber(),signers:t.map((function(e){return{weight:ue.O$.from(e.weight).toNumber(),address:ce.getAddress(e.address)}}))})}var At=(0,m.Z)((function e(){(0,y.Z)(this,e),this.findCurrentConfig=void 0,this.findLastWalletOfInitialSigner=void 0}));function Pt(){return Pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Pt.apply(this,arguments)}var Mt,Rt=(0,m.Z)((function e(t){(0,y.Z)(this,e);var n=this;this.authProvider=t,this.findCurrentConfig=function(){var e=(0,D.Z)(W().mark((function e(t){var r,i,a,s,o,u,c,l,f,d,h,p,g;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.provider,i=t.context,a=t.ignoreIndex,s=t.requireIndex,o=t.skipCache,u=ce.getAddress(t.address),ge.logger.info("[findCurrentConfig] address:".concat(u,", ignoreIndex:").concat(a,", requireIndex:").concat(s)),!s||!a){e.next=5;break}throw Error("findCurrentConfig: can't ignore index and require index");case 5:return c=r.getNetwork(),l=t.knownConfigs?t.knownConfigs:[],e.next=9,n.findCurrentImageHash(i,r,u,l,o);case 9:if(f=e.sent,d=f.imageHash,h=f.config,void 0!==d){e.next=14;break}return e.abrupt("return",{config:void 0});case 14:return e.next=16,n.findConfigForImageHash(i,d,h?[h].concat((0,R.Z)(l)):l,o);case 16:return p=e.sent,e.next=19,c;case 19:return g=e.sent.chainId,e.abrupt("return",{config:p?Pt({},p,{chainId:g,address:u}):void 0});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.findLastWalletOfInitialSigner=function(){var e=(0,D.Z)(W().mark((function e(t){var r,i,a,s,o,u,c,l,f;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signer,i=t.context,a=t.ignoreIndex,s=t.requireIndex,ge.logger.info("[findLastWalletOfInitialSigner] signer:".concat(r)),!s||!a){e.next=4;break}throw Error("findCurrentConfig: can't ignore index and require index");case 4:if(o=new L.CH(i.sequenceUtils,g.sequenceUtils.abi,n.authProvider),!a){e.next=9;break}e.t0=0,e.next=12;break;case 9:return e.next=11,o.lastSignerUpdate(r);case 11:e.t0=e.sent.toNumber();case 12:if(u=e.t0,!s||0!==u){e.next=15;break}return e.abrupt("return",{wallet:void 0});case 15:return c=o.filters.RequiredSigner(null,r),e.next=18,n.findLatestLog(n.authProvider,Pt({},c,{fromBlock:u,toBlock:0!==u?u:"latest"}));case 18:if(void 0!==(l=e.sent)){e.next=22;break}return ge.logger.warn("publishConfig: wallet config last log not found"),e.abrupt("return",{wallet:void 0});case 22:return f=o.interface.decodeEventLog("RequiredSigner",l.data,l.topics),e.abrupt("return",{wallet:f._wallet});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.findConfigForImageHash=function(){var e=(0,D.Z)(W().mark((function e(t,r){var i,a,s,o,u,c,l,f,d,h,p,v=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=v.length>2&&void 0!==v[2]?v[2]:[],a=v.length>3&&void 0!==v[3]&&v[3],!(s=i.find((function(e){return St(e)===r})))){e.next=5;break}return e.abrupt("return",s);case 5:if(a){e.next=9;break}if(!(o=kt(r))){e.next=9;break}return e.abrupt("return",o);case 9:return ge.logger.info("[findConfigForImageHash] image:".concat(r)),u=new L.CH(t.sequenceUtils,g.sequenceUtils.abi,n.authProvider),e.next=13,u.lastImageHashUpdate(r);case 13:return c=e.sent.toNumber(),l=u.filters.RequiredConfig(void 0,r),e.next=17,n.findLatestLog(n.authProvider,Pt({},l,{fromBlock:c,toBlock:0!==c?c:"latest"}));case 17:if(void 0!==(f=e.sent)){e.next=20;break}return e.abrupt("return",void 0);case 20:return d=u.interface.decodeEventLog("RequiredConfig",f.data,f.topics),h=fe.$.decode(["tuple(\n        uint256 weight,\n        address signer\n      )[]"],d._signers)[0],p={threshold:ue.O$.from(d._threshold).toNumber(),signers:h.map((function(e){return{address:e.signer,weight:ue.O$.from(e.weight).toNumber()}}))},St(p),e.abrupt("return",p);case 25:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.findCurrentImageHash=function(){var e=(0,D.Z)(W().mark((function e(t,r,i){var a,s,o,u,c,l,f,d,h,p,v,w,y,m,k=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>3&&void 0!==k[3]?k[3]:[],s=k.length>4?k[4]:void 0,ge.logger.info("[findCurrentImageHash] address:".concat(i)),o=new L.CH(i,g.mainModuleUpgradable.abi,r),e.next=6,o.functions.imageHash.call([]).catch((function(){return[]}));case 6:if(void 0===(u=e.sent)[0]){e.next=9;break}return e.abrupt("return",{imageHash:u[0],config:s?void 0:kt(u[0])});case 9:if(c=ce.getAddress(i),!(l=a.find((function(e){return It(e,t,!0)===c})))){e.next=13;break}return e.abrupt("return",{imageHash:St(l),config:l});case 13:return f=new L.CH(t.sequenceUtils,g.sequenceUtils.abi,n.authProvider),e.next=16,f.knownImageHashes(i);case 16:if((d=e.sent)===pe.R){e.next=21;break}if(It(d,t)===i){e.next=20;break}throw Error("findCurrentImageHash: inconsistent RequireUtils results");case 20:return e.abrupt("return",{imageHash:d});case 21:return h=f.filters.RequiredConfig(i),e.next=24,n.findFirstLog(n.authProvider,h);case 24:if(void 0===(p=e.sent)){e.next=32;break}if(v=f.interface.decodeEventLog("RequiredConfig",p.data,p.topics),w=fe.$.decode(["tuple(\n          uint256 weight,\n          address signer\n        )[]"],v._signers)[0],y={threshold:ue.O$.from(v._threshold).toNumber(),signers:w.map((function(e){return{address:e.signer,weight:ue.O$.from(e.weight).toNumber()}}))},m=St(y),It(m,t)!==i){e.next=32;break}return e.abrupt("return",{imageHash:m,config:y});case 32:return e.abrupt("return",{});case 33:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.findLatestLog=function(){var e=(0,D.Z)(W().mark((function e(t,r){var i,a,s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("latest"!==r.toBlock){e.next=6;break}return e.next=3,t.getBlockNumber();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=r.toBlock;case 7:return i=e.t0,0===(a=r.fromBlock)&&ge.logger.warn("findLatestLog: expensive getLogs query fromBlock 0 toBlock ".concat(i)),e.prev=10,e.next=13,t.getLogs(Pt({},r,{toBlock:i}));case 13:return s=e.sent,e.abrupt("return",0===s.length?void 0:s[s.length-1]);case 17:return e.prev=17,e.t1=e.catch(10),o=Math.floor((i-a)/2+a),e.next=22,n.findLatestLog(t,Pt({},r,{fromBlock:o,toBlock:i}));case 22:if(void 0===(u=e.sent)){e.next=25;break}return e.abrupt("return",u);case 25:return e.abrupt("return",n.findLatestLog(t,Pt({},r,{fromBlock:a,toBlock:o})));case 26:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t,n){return e.apply(this,arguments)}}(),this.findFirstLog=function(){var e=(0,D.Z)(W().mark((function e(t,r){var i,a,s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("latest"!==r.toBlock&&r.toBlock){e.next=6;break}return e.next=3,t.getBlockNumber();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=r.toBlock;case 7:return i=e.t0,0===(a=r.fromBlock?r.fromBlock:0)&&ge.logger.warn("findFirstLog: expensive getLogs query fromBlock 0 toBlock ".concat(i)),e.prev=10,e.next=13,t.getLogs(Pt({},r,{fromBlock:a,toBlock:i}));case 13:return s=e.sent,e.abrupt("return",0===s.length?void 0:s[0]);case 17:return e.prev=17,e.t1=e.catch(10),o=Math.floor((i-a)/2+a),e.next=22,n.findFirstLog(t,Pt({},r,{fromBlock:a,toBlock:o}));case 22:if(void 0===(u=e.sent)){e.next=25;break}return e.abrupt("return",u);case 25:return e.abrupt("return",n.findFirstLog(t,Pt({},r,{fromBlock:o,toBlock:i})));case 26:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t,n){return e.apply(this,arguments)}}()}));function Dt(e){return void 0!==e.address&&!qt(e)}function qt(e){return Wt(e)||Ut(e)||Lt(e)}function Wt(e){var t=e;return void 0!==t.signature&&void 0===t.address}function Ut(e){var t=e;return void 0!==t.r&&void 0!==t.s&&void 0!==t.v&&void 0!==t.t}function Lt(e){var t=e;return void 0!==t.address&&void 0!==t.signature}!function(e){e[e.EOA=0]="EOA",e[e.Address=1]="Address",e[e.Full=2]="Full"}(Mt||(Mt={}));var Bt=function(e){if("string"!==typeof e)return e;for(var t=e.replace("0x",""),n=ue.O$.from("0x".concat(t.slice(0,4))).toNumber(),r=[],i=4;i<t.length;){var a=ue.O$.from(t.slice(i,i+2)).toNumber();i+=2;var s=ue.O$.from("0x".concat(t.slice(i,i+2))).toNumber();switch(i+=2,a){case Mt.Address:var o=ce.getAddress(t.slice(i,i+40));i+=40,r.push({weight:s,address:o});break;case Mt.EOA:var u=B.arrayify("0x".concat(t.slice(i,i+132)));i+=132;var c=B.splitSignature(u.slice(0,65)),l=c.r,f=c.s,d=c.v,h=ue.O$.from(u[u.length-1]).toNumber();r.push({weight:s,signature:u,r:l,s:f,v:d,t:h});break;case Mt.Full:var p=ce.getAddress(t.slice(i,i+40));i+=40;var g=ue.O$.from("0x".concat(t.slice(i,i+4))).mul(2).toNumber();i+=4;var v=B.arrayify("0x".concat(t.slice(i,i+g)));i+=g,r.push({weight:s,address:p,signature:v});break;default:throw Error("Signature type not supported")}}return{threshold:n,signers:r}},Ft=function(e){var t=B.arrayify(e.signature);return Pt({},e,B.splitSignature(t.slice(0,65)),{t:ue.O$.from(t[t.length-1]).toNumber()})},Gt=function(e,t){var n=Ut(t)?t:Ft(t);switch(n.t){case 1:return de.recoverAddress(e,{r:n.r,s:n.s,v:n.v});case 2:var r=F.keccak256(le.pack(["string","bytes32"],["\x19Ethereum Signed Message:\n32",e]));return de.recoverAddress(r,{r:n.r,s:n.s,v:n.v});default:throw new Error("Unknown signature")}},jt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.map((function(e){return"string"===typeof e?Bt(e):e}));return r.reduce((function(e,t){return Ht(e,t)}))},Ht=function(e,t){return{threshold:e.threshold,signers:e.signers.map((function(e,n){return Dt(e)?t.signers[n]:e}))}},Vt=function e(t){if("string"===typeof t)return e(Bt(t));var n=t.signers.map((function(e){if(Dt(e))return le.pack(["uint8","uint8","address"],[Mt.Address,e.weight,e.address]);if(Ut(e))return le.pack(["uint8","uint8","bytes32","bytes32","uint8","uint8"],[Mt.EOA,e.weight,e.r,e.s,e.v,e.t]);if(Lt(e)){var t=B.arrayify(e.signature).length;return le.pack(["uint8","uint8","address","uint16","bytes"],[Mt.Full,e.weight,e.address,t,e.signature])}if(Wt(e))return le.pack(["uint8","uint8","bytes"],[Mt.EOA,e.weight,e.signature]);throw Error("Unkwnown signature part type")}));return le.pack(["uint16"].concat((0,R.Z)(Array(n.length).fill("bytes"))),[t.threshold].concat((0,R.Z)(n)))};function Kt(e,t){if(Dt(e))return e.address;if(Lt(e))return e.address;if(Ut(e)||Wt(e))return Gt(t,e);throw Error("Unkwnown signature part type")}function Jt(e,t,n){var r=e.signers.map((function(e){return Kt(e,n)}));return{threshold:t.threshold,signers:t.signers.map((function(t){var n=r.indexOf(t.address);return-1!==n?Pt({},e.signers[n],{weight:t.weight}):{weight:t.weight,address:t.address}}))}}function $t(e,t){return zt.apply(this,arguments)}function zt(){return zt=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new gt.MulticallProvider(t),e.next=3,Promise.all(n.signers.map(function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Pt,e.t1={},e.t2=t,e.t3=n,e.t4=U,e.next=7,r.getCode(t.address);case 7:return e.t5=e.sent,e.t6=e.t4.arrayify.call(e.t4,e.t5).length,e.t7=0===e.t6,e.t8={index:e.t3,isEOA:e.t7},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t8));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 3:return i=e.sent,a=i.sort((function(e,t){return e.weight-t.weight})),s=0,a=a.map((function(e){return s>=n.threshold||e.isEOA?e:(s+=e.weight,Pt({},e,{willSign:!0}))})),s<n.threshold&&(a=a.map((function(e){return e.willSign||s>=n.threshold?e:(s+=e.weight,Pt({},e,{willSign:!0}))}))),o=B.arrayify("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a01b02"),u=a.sort((function(e,t){return e.index-t.index})),e.abrupt("return",{threshold:n.threshold,signers:u.map((function(e){return e.willSign?e.isEOA?{weight:e.weight,signature:o}:{weight:e.weight,address:e.address,signature:Vt({threshold:1,signers:[{address:H.Wallet.createRandom().address,weight:1},{weight:1,signature:o}]})+B.hexlify(3).substring(2)}:{address:e.address,weight:e.weight}}))});case 11:case"end":return e.stop()}}),e)}))),zt.apply(this,arguments)}function Yt(){return Yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Yt.apply(this,arguments)}var Qt,Xt,en,tn,nn,rn="v1",an="v0.4.0",sn="6071879702f8258e8912ca95cf2d9c1459ca991d";!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e.SEQUENCE_WALLET="SEQUENCE_WALLET",e.ERC20_BRIDGE="ERC20_BRIDGE",e.ERC721_BRIDGE="ERC721_BRIDGE",e.ERC1155_BRIDGE="ERC1155_BRIDGE"}(Qt||(Qt={})),function(e){e.UNKNOWN="UNKNOWN",e.BLOCK_ADDED="BLOCK_ADDED",e.BLOCK_REMOVED="BLOCK_REMOVED"}(Xt||(Xt={})),function(e){e.UNKNOWN="UNKNOWN",e.TOKEN_TRANSFER="TOKEN_TRANSFER",e.SEQUENCE_TXN="SEQUENCE_TXN"}(en||(en={})),function(e){e.UNKNOWN="UNKNOWN",e.SEND="SEND",e.RECEIVE="RECEIVE"}(tn||(tn={})),function(e){e.DESC="DESC",e.ASC="ASC"}(nn||(nn={}));var on,un=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Indexer/",this.ping=function(e){return r.fetch(r.url("Ping"),cn({},e)).then((function(e){return ln(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),cn({},e)).then((function(e){return ln(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),cn({},e)).then((function(e){return ln(e).then((function(e){return{status:e.status}}))}))},this.getChainID=function(e){return r.fetch(r.url("GetChainID"),cn({},e)).then((function(e){return ln(e).then((function(e){return{chainID:e.chainID}}))}))},this.getEtherBalance=function(e,t){return r.fetch(r.url("GetEtherBalance"),cn(e,t)).then((function(e){return ln(e).then((function(e){return{balance:e.balance}}))}))},this.getTokenBalances=function(e,t){return r.fetch(r.url("GetTokenBalances"),cn(e,t)).then((function(e){return ln(e).then((function(e){return{page:e.page,balances:e.balances}}))}))},this.getTokenSupplies=function(e,t){return r.fetch(r.url("GetTokenSupplies"),cn(e,t)).then((function(e){return ln(e).then((function(e){return{page:e.page,contractType:e.contractType,tokenIDs:e.tokenIDs}}))}))},this.getTokenSuppliesMap=function(e,t){return r.fetch(r.url("GetTokenSuppliesMap"),cn(e,t)).then((function(e){return ln(e).then((function(e){return{supplies:e.supplies}}))}))},this.getBalanceUpdates=function(e,t){return r.fetch(r.url("GetBalanceUpdates"),cn(e,t)).then((function(e){return ln(e).then((function(e){return{page:e.page,balances:e.balances}}))}))},this.getTransactionHistory=function(e,t){return r.fetch(r.url("GetTransactionHistory"),cn(e,t)).then((function(e){return ln(e).then((function(e){return{page:e.page,transactions:e.transactions}}))}))},this.syncBalance=function(e,t){return r.fetch(r.url("SyncBalance"),cn(e,t)).then((function(e){return ln(e).then((function(e){return{}}))}))},this.hostname=t,this.fetch=n}return(0,m.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),cn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:Yt({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},ln=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))};!function(e){e.MAINNET="https://mainnet-indexer.sequence.app",e.POLYGON="https://polygon-indexer.sequence.app",e.RINKEBY="https://rinkeby-indexer.sequence.app",e.POLYGON_MUMBAI="https://mumbai-indexer.sequence.app"}(on||(on={}));var fn=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e.endsWith("/")?e.slice(0,-1):e,b())).jwtAuth=r,i._fetch=function(e,t){var n={};return i.jwtAuth&&i.jwtAuth.length>0&&(n.Authorization="BEARER ".concat(i.jwtAuth)),t.headers=Yt({},t.headers,n),b()(e,t)},i.fetch=i._fetch,i}return(0,m.Z)(n)}(un);function dn(){return dn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dn.apply(this,arguments)}var hn,pn,gn,vn="v1",wn="v0.4.0",yn="3f6b0f4aa1a7b58488e9399c277fc17995d74f5a";!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155"}(hn||(hn={})),function(e){e.UNKNOWN="UNKNOWN",e.BUY="BUY",e.SELL="SELL"}(pn||(pn={})),function(e){e.DESC="DESC",e.ASC="ASC"}(gn||(gn={}));var mn=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Metadata/",this.ping=function(e){return r.fetch(r.url("Ping"),kn({},e)).then((function(e){return bn(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),kn({},e)).then((function(e){return bn(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),kn({},e)).then((function(e){return bn(e).then((function(e){return{status:e.status}}))}))},this.getTokenMetadata=function(e,t){return r.fetch(r.url("GetTokenMetadata"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{tokenMetadata:e.tokenMetadata}}))}))},this.getTokenMetadataBatch=function(e,t){return r.fetch(r.url("GetTokenMetadataBatch"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{contractTokenMetadata:e.contractTokenMetadata}}))}))},this.searchTokenMetadata=function(e,t){return r.fetch(r.url("SearchTokenMetadata"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{page:e.page,tokenMetadata:e.tokenMetadata}}))}))},this.searchTokenIDs=function(e,t){return r.fetch(r.url("SearchTokenIDs"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{page:e.page,tokenIds:e.tokenIds}}))}))},this.getContractInfo=function(e,t){return r.fetch(r.url("GetContractInfo"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{contractInfo:e.contractInfo}}))}))},this.getContractInfoBatch=function(e,t){return r.fetch(r.url("GetContractInfoBatch"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{contractInfoMap:e.contractInfoMap}}))}))},this.searchContractInfo=function(e,t){return r.fetch(r.url("SearchContractInfo"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{contractInfoList:e.contractInfoList}}))}))},this.searchContractInfoBatch=function(e,t){return r.fetch(r.url("SearchContractInfoBatch"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{contractInfoByChain:e.contractInfoByChain}}))}))},this.getNiftyswapTokenQuantity=function(e,t){return r.fetch(r.url("GetNiftyswapTokenQuantity"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{quantity:e.quantity}}))}))},this.getNiftyswapUnitPrices=function(e,t){return r.fetch(r.url("GetNiftyswapUnitPrices"),kn(e,t)).then((function(e){return bn(e).then((function(e){return{prices:e.prices}}))}))},this.hostname=t,this.fetch=n}return(0,m.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),kn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:dn({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},bn=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},xn=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://metadata.sequence.app";return(0,y.Z)(this,n),t.call(this,e.endsWith("/")?e.slice(0,-1):e,b())}return(0,m.Z)(n)}(mn),Cn=n(3374),En=n(5244),In=n(8624);function Sn(){return Sn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Sn.apply(this,arguments)}var _n="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]";function On(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Bn.apply(void 0,t);if(void 0===r)throw new Error("Encoding transactions without defined nonce");return Nn.apply(void 0,[r].concat(t))}function Nn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return fe.$.encode(["uint256",_n],[e,Fn(n)])}function Tn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Bn.apply(void 0,t);if(void 0===r)throw new Error("Computing hash for transactions without defined nonce");return Zn.apply(void 0,[r].concat(t))}function Zn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return F.keccak256(Nn.apply(void 0,[e].concat(n)))}function An(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return(0,ge.subDigestOf)(e,t,Tn.apply(void 0,r)).replace(/^0x/,"")}function Pn(e,t){return Mn.apply(this,arguments)}function Mn(){return Mn=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],i=u.length>3&&void 0!==u[3]?u[3]:he._Y,a=Rn(n),e.next=5,Promise.all(n.map((function(e){return e.nonce})));case 5:return s=e.sent.filter((function(e){return void 0!==e})).map((function(e){return ue.O$.from(e)})),o=0!==s.length?s.reduce((function(e,t){return e.lt(t)?e:t})):void 0,e.abrupt("return",Promise.all(a.map((function(e){return Dn(t,e,r,i,o)}))));case 8:case"end":return e.stop()}}),e)}))),Mn.apply(this,arguments)}function Rn(e){return Array.isArray(e)?e.reduce((function(e,t){return Array.isArray(t)?e.concat(Rn(t)):t.auxiliary?e.concat([t].concat((0,R.Z)(Rn(t.auxiliary)))):e.concat(t)}),[]):Rn([e])}function Dn(e,t){return qn.apply(this,arguments)}function qn(){return qn=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>2&&void 0!==l[2]&&l[2],i=l.length>3&&void 0!==l[3]?l[3]:he._Y,a=l.length>4?l[4]:void 0,!Un(n)){e.next=5;break}return e.abrupt("return",n);case 5:if(s=void 0===n.gasLimit?n.gas:n.gasLimit,!n.to){e.next=41;break}if(e.t0=r,!s){e.next=14;break}return e.next=11,s;case 11:e.t1=e.sent,e.next=15;break;case 14:e.t1=i;case 15:return e.t2=e.t1,e.next=18,n.to;case 18:if(e.t3=e.sent,!n.value){e.next=25;break}return e.next=22,n.value;case 22:e.t4=e.sent,e.next=26;break;case 25:e.t4=0;case 26:return e.t5=e.t4,e.next=29,n.data;case 29:if(e.t6=e.sent,!a){e.next=34;break}e.t7=a,e.next=37;break;case 34:return e.next=36,n.nonce;case 36:e.t7=e.sent;case 37:return e.t8=e.t7,e.abrupt("return",{delegateCall:!1,revertOnError:e.t0,gasLimit:e.t2,to:e.t3,value:e.t5,data:e.t6,nonce:e.t8});case 41:if(o=new we.vU(g.mainModule.abi),u=o.encodeFunctionData(o.getFunction("createContract"),[n.data]),c="string"===typeof t?t:t.getAddress(),e.t9=r,!s){e.next=51;break}return e.next=48,s;case 48:e.t10=e.sent,e.next=52;break;case 51:e.t10=i;case 52:return e.t11=e.t10,e.next=55,c;case 55:if(e.t12=e.sent,!n.value){e.next=62;break}return e.next=59,n.value;case 59:e.t13=e.sent,e.next=63;break;case 62:e.t13=0;case 63:if(e.t14=e.t13,e.t15=u,!a){e.next=69;break}e.t16=a,e.next=72;break;case 69:return e.next=71,n.nonce;case 71:e.t16=e.sent;case 72:return e.t17=e.t16,e.abrupt("return",{delegateCall:!1,revertOnError:e.t9,gasLimit:e.t11,to:e.t12,value:e.t14,data:e.t15,nonce:e.t17});case 74:case"end":return e.stop()}}),e)}))),qn.apply(this,arguments)}function Wn(e){return e.send||e.sendAsync}function Un(e){return void 0!==e.delegateCall||void 0!==e.revertOnError}function Ln(e){return void 0!==e.find((function(e){return Un(e)}))}function Bn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find((function(e){return void 0!==e.nonce}));if(r){var i=ue.O$.from(r.nonce);if(t.find((function(e){return void 0!==e.nonce&&!ue.O$.from(e.nonce).eq(i)})))throw new Error("Mixed nonces on Sequence transactions");return r?r.nonce:void 0}}function Fn(e){return e.map((function(e){var t;return{delegateCall:!0===e.delegateCall,revertOnError:!0===e.revertOnError,gasLimit:void 0!==e.gasLimit?e.gasLimit:he._Y,target:null!=(t=e.to)?t:In.d,value:void 0!==e.value?e.value:he._Y,data:void 0!==e.data?e.data:[]}}))}function Gn(e,t){return e.map((function(e){return Sn({},e,{nonce:t})}))}function jn(e,t,n){var r=new we.vU(g.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:r.encodeFunctionData(r.getFunction("requireNonExpired"),[n])}].concat((0,R.Z)(t))}function Hn(e,t,n){var r=new we.vU(g.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:r.encodeFunctionData(r.getFunction("requireMinNonce"),[n.address,n.space?Vn(n.space,n.nonce):n.nonce])}].concat((0,R.Z)(t))}function Vn(e,t){var n=ue.O$.from(e),r=ue.O$.from(t),i=he.Py.pow(ue.O$.from(96));if(!r.div(i).eq(he._Y))throw new Error("Space already encoded");return r.add(n.mul(i))}function Kn(e){var t=ue.O$.from(e),n=he.Py.pow(ue.O$.from(96));return[t.div(n),t.mod(n)]}function Jn(e){return void 0!==e&&void 0!==e.chainId&&void 0!==e.config&&void 0!==e.context&&void 0!==e.signature&&void 0!==e.transactions&&Array.isArray(e.transactions)&&e.transactions.reduce((function(e,t){return e&&Un(t)}),!0)}function $n(e,t,n){return zn.apply(this,arguments)}function zn(){return(zn=(0,D.Z)(W().mark((function e(t,n,r){var i,a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],!Array.isArray(r)){e.next=11;break}if(!Ln(r)){e.next=6;break}i=r,e.next=9;break;case 6:return e.next=8,Pn(n,r);case 8:i=e.sent;case 9:e.next=18;break;case 11:if(!Un(r)){e.next=15;break}i=[r],e.next=18;break;case 15:return e.next=17,Pn(n,[r]);case 17:i=e.sent;case 18:return r.expiration&&(i=jn(t,i,r.expiration)),r.afterNonce&&(a=r.afterNonce,i=Hn(t,i,a.address?{address:a.address,nonce:a.nonce,space:a.space}:{address:n,nonce:a})),e.abrupt("return",i);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yn=n(9745),Qn=n(3540),Xn=n.n(Qn),er=n(520),tr=n(3580);function nr(){return nr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nr.apply(this,arguments)}function rr(e){return void 0!==e.bundleCreation&&"boolean"===typeof e.bundleCreation||void 0!==e.creationGasLimit&&(0,ge.isBigNumberish)(e.creationGasLimit)||void 0!==e.provider&&(Yn.zt.isProvider(e.provider)||"string"===typeof e.provider)}var ir={bundleCreation:!0,creationGasLimit:he.Py.pow(17)},ar=function(){function e(t){(0,y.Z)(this,e),this.provider=void 0,this.bundleCreation=void 0,this.creationGasLimit=void 0;var n=nr({},ir,t);this.bundleCreation=n.bundleCreation,this.provider=n.provider,this.creationGasLimit=ue.O$.from(n.creationGasLimit)}return(0,m.Z)(e,[{key:"isWalletDeployed",value:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.provider){e.next=2;break}throw new Error("Bundled creation provider not found");case 2:return e.next=4,this.provider.getCode(t);case 4:return e.t0=e.sent,e.abrupt("return","0x"!==e.t0);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"prepareWalletDeploy",value:function(e,t){var n=new tr.Interface(g.factory.abi);return{to:t.factory,data:n.encodeFunctionData(n.getFunction("deploy"),[t.mainModule,St(e)])}}},{key:"prependWalletDeploy",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o,u,c;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.config,r=t.context,i=t.transactions,a=t.nonce,s=t.signature,o=It(n,r),u=new tr.Interface(g.mainModule.abi),c=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s;case 2:if("string"!==typeof(t=e.sent)){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",Vt(t));case 6:case"end":return e.stop()}}),e)})))(),e.t0=this.bundleCreation,!e.t0){e.next=9;break}return e.next=8,this.isWalletDeployed(o);case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=31;break}return e.t1=r.guestModule,e.t2=nr({},this.prepareWalletDeploy(n,r),{delegateCall:!1,revertOnError:!1,gasLimit:this.creationGasLimit,value:he._Y}),e.t3=he._Y,e.t4=o,e.t5=he._Y,e.t6=u,e.t7=u.getFunction("execute"),e.t8=Fn(i),e.t9=a,e.next=21,c;case 21:return e.t10=e.sent,e.t11=[e.t8,e.t9,e.t10],e.t12=e.t6.encodeFunctionData.call(e.t6,e.t7,e.t11),e.t13={delegateCall:!1,revertOnError:!0,gasLimit:e.t3,to:e.t4,value:e.t5,data:e.t12},e.t14=[e.t2,e.t13],e.t15=he._Y,e.t16={transactions:e.t14,nonce:e.t15,signature:"0x"},e.abrupt("return",{to:e.t1,execute:e.t16});case 31:return e.t17=o,e.t18=i,e.t19=ue.O$.from(a),e.next=36,c;case 36:return e.t20=e.sent,e.t21={transactions:e.t18,nonce:e.t19,signature:e.t20},e.abrupt("return",{to:e.t17,execute:e.t21});case 39:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"prepareTransactions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s,o,u,c,l,f,d=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=d.length,a=new Array(i>3?i-3:0),s=3;s<i;s++)a[s-3]=d[s];if(o=Bn.apply(void 0,a)){e.next=4;break}throw new Error("Unable to prepare transactions without a defined nonce");case 4:return e.next=6,this.prependWalletDeploy({config:t,context:n,transactions:a,nonce:o,signature:r});case 6:return u=e.sent,c=u.to,l=u.execute,f=new tr.Interface(g.mainModule.abi),e.abrupt("return",{to:c,data:f.encodeFunctionData(f.getFunction("execute"),[Fn(l.transactions),l.nonce,l.signature])});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),sr=ue.O$.from(8e5),or={waitPollRate:1e3,deltaBlocksLog:12,fromBlockLog:-1024};function ur(e){return void 0!==e.provider&&Yn.zt.isProvider(e.provider)}var cr=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;(0,y.Z)(this,n),(r=t.call(this,e)).provider=void 0,r.waitPollRate=void 0,r.deltaBlocksLog=void 0,r.fromBlockLog=void 0;var i=nr({},or,e);return r.provider=i.provider,r.waitPollRate=i.waitPollRate,r.deltaBlocksLog=i.deltaBlocksLog,r.fromBlockLog=i.fromBlockLog,r}return(0,m.Z)(n,[{key:"simulate",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this,r=s.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=s[a];return e.next=4,Promise.all(i.map(function(){var e=(0,D.Z)(W().mark((function e(r){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.gasLimit||ue.O$.from(r.gasLimit||0).eq(he._Y)){e.next=2;break}return e.abrupt("return",r.gasLimit);case 2:if(!r.delegateCall){e.next=4;break}return e.abrupt("return",sr);case 4:if(e.t0=r.to===t,!e.t0){e.next=9;break}return e.next=8,n.isWalletDeployed(t);case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=11;break}return e.abrupt("return",sr);case 11:if(n.provider){e.next=13;break}throw new Error("signer.provider is not set, but is required");case 13:return e.abrupt("return",n.provider.estimateGas({from:t,to:r.to,data:r.data,value:r.value}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",e.sent.map((function(e){return{executed:!0,succeeded:!0,gasLimit:ue.O$.from(e).toNumber(),gasUsed:ue.O$.from(e).toNumber()}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"estimateGasLimits",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=It(t,n),i=u.length,a=new Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=u[s];return e.next=4,this.simulate.apply(this,[r].concat(a));case 4:return o=e.sent,e.abrupt("return",a.map((function(e,t){return nr({},e,{gasLimit:o[t].gasLimit})})));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNonce",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i){var a,s,o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.provider){e.next=2;break}throw new Error("provider is not set");case 2:return a=It(t,n),e.next=5,this.provider.getCode(a);case 5:if(e.t0=e.sent,"0x"!==e.t0){e.next=8;break}return e.abrupt("return",0);case 8:return void 0===r&&(r=0),s=new L.CH(a,g.mainModule.abi,this.provider),e.next=12,s.readNonce(r,{blockTag:i});case 12:return o=e.sent,e.abrupt("return",Vn(r,o));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"wait",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l,f=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"===typeof t){e.next=3;break}return ge.logger.info.apply(ge.logger,["computing id",t.config,t.context,t.chainId].concat((0,R.Z)(t.transactions))),e.abrupt("return",this.wait(An.apply(void 0,[It(t.config,t.context),t.chainId].concat((0,R.Z)(t.transactions))),n));case 3:if(r=(new Date).getTime()+n,!((i=this.fromBlockLog)<0)){e.next=10;break}return e.next=8,this.provider.getBlockNumber();case 8:a=e.sent,i=a+i;case 10:s=t.replace("0x","");case 11:if(!((new Date).getTime()<r)){e.next=34;break}return e.next=14,this.provider.getBlockNumber();case 14:return o=e.sent,e.next=17,this.provider.getLogs({fromBlock:Math.max(0,i-this.deltaBlocksLog),toBlock:o,topics:["0x1f180c27086c7a39ea2a7b25239d1ab92348f07ca7bb59d1438fcf527568f881"]});case 17:return u=e.sent,i=o,e.next=21,Promise.all(u.map((function(e){return f.provider.getTransactionReceipt(e.transactionHash)})));case 21:if(c=e.sent,!(l=c.find((function(e){return e.logs.find((function(e){return 0===e.topics.length&&e.data.replace("0x","")===s||1===e.topics.length&&"0x3dbd1590ea96dd3253a91f24e64e3a502e1225d602a5731357bc12643070ccd7"===e.topics[0]&&e.data.length>=64&&e.data.replace("0x","").startsWith(s)}))})))){e.next=30;break}return e.t0=nr,e.t1={receipt:l},e.next=28,this.provider.getTransaction(l.transactionHash);case 28:return e.t2=e.sent,e.abrupt("return",(0,e.t0)(e.t1,e.t2));case 30:return e.next=32,new Promise((function(e){return setTimeout(e,f.waitPollRate)}));case 32:e.next=11;break;case 34:throw new Error("Timeout waiting for transaction receipt ".concat(t));case 35:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ar);function lr(e){return void 0!==e.signer&&oe.E.isSigner(e.signer)}var fr,dr,hr,pr,gr=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,oe.E.isSigner(e)?{provider:e.provider}:nr({},e,{provider:e.signer.provider}))).signer=void 0,r.txnOptions=void 0,r.signer=oe.E.isSigner(e)?e:e.signer,!r.signer.provider)throw new Error("Signer must have a provider");return r}return(0,m.Z)(n,[{key:"deployWallet",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.prepareWalletDeploy(t,n),e.abrupt("return",this.signer.sendTransaction(nr({},r,{gasLimit:he.Py.pow(17)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFeeOptions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{options:[]});case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"gasRefundOptions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=u[a];return e.next=3,this.getFeeOptions.apply(this,[t,n].concat(i));case 3:return s=e.sent,o=s.options,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setTransactionOptions",value:function(e){this.txnOptions=e}},{key:"relay",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n&&ge.logger.warn("LocalRelayer doesn't accept fee quotes"),t.context.guestModule&&42===t.context.guestModule.length){e.next=3;break}throw new Error("LocalRelayer requires the context.guestModule address");case 3:return e.next=5,this.prependWalletDeploy(t);case 5:return r=e.sent,i=r.to,a=r.execute,s=new we.vU(g.mainModule.abi),o=s.encodeFunctionData(s.getFunction("execute"),[Fn(a.transactions),a.nonce,a.signature]),e.abrupt("return",this.signer.sendTransaction(nr({to:i,data:o},this.txnOptions)));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(cr);!function(e){e.UNKNOWN="UNKNOWN",e.DROPPED="DROPPED",e.QUEUED="QUEUED",e.SENT="SENT",e.SUCCEEDED="SUCCEEDED",e.PARTIALLY_FAILED="PARTIALLY_FAILED",e.FAILED="FAILED"}(fr||(fr={})),function(e){e.SEND="SEND",e.RECEIVE="RECEIVE",e.BRIDGE_DEPOSIT="BRIDGE_DEPOSIT",e.BRIDGE_WITHDRAW="BRIDGE_WITHDRAW",e.BURN="BURN",e.UNKNOWN="UNKNOWN"}(dr||(dr={})),function(e){e.UNKNOWN="UNKNOWN",e.ERC20_TOKEN="ERC20_TOKEN",e.ERC1155_TOKEN="ERC1155_TOKEN"}(hr||(hr={})),function(e){e.DESC="DESC",e.ASC="ASC"}(pr||(pr={}));var vr=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Relayer/",this.ping=function(e){return r.fetch(r.url("Ping"),wr({},e)).then((function(e){return yr(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),wr({},e)).then((function(e){return yr(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),wr({},e)).then((function(e){return yr(e).then((function(e){return{status:e.status}}))}))},this.getSequenceContext=function(e){return r.fetch(r.url("GetSequenceContext"),wr({},e)).then((function(e){return yr(e).then((function(e){return{data:e.data}}))}))},this.getChainID=function(e){return r.fetch(r.url("GetChainID"),wr({},e)).then((function(e){return yr(e).then((function(e){return{chainID:e.chainID}}))}))},this.sendMetaTxn=function(e,t){return r.fetch(r.url("SendMetaTxn"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{status:e.status,txnHash:e.txnHash}}))}))},this.getMetaTxnNonce=function(e,t){return r.fetch(r.url("GetMetaTxnNonce"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{nonce:e.nonce}}))}))},this.getMetaTxnReceipt=function(e,t){return r.fetch(r.url("GetMetaTxnReceipt"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{receipt:e.receipt}}))}))},this.simulate=function(e,t){return r.fetch(r.url("Simulate"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{results:e.results}}))}))},this.updateMetaTxnGasLimits=function(e,t){return r.fetch(r.url("UpdateMetaTxnGasLimits"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{payload:e.payload}}))}))},this.feeTokens=function(e){return r.fetch(r.url("FeeTokens"),wr({},e)).then((function(e){return yr(e).then((function(e){return{isFeeRequired:e.isFeeRequired,tokens:e.tokens}}))}))},this.feeOptions=function(e,t){return r.fetch(r.url("FeeOptions"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{options:e.options,quote:e.quote}}))}))},this.getMetaTxnNetworkFeeOptions=function(e,t){return r.fetch(r.url("GetMetaTxnNetworkFeeOptions"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{options:e.options}}))}))},this.sentTransactions=function(e,t){return r.fetch(r.url("SentTransactions"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{page:e.page,transactions:e.transactions}}))}))},this.pendingTransactions=function(e,t){return r.fetch(r.url("PendingTransactions"),wr(e,t)).then((function(e){return yr(e).then((function(e){return{page:e.page,transactions:e.transactions}}))}))},this.hostname=t,this.fetch=n}return(0,m.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),wr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:nr({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},yr=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},mr=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"4dca0b91c1531d1166ae2f7ebd8af571b0c0e43b",get ETHTxnStatus(){return fr},get TransferType(){return dr},get FeeTokenType(){return hr},get SortOrder(){return pr},Relayer:vr}),kr=[fr.FAILED,fr.PARTIALLY_FAILED,fr.DROPPED];function br(e){return void 0!==e.url&&"string"===typeof e.url}var xr=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).service=void 0,r.service=new vr(e.url,Xn()().fetch),r}return(0,m.Z)(n,[{key:"waitReceipt",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:1e3,"string"===typeof t){e.next=4;break}return ge.logger.info.apply(ge.logger,["computing id",t.config,t.context,t.chainId].concat((0,R.Z)(t.transactions))),e.abrupt("return",this.waitReceipt(An.apply(void 0,[It(t.config,t.context),t.chainId].concat((0,R.Z)(t.transactions)))));case 4:return ge.logger.info("[rpc-relayer/waitReceipt] waiting for ".concat(t)),e.next=7,this.service.getMetaTxnReceipt({metaTxID:t});case 7:r=e.sent;case 8:if(r.receipt&&r.receipt.txnReceipt&&"null"!==r.receipt.txnReceipt&&"UNKNOWN"!==r.receipt.status&&"QUEUED"!==r.receipt.status&&"SENT"!==r.receipt.status){e.next=16;break}return e.next=11,new Promise((function(e){return setTimeout(e,n)}));case 11:return e.next=13,this.service.getMetaTxnReceipt({metaTxID:t});case 13:r=e.sent,e.next=8;break;case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"simulate",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=fe.$,r=o.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=o[a];return s=n.encode([_n],[Fn(i)]),e.next=5,this.service.simulate({wallet:t,transactions:s});case 5:return e.abrupt("return",e.sent.results);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"estimateGasLimits",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,d,h=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=h.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=h[a];if(ge.logger.info("[rpc-relayer/estimateGasLimits] estimate gas limits request ".concat(JSON.stringify(i))),0!=i.length){e.next=4;break}return e.abrupt("return",[]);case 4:if(s=It(t,n),void 0!==(o=Bn.apply(void 0,(0,R.Z)(i)))){e.next=13;break}return e.t0=Gn,e.t1=i,e.next=11,this.getNonce(t,n);case 11:e.t2=e.sent,i=(0,e.t0)(e.t1,e.t2);case 13:return u=fe.$,c=u.encode([_n],[Fn(i)]),e.next=17,this.service.updateMetaTxnGasLimits({walletAddress:s,walletConfig:{address:s,signers:t.signers,threshold:t.threshold,chainId:t.chainId},payload:c});case 17:return l=e.sent,f=u.decode([_n],l.payload)[0],d=i.map((function(e,t){return nr({},e,{gasLimit:f[t].gasLimit})})),ge.logger.info("[rpc-relayer/estimateGasLimits] got transactions with gas limits ".concat(JSON.stringify(d))),e.abrupt("return",void 0===o?d:Gn(d,o));case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFeeOptions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,d,h,p,v,w,y,m=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.service.feeTokens();case 2:if(!(r=e.sent).isFeeRequired){e.next=32;break}for(i=r.tokens.map((function(e){return e.symbol})).join(", "),ge.logger.info("[rpc-relayer/getFeeOptions] relayer fees are required, accepted tokens are ".concat(i)),a=It(t,n),s=m.length,o=new Array(s>2?s-2:0),u=2;u<s;u++)o[u-2]=m[u];if(void 0!==(c=Bn.apply(void 0,o))){e.next=13;break}return e.next=12,this.getNonce(t,n);case 12:c=e.sent;case 13:if(this.provider){e.next=16;break}throw ge.logger.warn("[rpc-relayer/getFeeOptions] provider not set, needed for stub signature"),new Error("provider is not set");case 16:return e.next=18,this.prependWalletDeploy({config:t,context:n,transactions:o,nonce:c,signature:$t(this.provider,t)});case 18:return l=e.sent,f=l.to,d=l.execute,h=new we.vU(g.mainModule.abi),p=h.encodeFunctionData(h.getFunction("execute"),[Fn(d.transactions),d.nonce,d.signature]),e.next=25,this.service.feeOptions({wallet:a,to:f,data:p});case 25:return v=e.sent,w=v.options,y=v.quote,ge.logger.info("[rpc-relayer/getFeeOptions] got refund options ".concat(JSON.stringify(w))),e.abrupt("return",{options:w,quote:{_tag:"FeeQuote",_quote:y}});case 32:return ge.logger.info("[rpc-relayer/getFeeOptions] relayer fees are not required"),e.abrupt("return",{options:[]});case 34:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"gasRefundOptions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=u[a];return e.next=3,this.getFeeOptions.apply(this,[t,n].concat(i));case 3:return s=e.sent,o=s.options,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNonce",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s,o,u,c,l,f;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=It(t,n),ge.logger.info("[rpc-relayer/getNonce] get nonce for wallet ".concat(i," space: ").concat(r)),a=void 0!==r?ue.O$.from(r).toHexString():void 0,e.next=5,this.service.getMetaTxnNonce({walletContractAddress:i,space:a});case 5:return s=e.sent,o=ue.O$.from(s.nonce),u=Kn(o),c=(0,P.Z)(u,2),l=c[0],f=c[1],ge.logger.info("[rpc-relayer/getNonce] got next nonce for wallet ".concat(i," ").concat(f," space: ").concat(l)),e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"relay",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge.logger.info("[rpc-relayer/relay] relaying signed meta-transactions ".concat(JSON.stringify(t)," with quote ").concat(JSON.stringify(n))),void 0!==n&&("string"===typeof n._quote?r=n._quote:ge.logger.warn("[rpc-relayer/relay] ignoring invalid fee quote")),this.provider){e.next=5;break}throw ge.logger.warn("[rpc-relayer/relay] provider not set, failed relay"),new Error("provider is not set");case 5:return e.next=7,this.prependWalletDeploy(t);case 7:return i=e.sent,a=i.to,s=i.execute,o=It(t.config,t.context),u=new we.vU(g.mainModule.abi),c=u.encodeFunctionData(u.getFunction("execute"),[Fn(s.transactions),s.nonce,s.signature]),e.next=15,this.service.sendMetaTxn({call:{walletAddress:o,contract:a,input:c},quote:r});case 15:return l=e.sent,ge.logger.info("[rpc-relayer/relay] got relay result ".concat(JSON.stringify(l))),e.abrupt("return",this.wait(l.txnHash));case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"wait",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:1e3,r=this,e.next=4,this.waitReceipt(t,n);case 4:if(i=e.sent,(a=i.receipt).txnReceipt&&!kr.includes(a.status)){e.next=8;break}throw new Cr(a);case 8:return s=JSON.parse(a.txnReceipt),e.abrupt("return",{blockHash:s.blockHash,blockNumber:ue.O$.from(s.blockNumber).toNumber(),confirmations:1,from:"string"===typeof t?void 0:It(t.config,t.context),hash:s.transactionHash,raw:a.txnReceipt,receipt:s,wait:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.provider.waitForTransaction(s.transactionHash,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ar),Cr=(0,m.Z)((function e(t){(0,y.Z)(this,e),this.receipt=t}));function Er(e){return"object"===typeof e&&"function"===typeof e.simulate&&"function"===typeof e.estimateGasLimits&&"function"===typeof e.getFeeOptions&&"function"===typeof e.gasRefundOptions&&"function"===typeof e.getNonce&&"function"===typeof e.relay&&"function"===typeof e.wait}function Ir(){return Ir=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ir.apply(this,arguments)}var Sr=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,null,[{key:"isSequenceSigner",value:function(e){return _r(e)}}]),n}(oe.E);function _r(e){var t=e;return t&&void 0!==t.updateConfig&&void 0!==t.publishConfig&&void 0!==t.getWalletContext&&void 0!==t.getWalletConfig}Error;var Or=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n)}((0,A.Z)(Error)),Nr=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"signMessage",value:function(e,t){return this.signMessageWithData(e)}},{key:"sendTransaction",value:function(e){throw new Error("sendTransaction method is not supported in RemoteSigner")}},{key:"signTransaction",value:function(e){throw new Error("signTransaction method is not supported in RemoteSigner")}},{key:"connect",value:function(e){throw new Error("connect method is not supported in RemoteSigner")}}],[{key:"signMessageWithData",value:function(e,t,n,r){return this.isRemoteSigner(e)?e.signMessageWithData(t,n,r):e.signMessage(t)}},{key:"isRemoteSigner",value:function(e){return void 0!==e.signMessageWithData}}]),n}(oe.E);function Tr(e){return Zr.apply(this,arguments)}function Zr(){return(Zr=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=2;break}return e.abrupt("return",Promise.all(t.map((function(e){return(0,er.resolveProperties)(e)}))));case 2:return e.abrupt("return",(0,er.resolveProperties)(t));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ar=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;(0,y.Z)(this,n),(r=t.call(this)).context=void 0,r.config=void 0,r._signers=void 0,r.provider=void 0,r.sender=void 0,r.relayer=void 0,r.chainId=void 0;var i=e.config,a=e.context,s=e.strict;if(r.context=Ir({},a||We),!0===s?r.context.nonStrict=void 0:!1===s&&(r.context.nonStrict=!0),!r.context.nonStrict&&!Ct(i))throw new Error("wallet config is not usable (strict mode)");r.config=_t(i);for(var o=arguments.length,u=new Array(o>1?o-1:0),c=1;c<o;c++)u[c-1]=arguments[c];return r._signers=u.map((function(e){return oe.E.isSigner(e)?e:new H.Wallet(e)})),r.imageHash,r}return(0,m.Z)(n,[{key:"useConfig",value:function(e,t){return(0,M.Z)(n,[{config:e,context:this.context,strict:t}].concat((0,R.Z)(this._signers))).setProvider(this.provider).setRelayer(this.relayer)}},{key:"useSigners",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,M.Z)(n,[{config:this.config,context:this.context}].concat(t)).setProvider(this.provider).setRelayer(this.relayer)}},{key:"connect",value:function(e,t){if(Fe(e))return(0,M.Z)(n,[{config:this.config,context:this.context}].concat((0,R.Z)(this._signers))).setProvider(e).setRelayer(t);throw new Error("Wallet provider argument is expected to be a JsonRpcProvider")}},{key:"setProvider",value:function(e){if(void 0===e)return this;if(Yn.zt.isProvider(e))this.provider=e,this.sender=new Ve(e);else{var t=new G.r(e);this.provider=t,this.sender=new Ve(t)}return this.chainId=void 0,this}},{key:"setRelayer",value:function(e){return void 0===e||(this.relayer=e),this}},{key:"getProvider",value:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.getChainIdNumber(t);case 3:return e.abrupt("return",this.provider);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayer",value:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.getChainIdNumber(t);case 3:return e.abrupt("return",this.relayer);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletContext",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.context);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWalletConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(t);case 2:return t=e.sent,n=Ir({},this.config,{chainId:t}),e.abrupt("return",[n]);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletState",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.getAddress(),this.getChainId(),this.isDeployed()]);case 2:if(n=e.sent,r=(0,P.Z)(n,3),i=r[0],a=r[1],s=r[2],e.t0=this.context,e.t1=this.config,e.t2=i,e.t3=a,e.t4=s,e.t5=this.imageHash,!s){e.next=19;break}return e.next=16,Fr(this);case 16:e.t6=e.sent,e.next=20;break;case 19:e.t6=void 0;case 20:return e.t7=e.t6,o={context:e.t0,config:e.t1,address:e.t2,chainId:e.t3,deployed:e.t4,imageHash:e.t5,lastImageHash:e.t7},e.abrupt("return",[o]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connected",get:function(){return void 0!==this.sender}},{key:"address",get:function(){return It(this.config,this.context)}},{key:"imageHash",get:function(){return St(this.config)}},{key:"getAddress",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.address);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSigners",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._signers&&0!==this._signers.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.abrupt("return",Promise.all(this._signers.map((function(e){return e.getAddress().then((function(e){return ce.getAddress(e)}))}))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainId",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chainId){e.next=2;break}return e.abrupt("return",this.chainId);case 2:if(this.provider){e.next=4;break}throw new Error("provider is not set, first connect a provider");case 4:return e.next=6,this.provider.getNetwork();case 6:return this.chainId=e.sent.chainId,e.abrupt("return",this.chainId);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainId();case 2:return t=e.sent,e.abrupt("return",[{chainId:t,name:"",rpcUrl:""}]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNonce",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.relayer.getNonce(this.config,this.context,n,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionCount",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNonce(t,0);case 2:return n=e.sent,r=Kn(n),i=(0,P.Z)(r,2),i[0],a=i[1],e.abrupt("return",ue.O$.from(a).toNumber());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){var s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signTransactions(t,n,r);case 2:return s=e.sent,a&&(o=It(s.config,s.context),u=An.apply(void 0,[o,s.chainId].concat((0,R.Z)(s.transactions))),a(s,u)),e.abrupt("return",this.relayer.relay(s,i));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"sendTransactionBatch",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(s.length>2&&void 0!==s[2])||s[2],i=s.length>3?s[3]:void 0,a=s.length>4?s[4]:void 0,e.abrupt("return",this.sendTransaction(t,n,r,i,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signTransactions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s,o,u,c,l;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(n);case 2:return i=e.sent,e.next=5,Tr(t);case 5:if(a=e.sent,this.provider){e.next=8;break}throw new Error("missing provider");case 8:if(this.relayer){e.next=10;break}throw new Error("missing relayer");case 10:return e.next=12,$n(this.context,this.address,a);case 12:if(!(s=e.sent).find((function(e){return!e.revertOnError&&ue.O$.from(e.gasLimit||0).eq(he._Y)}))){e.next=17;break}return e.next=16,(o=this.relayer).estimateGasLimits.apply(o,[this.config,this.context].concat((0,R.Z)(s)));case 16:s=e.sent;case 17:if(!(u=Bn.apply(void 0,(0,R.Z)(s)))){e.next=22;break}e.t0=u,e.next=25;break;case 22:return e.next=24,this.getNonce();case 24:e.t0=e.sent;case 25:return c=e.t0,s=Gn(s,c),l=Zn.apply(void 0,[c].concat((0,R.Z)(s))),e.t1=l,e.t2=i,e.t3=this.context,e.t4=this.config,e.t5=s,e.t6=c,e.next=36,this.sign(l,!0,n,r);case 36:return e.t7=e.sent,e.abrupt("return",{digest:e.t1,chainId:e.t2,context:e.t3,config:e.t4,transactions:e.t5,nonce:e.t6,signature:e.t7});case 38:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendSignedTransactions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.relayer){e.next=2;break}throw new Error("relayer is not set, first connect a relayer");case 2:return e.next=4,this.getChainIdNumber(n);case 4:return e.abrupt("return",this.relayer.relay(t,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signMessage",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>3&&void 0!==s[3]&&s[3],a="string"!==typeof t||t.startsWith("0x")?t:Cn.Y0(t),e.abrupt("return",this.sign(a,i,n,r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){var s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(i);case 2:if(s=e.sent,!(o=t.chainId?ue.O$.from(t.chainId).toNumber():void 0)||o===s){e.next=6;break}throw new Error("signTypedData: domain.chainId (".concat(t.chainId,") is expected to be ").concat(s));case 6:return u=(0,ge.encodeTypedDataDigest)({domain:t,types:n,message:r}),e.abrupt("return",this.sign(u,!0,s,a));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"_signTypedData",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.signTypedData(t,n,r,i,a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"subDigest",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(n);case 2:return r=e.sent,e.abrupt("return",B.arrayify((0,ge.subDigestOf)(this.address,r,t)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o,u,c,l,f,d,h,p=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(p.length>1&&void 0!==p[1])||p[1],r=p.length>2?p[2]:void 0,i=p.length>3?p[3]:void 0,a=this,e.next=6,this.getChainIdNumber(r);case 6:return s=e.sent,o=n?t:F.keccak256(t),e.next=10,this.subDigest(o,r);case 10:return u=e.sent,c=function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return e.getAddress()})));case 2:return r=e.sent,e.next=5,Promise.all(a.config.signers.map(function(){var e=(0,D.Z)(W().mark((function e(o){var c,l,f;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c=t[r.indexOf(o.address)]){e.next=4;break}return e.abrupt("return",o);case 4:if(!_r(c)){e.next=12;break}if(c!==a){e.next=7;break}throw Error("Can't sign transactions for self");case 7:return e.next=9,c.signMessage(u,s,i,!0);case 9:return e.t0=e.sent,l=e.t0+"03",e.abrupt("return",Ir({},o,{signature:l}));case 12:if(!Nr.isRemoteSigner(c)){e.next=25;break}return e.next=15,c.signMessageWithData(u,n,s);case 15:if(f=e.sent,e.prev=16,!(Gt(u,{weight:o.weight,signature:f})===o.address)){e.next=20;break}return e.abrupt("return",{weight:o.weight,signature:f});case 20:e.next=24;break;case 22:e.prev=22,e.t1=e.catch(16);case 24:return e.abrupt("return",Ir({},o,{signature:f}));case 25:return e.t2=o.weight,e.next=28,c.signMessage(u);case 28:return e.t3=e.sent,e.t4=e.t3+"02",e.abrupt("return",{weight:e.t2,signature:e.t4});case 33:if(e.prev=33,e.t5=e.catch(0),!i){e.next=39;break}throw e.t5;case 39:return console.warn("Skipped signer ".concat(o.address)),e.abrupt("return",o);case 41:case"end":return e.stop()}}),e,null,[[0,33],[16,22]])})));return function(t){return e.apply(this,arguments)}}()));case 5:return o=e.sent,e.abrupt("return",{threshold:a.config.threshold,signers:o});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),l=this._signers.filter((function(e){return!Nr.isRemoteSigner(e)})),e.next=15,c(l,this.packMsgAndSig(o,[],s));case 15:if(f=e.sent,!(f.signers.filter(qt).reduce((function(e,t){return e+t.weight}),0)>=this.config.threshold)){e.next=19;break}return e.abrupt("return",Vt(f));case 19:return d=this._signers.filter((function(e){return Nr.isRemoteSigner(e)})),e.next=22,c(d,this.packMsgAndSig(o,Vt(f),s));case 22:return h=e.sent,e.abrupt("return",Vt(jt(f,h)));case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signWeight",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSigners();case 2:return t=e.sent,e.abrupt("return",t.reduce((function(e,t){var r=n.config.signers.find((function(e){return e.address===t}));return r?e.add(r.weight):e}),he._Y));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isDeployed",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(t);case 2:return e.next=4,this.provider.getCode(this.address);case 4:return n=e.sent,e.abrupt("return",!!n&&"0x"!==n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l,f=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]&&f[2],i=f.length>3?f[3]:void 0,a=f.length>4?f[4]:void 0,s=f.length>5?f[5]:void 0,t||(t=this.config),e.next=7,Promise.all([this.buildUpdateConfigTransaction(t,r,i),null!=n?n:this.getNonce()]);case 7:return o=e.sent,u=(0,P.Z)(o,2),c=u[0],l=u[1],e.t0=Ir({address:this.address},t),e.next=14,this.sendTransaction(Gn(c,l),void 0,void 0,a,s);case 14:return e.t1=e.sent,e.abrupt("return",[e.t0,e.t1]);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"publishConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>2&&void 0!==s[2]?s[2]:[],i=s.length>3?s[3]:void 0,a=s.length>4?s[4]:void 0,e.t0=this,!this.config.address){e.next=8;break}e.t1=this.buildPublishConfigTransaction(this.config,t,n),e.next=11;break;case 8:return e.next=10,this.buildPublishSignersTransaction(t,n,r);case 10:e.t1=e.sent;case 11:return e.t2=e.t1,e.t3=void 0,e.t4=void 0,e.t5=i,e.t6=a,e.abrupt("return",e.t0.sendTransaction.call(e.t0,e.t2,e.t3,e.t4,e.t5,e.t6));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"buildUpdateConfigTransaction",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o,u,c,l,f,d,h=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>1&&void 0!==h[1]&&h[1],r=h.length>2?h[2]:void 0,i=this,this.context.nonStrict||Ct(t)){e.next=5;break}throw new Error("wallet config is not usable (strict mode)");case 5:return e.next=7,(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.provider.getStorageAt(i.address,fe.$.encode(["address"],[i.address]));case 3:return t=e.sent,e.abrupt("return",0===Nt(t,i.context.mainModuleUpgradable));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))();case 7:if(a=e.sent,s=new we.vU(g.mainModule.abi),o=2*(1e5+1800*t.signers.length),u=a?[]:[{delegateCall:!1,revertOnError:!0,gasLimit:he._Y,to:this.address,value:he._Y,data:s.encodeFunctionData(s.getFunction("updateImplementation"),[this.context.mainModuleUpgradable])}],c=new we.vU(g.mainModuleUpgradable.abi),l={delegateCall:!1,revertOnError:!0,gasLimit:he._Y,to:this.address,value:he._Y,data:c.encodeFunctionData(c.getFunction("updateImageHash"),[St(t)])},!n){e.next=19;break}return e.next=16,this.buildPublishConfigTransaction(t,r);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:if(f=e.t0,1!==(d=[].concat(u,[l],(0,R.Z)(f))).length){e.next=24;break}return e.abrupt("return",d);case 24:return e.abrupt("return",[{delegateCall:!1,revertOnError:!1,gasLimit:o,to:this.address,value:he._Y,data:s.encodeFunctionData(s.getFunction("selfExecute"),[Fn(d)])}]);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildPublishConfigTransaction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=new we.vU(g.sequenceUtils.abi);return[{delegateCall:!1,revertOnError:!0,gasLimit:he._Y,to:this.context.sequenceUtils,value:he._Y,nonce:n,data:r.encodeFunctionData(r.getFunction("publishConfig"),[this.address,e.threshold,_t(e).signers.map((function(e){return{weight:e.weight,signer:e.address}})),t])}]}},{key:"buildPublishSignersTransaction",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n,r,i,a,s,o,u,c,l,f,d=this,h=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(h.length>0&&void 0!==h[0])||h[0],n=h.length>1?h[1]:void 0,r=h.length>2&&void 0!==h[2]?h[2]:[],a=new we.vU(g.sequenceUtils.abi),s=new we.vU(g.requireFreshSigner.abi),o=En.O(32),e.next=8,this.signMessage(o,this.chainId,!1);case 8:if(u=e.sent,c=Bt(u),l=Vt({threshold:c.threshold,signers:c.signers.map((function(e,t){if(Lt(e)){var n=d.config.signers[t];return{weight:n.weight,address:n.address}}return e}))}),f=null==(i=this.context.libs)?void 0:i.requireFreshSigner,!(r.length>0&&void 0===f)){e.next=14;break}throw Error("requireFreshSigners missing library");case 14:return e.abrupt("return",[].concat((0,R.Z)(r.map((function(e){return{delegateCall:!1,revertOnError:!0,gasLimit:he._Y,to:f,value:he._Y,nonce:n,data:s.encodeFunctionData(s.getFunction("requireFreshSigner"),[e])}}))),[{delegateCall:!1,revertOnError:!0,gasLimit:he._Y,to:this.context.sequenceUtils,value:he._Y,nonce:n,data:a.encodeFunctionData(a.getFunction("publishInitialSigners"),[this.address,F.keccak256(o),this.config.signers.length,l,t])}]));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainIdNumber",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,this.getChainId();case 3:return e.abrupt("return",e.sent);case 4:if(n=Ce(t),!this.context.nonStrict){e.next=7;break}return e.abrupt("return",n);case 7:return e.next=9,this.getChainId();case 9:if((r=e.sent)===n){e.next=12;break}throw new Error("the specified chainId ".concat(n," does not match the wallet's connected chainId ").concat(r));case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"packMsgAndSig",value:function(e,t,n){return fe.$.encode(["address","uint256","bytes","bytes"],[this.address,n,e,t])}},{key:"signTransaction",value:function(e){throw new Error("signTransaction method is not supported in Wallet, please use signTransactions(...)")}},{key:"hasEnoughSigners",value:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.getChainIdNumber(t);case 3:return e.next=5,this.signWeight();case 5:return e.abrupt("return",e.sent.gte(this.config.threshold));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"singleOwner",value:function(){var e=(0,D.Z)(W().mark((function e(t,r){var i,a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=oe.E.isSigner(t)?t:new H.Wallet(t),e.t0=U,e.next=4,i.getAddress();case 4:return e.t1=e.sent,e.t2=e.t0.getAddress.call(e.t0,e.t1),e.t3={weight:1,address:e.t2},e.t4=[e.t3],a={threshold:1,signers:e.t4},e.abrupt("return",new n({config:a,context:r},i));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Sr),Pr=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;(0,y.Z)(this,n),(r=t.call(this)).options=void 0,r._wallets=void 0,r._signers=void 0,r.provider=void 0,r._chainId=void 0,r.options=e;for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return r._signers=a,e.context||(r.options.context=Ir({},We)),r.options.networks?r.setNetworks(r.options.networks):r.setNetworks((0,R.Z)(De)),r}return(0,m.Z)(n,[{key:"useSigners",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._signers=t,this._wallets.forEach((function(e){var n;e.wallet=(n=e.wallet).useSigners.apply(n,t)})),this}},{key:"getWalletContext",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.options.context);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getConfigFinder",value:function(){return this.options.configFinder?this.options.configFinder:new Rt(this.authWallet().wallet.provider)}},{key:"getWalletConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t?(r=this.getWalletByNetwork(t))&&n.push(r):n=this._wallets,e.next=4,Promise.all(n.map((function(e){return e.wallet.getWalletConfig()})));case 4:return e.abrupt("return",e.sent.flat());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletState",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o,u=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t?(r=this.getWalletByNetwork(t))&&n.push(r):n=this._wallets,i=Promise.all(n.map((function(e){return u.getConfigFinder().findCurrentConfig({address:e.wallet.address,provider:e.wallet.provider,context:e.wallet.context,knownConfigs:[e.wallet.config]})}))),e.next=5,Promise.all(n.map((function(e){return e.wallet.getWalletState()})));case 5:if(a=e.sent.flat(),!((s=a.findIndex((function(e){return e.chainId===u.getAuthChainId()})))>=0)){e.next=11;break}return e.next=10,this.currentConfig(n[s].wallet);case 10:a[s].config=e.sent;case 11:return e.next=13,i;case 13:return o=e.sent,e.abrupt("return",a.map((function(e,t){var n;return Ir({},e,{config:null==(n=o[t])?void 0:n.config})})));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"address",get:function(){return this._wallets[0].wallet.address}},{key:"getAddress",value:function(){return this._wallets[0].wallet.getAddress()}},{key:"getSigners",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._wallets[0].wallet.getSigners());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getProvider",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null==(n=this.mainWallet())?void 0:n.wallet.getProvider());case 2:return e.abrupt("return",null==(r=this._wallets.find((function(e){return e.network.chainId===t})))?void 0:r.wallet.getProvider());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayer",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null==(n=this.mainWallet())?void 0:n.wallet.getRelayer());case 2:return e.abrupt("return",null==(r=this._wallets.find((function(e){return e.network.chainId===t})))?void 0:r.wallet.getRelayer());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.options.networks);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainId",value:function(){var e=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._chainId){e.next=2;break}return e.abrupt("return",this._chainId);case 2:return e.next=4,this.provider.getNetwork();case 4:return t=e.sent,this._chainId=t.chainId,e.abrupt("return",this._chainId);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAuthChainId",value:function(){try{return this.options.networks.find((function(e){return e.isAuthChain})).chainId}catch(Oa){throw new Error("no auth network")}}},{key:"signMessage",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(l.length>2&&void 0!==l[2])||l[2],i=l.length>3&&void 0!==l[3]&&l[3],a=this,e.next=5,(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",a.mainWallet());case 2:if(!n.address){e.next=7;break}return e.next=5,n.getChainId();case 5:return t=e.sent,e.abrupt("return",a.getWalletByNetwork(t));case 7:return e.abrupt("return",a.getWalletByNetwork(n));case 8:case"end":return e.stop()}}),e)})))();case 5:return s=e.sent,o=s.wallet,e.next=9,this.currentConfig(o);case 9:return u=(u=e.sent)||this._wallets[0].wallet.config,o=o.useConfig(u),e.next=14,o.signWeight();case 14:if(!(c=e.sent).lt(o.config.threshold)||!1===r){e.next=17;break}throw new Or("Sign message - wallet combined weight ".concat(c.toString()," below required ").concat(o.config.threshold.toString()));case 17:return e.abrupt("return",o.signMessage(t,void 0,r,i));case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signAuthMessage",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(a.length>1&&void 0!==a[1])||a[1],r=a.length>2&&void 0!==a[2]&&a[2],e.abrupt("return",this.signMessage(t,null==(i=this.authWallet())?void 0:i.wallet,n,r));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i){var a,s,o,u=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(u.length>4&&void 0!==u[4])||u[4],s=i?this.getWalletByNetwork(i).wallet:this.mainWallet().wallet,o=(0,ge.encodeTypedDataDigest)({domain:t,types:n,message:r}),e.abrupt("return",this.signMessage(o,s,a,!0));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_signTypedData",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i){var a,s=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(s.length>4&&void 0!==s[4])||s[4],e.abrupt("return",this.signTypedData(t,n,r,i,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"hasEnoughSigners",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,e.next=3,this.currentConfig(n);case 3:return r=e.sent,e.abrupt("return",n.useConfig(r).hasEnoughSigners());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeeOptions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,d=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(d.length>2&&void 0!==d[2])||d[2],a=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,s=this.options.context){e.next=5;break}throw new Error("missing wallet context");case 5:return e.next=7,Promise.all([this.currentConfig(a),this.prependConfigUpdate(t,n,i,!0)]);case 7:if(o=e.sent,u=(0,P.Z)(o,2),c=u[0],l=u[1],c){e.next=13;break}throw new Error("missing current config for chain ".concat(n));case 13:return e.next=15,$n(s,this.address,l);case 15:return f=e.sent,e.abrupt("return",(r=a.relayer).getFeeOptions.apply(r,[c,s].concat((0,R.Z)(f))));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(l.length>2&&void 0!==l[2])||l[2],i=l.length>3?l[3]:void 0,a=l.length>4?l[4]:void 0,e.next=5,this.signTransactions(t,n,r);case 5:return s=e.sent,a&&(o=It(s.config,s.context),u=An.apply(void 0,[o,s.chainId].concat((0,R.Z)(s.transactions))),a(s,u)),c=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.abrupt("return",c.sendSignedTransactions(s,n,i));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendTransactionBatch",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(s.length>2&&void 0!==s[2])||s[2],i=s.length>3?s[3]:void 0,a=s.length>4?s[4]:void 0,e.abrupt("return",this.sendTransaction(t,n,r,i,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signTransactions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.next=3,this.currentConfig(i);case 3:if(a=e.sent){e.next=10;break}return e.next=7,this.currentConfig();case 7:if(a=e.sent){e.next=10;break}throw new Error("missing auth chain config");case 10:return e.next=12,this.prependConfigUpdate(t,n,r);case 12:return s=e.sent,e.abrupt("return",i.useConfig(a).signTransactions(s));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"prependConfigUpdate",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i){var a,s,o,u,c,l,f,d;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tr(t);case 2:return a=e.sent,s=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.next=6,Promise.all([this.currentConfig(s),this.currentConfig()]);case 6:if(o=e.sent,u=(0,P.Z)(o,2),c=u[0],l=u[1],i){e.next=16;break}return e.next=13,s.useConfig(c).signWeight();case 13:if(!(f=e.sent).lt(c.threshold)||!r){e.next=16;break}throw new Or("wallet combined weight ".concat(f.toString()," below required threshold ").concat(c.threshold.toString()));case 16:return e.next=18,s.isDeployed();case 18:if(e.t0=e.sent,!e.t0){e.next=21;break}e.t0=Ot(l,c);case 21:if(!e.t0){e.next=23;break}return e.abrupt("return",a);case 23:return d=Array.isArray(a)?a:[a],e.t1=[],e.t2=R.Z,e.next=28,s.buildUpdateConfigTransaction(l,!1);case 28:return e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t5=(0,R.Z)(d),e.abrupt("return",e.t1.concat.call(e.t1,e.t4,e.t5));case 32:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"sendSignedTransactions",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.abrupt("return",i.sendSignedTransactions(t,void 0,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i){var a,s,o,u,c;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.authWallet().wallet,t=t?_t(t):a.config,!Ot(a.config,t)){e.next=9;break}return e.next=5,this.isDeployed();case 5:if(e.sent){e.next=9;break}return e.next=8,a.updateConfig(t,void 0,!0,n,r,i);case 8:return e.abrupt("return",e.sent);case 9:return e.next=11,this.currentConfig();case 11:if(s=e.sent,!Ot(s,t)){e.next=14;break}return e.abrupt("return",[Ir({},s,{address:this.address}),void 0]);case 14:return e.next=16,a.useConfig(s).updateConfig(t,void 0,!0,n,r,i);case 16:return o=e.sent,u=(0,P.Z)(o,2),u[0],c=u[1],e.abrupt("return",[Ir({},t,{address:this.address}),c]);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"publishConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return this.authWallet().wallet.publishConfig(e,void 0,t,n,r)}},{key:"isDeployed",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?t.address?t:r.getWalletByNetwork(t).wallet:r.authWallet().wallet,e.abrupt("return",n.isDeployed());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"currentConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?t.address?t:r.getWalletByNetwork(t).wallet:r.authWallet().wallet,e.next=3,this.getConfigFinder().findCurrentConfig({address:this.address,provider:n.provider,context:n.context,knownConfigs:[n.config]});case 3:return e.abrupt("return",e.sent.config);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWallets",value:function(){return this._wallets}},{key:"getWalletByNetwork",value:function(e){var t=Ce(e),n=this._wallets.find((function(e){return e.network.chainId===t}));if(!n)throw new Error("network ".concat(e," not found in wallets list"));return n}},{key:"mainWallet",value:function(){var e=this._wallets.find((function(e){return e.network.isDefaultChain}));if(!e)throw new Error("mainWallet not found");return e}},{key:"authWallet",value:function(){var e=this._wallets.find((function(e){return e.network.isAuthChain}));if(!e)throw new Error("authChain wallet not found");return e}},{key:"setNetworks",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=[];if(this._chainId=void 0,r){var a=parseInt(r),s=e.find((function(e){return e.name===r||e.chainId===a})),o=n.find((function(e){return e.name===r||e.chainId===a}));if(!s&&!o)throw new Error("unable to set default network as chain '".concat(r,"' does not exist"));s?(e.forEach((function(e){return e.isDefaultChain=!1})),s.isDefaultChain=!0,i=e):o&&(n.forEach((function(e){return e.isDefaultChain=!1})),o.isDefaultChain=!0,i=n)}else i=e;return this.options.networks=_e(Me(i)),this._wallets=this.options.networks.map((function(e){var n=(0,M.Z)(Ar,[{config:t.options.initialConfig,context:t.options.context}].concat((0,R.Z)(t._signers)));if(e.provider)n.setProvider(e.provider);else{if(!e.rpcUrl||""===e.rpcUrl)throw new Error("network config is missing provider settings for chainId ".concat(e.chainId));n.setProvider(e.rpcUrl)}if(Er(e.relayer))n.setRelayer(e.relayer);else{if(!br(e.relayer))throw new Error("network config is missing relayer settings for chainId ".concat(e.chainId));n.setRelayer(new xr(Ir({provider:n.provider},e.relayer)))}return e.isDefaultChain&&(t._chainId=e.chainId,t.provider=n.provider),{network:e,wallet:n}})),this.options.networks.find((function(e){return e.isDefaultChain})).chainId}},{key:"connect",value:function(e){throw new Error("connect method is not supported in MultiWallet")}},{key:"signTransaction",value:function(e){throw new Error("signTransaction method is not supported in MultiWallet, please use signTransactions(...)")}}]),n}(Sr);function Mr(e,t,n,r,i,a){return Rr.apply(this,arguments)}function Rr(){return Rr=(0,D.Z)(W().mark((function e(t,n,r,i,a,s){var o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Dr(t,n,r)&&!qr(t,n,r)){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,Wr(t,n,r,i);case 4:if(void 0!==(o=e.sent)){e.next=7;break}return e.abrupt("return",Lr(t,n,r,a,i,s));case 7:return e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)}))),Rr.apply(this,arguments)}function Dr(e,t,n){try{return 0===Nt(de.recoverAddress(t,B.splitSignature(n)),e)}catch(Oa){return!1}}function qr(e,t,n){try{var r=F.keccak256(le.pack(["string","bytes32"],["\x19Ethereum Signed Message:\n32",t]));return 0===Nt(de.recoverAddress(r,B.splitSignature(n)),e)}catch(i){return!1}}function Wr(e,t,n,r){return Ur.apply(this,arguments)}function Ur(){return Ur=(0,D.Z)(W().mark((function e(t,n,r,i){var a,s;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.prev=2,e.next=5,i.getCode(t);case 5:if(e.t0=e.sent,"0x"!==e.t0){e.next=8;break}return e.abrupt("return",void 0);case 8:return a=new L.CH(t,g.erc1271.abi,i),e.next=11,a.isValidSignature(n,r);case 11:return s=e.sent,e.abrupt("return",g.erc1271.returns.isValidSignatureBytes32===s);case 15:return e.prev=15,e.t1=e.catch(2),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[2,15]])}))),Ur.apply(this,arguments)}function Lr(e,t,n,r,i,a){return Br.apply(this,arguments)}function Br(){return Br=(0,D.Z)(W().mark((function e(t,n,r,i,a,s){var o,u,c,l,f;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a||s){e.next=2;break}return e.abrupt("return",void 0);case 2:if(i){e.next=4;break}return e.abrupt("return",void 0);case 4:if(e.prev=4,!s){e.next=9;break}e.t0=s,e.next=12;break;case 9:return e.next=11,a.getNetwork();case 11:e.t0=e.sent.chainId;case 12:return o=e.t0,u=Bt(r),c=B.arrayify(F.keccak256((0,ge.packMessageData)(t,o,n))),e.next=17,jr(c,u,a,i,s,!0);case 17:return l=e.sent,f=u.signers.reduce((function(e,t){return Wt(t)||Lt(t)?e+t.weight:e}),0),e.abrupt("return",0===Nt(It(l,i),t)&&f>=u.threshold);case 22:return e.prev=22,e.t1=e.catch(4),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,null,[[4,22]])}))),Br.apply(this,arguments)}var Fr=function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAddress();case 2:return n=e.sent,e.t0=L.CH,e.t1=n,e.t2=g.mainModuleUpgradable.abi,e.next=8,t.getProvider();case 8:return e.t3=e.sent,r=new e.t0(e.t1,e.t2,e.t3),e.next=12,r.functions.imageHash.call([]).catch((function(){return[]}));case 12:return i=e.sent,e.abrupt("return",i&&i.length>0?i[0]:"");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Gr=function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a,s){var o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=B.arrayify(F.keccak256(t)),e.abrupt("return",jr(o,n,r,i,a,s));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),jr=function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a,s){var o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0!==n.threshold?n:Bt(n),e.next=3,Promise.all(o.signers.map(function(){var e=(0,D.Z)(W().mark((function e(n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Wt(n)){e.next=4;break}return e.abrupt("return",{weight:n.weight,address:Gt(t,n)});case 4:if(!Dt(n)){e.next=8;break}return e.abrupt("return",{weight:n.weight,address:ce.getAddress(n.address)});case 8:if(!Lt(n)){e.next=17;break}if(!s){e.next=14;break}return e.next=12,Mr(n.address,B.arrayify(t),B.hexlify(n.signature),r,i,a);case 12:if(e.sent){e.next=14;break}throw Error("Invalid signature");case 14:return e.abrupt("return",{weight:n.weight,address:n.address});case 17:throw Error("Uknown signature type");case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return u=e.sent,e.abrupt("return",{threshold:o.threshold,signers:u});case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}();function Hr(){return Hr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Hr.apply(this,arguments)}var Vr=604800,Kr=3e7,Jr=function(){function e(t,n,r,i,a,s,o,u,c){var l;((0,y.Z)(this,e),this.sequenceApiUrl=t,this.sequenceMetadataUrl=n,this.networks=r,this.config=i,this.context=a,this.account=s,this.metadata=o,this.authProvider=u,this._initialAuthRequest=void 0,this._jwt=void 0,this.proofStrings=new Map,this.onAuthCallbacks=[],this.apiClient=void 0,this.metadataClient=void 0,this.indexerClients=new Map,c)&&(this._jwt={token:Promise.resolve(c.token),expiration:null!=(l=c.expiration)?l:zr(c.token)})}return(0,m.Z)(e,[{key:"name",get:function(){return this.metadata.name}},{key:"expiration",get:function(){return this.metadata.expiration?Math.max(this.metadata.expiration,120):Vr}},{key:"onAuth",value:function(e){this.onAuthCallbacks.push(e)}},{key:"setAccount",value:function(e){this.account=e}},{key:"setConfig",value:function(e){this.config=e}},{key:"auth",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n,r,i,a=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:5,n=this.sequenceApiUrl){e.next=4;break}throw Error("No sequence api url");case 4:i=0;case 5:return e.prev=5,e.next=8,this.getJWT(!0);case 8:return r=e.sent.token,e.abrupt("break",20);case 12:if(e.prev=12,e.t0=e.catch(5),i!==t-1){e.next=17;break}throw console.error("couldn't authenticate after ".concat(t," attempts"),e.t0),e.t0;case 17:i++,e.next=5;break;case 20:return e.abrupt("return",new Z(n,r));case 21:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"isTestnetMode",get:function(){if(this.networks&&0!==this.networks.length)return!!this.networks[0].testnet}},{key:"getAPIClient",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n,r,i=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(i.length>0&&void 0!==i[0])||i[0],this.apiClient){e.next=9;break}if(n=this.sequenceApiUrl){e.next=5;break}throw Error("No chaind url");case 5:return e.next=7,this.getJWT(t);case 7:r=e.sent.token,this.apiClient=new Z(n,r);case 9:return e.abrupt("return",this.apiClient);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMetadataClient",value:function(){return this.metadataClient||(this.metadataClient=new xn(this.sequenceMetadataUrl)),this.metadataClient}},{key:"getIndexerClient",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Ze(this.networks,t)){e.next=3;break}throw Error("No network for chain ".concat(t));case 3:return e.next=5,this.getJWT(!0);case 5:if(r=e.sent.token,this.indexerClients.has(n.chainId)){e.next=16;break}if(!n.indexer){e.next=11;break}this.indexerClients.set(n.chainId,n.indexer),e.next=16;break;case 11:if(!n.indexerUrl){e.next=15;break}this.indexerClients.set(n.chainId,new fn(n.indexerUrl,r)),e.next=16;break;case 15:throw Error("No indexer url for chain ".concat(t));case 16:return e.abrupt("return",this.indexerClients.get(n.chainId));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJWT",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o,u,c,l,f,d=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,r=this.sequenceApiUrl){e.next=4;break}throw Error("No chaind url");case 4:if(!this._jwt){e.next=12;break}return i=this._jwt,e.next=8,i.token;case 8:if(a=e.sent,!(this.now()<i.expiration)){e.next=11;break}return e.abrupt("return",{token:a,expiration:i.expiration});case 11:this._jwt=void 0;case 12:if(t){e.next=14;break}throw new Error("no auth token in memory");case 14:return s=this.getProofStringKey(),o=this.getProofString(s),u=o.proofString,c=o.expiration,l={token:u.then(function(){var e=(0,D.Z)(W().mark((function e(t){var i,a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Z(r),e.next=3,i.getAuthToken({ewtString:t,testnetMode:n.isTestnetMode});case 3:if(!0!==(null==(a=e.sent)?void 0:a.status)||0===a.jwtToken.length){e.next=8;break}return e.abrupt("return",a.jwtToken);case 8:return e.next=10,n.isProofStringValid(t);case 10:if(e.sent){e.next=12;break}n.proofStrings.delete(s);case 12:throw new Error("no auth token from server");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw d._jwt=void 0,e})),expiration:c},this._jwt=l,l.token.then((function(){d.onAuthCallbacks.forEach((function(e){try{e({status:"fulfilled",value:void 0})}catch(Oa){}}))})).catch((function(e){d.onAuthCallbacks.forEach((function(t){try{t({status:"rejected",reason:e})}catch(n){}}))})),e.next=21,l.token;case 21:return f=e.sent,e.abrupt("return",{token:f,expiration:c});case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProofString",value:function(e){var t=this;if(this.proofStrings.has(e)){var n=this.proofStrings.get(e);if(this.now()<n.expiration)return n;this.proofStrings.delete(e)}var r=new Q({address:this.account.address});r.claims.app=this.name,r.setExpiryIn(this.expiration);var i=new se,a=new Rt(this.authProvider),s=this.account.authWallet(),o=this.now()+this.expiration-60,u={proofString:a.findCurrentConfig({address:s.wallet.address,provider:this.authProvider,context:s.wallet.context,knownConfigs:[s.wallet.config]}).then((function(e){if(!e.config)throw Error("Can't find latest config");return s.wallet.useConfig(e.config).sign(r.messageDigest()).then((function(e){var t=Bt(e),n=t.signers.filter(qt).reduce((function(e,t){return e+t.weight}),0);if(n<t.threshold)throw Error("insufficient signing power, need ".concat(t.threshold,", have ").concat(n));return r.signature=e,i.encodeProof(r,!0)}))})).catch((function(n){throw t.proofStrings.delete(e),n})),expiration:o};return this.proofStrings.set(e,u),u}},{key:"getProofStringKey",value:function(){return"".concat(this.account.address," - ").concat(this.name)}},{key:"isProofStringValid",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new se).provider=this.authProvider,e.next=5,n.decodeProof(t);case 5:return e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"dump",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._jwt){e.next=12;break}return e.prev=1,n=this._jwt.expiration,e.next=5,this._jwt.token;case 5:e.t0=e.sent,e.t1=n,t={token:e.t0,expiration:e.t1},e.next=12;break;case 10:e.prev=10,e.t2=e.catch(1);case 12:return e.abrupt("return",{config:this.config,context:this.context,metadata:this.metadata,jwt:t});case 13:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"now",value:function(){return Math.floor((new Date).getTime()/1e3)}}],[{key:"open",value:function(){var t=(0,D.Z)(W().mark((function t(n){var r,i,a,s,o,u,c,l,f,d,h,p,g,v,w,y,m,k,b,x,C,E,I,S,_;return W().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.sequenceApiUrl,i=n.sequenceMetadataUrl,a=n.context,s=n.networks,o=n.referenceSigner,u=n.signers,c=n.threshold,l=n.deepSearch,f=n.knownConfigs,d=n.noIndex,h=n.metadata,p=$r(s),g=n.configFinder?n.configFinder:new Rt(p),v=Promise.all(u.map(function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Hr,e.t1={},e.t2=t,"string"!==typeof t.signer){e.next=7;break}e.t3=t.signer,e.next=10;break;case 7:return e.next=9,t.signer.getAddress();case 9:e.t3=e.sent;case 10:return e.t4=e.t3,e.t5={address:e.t4},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t5));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),w=u.filter((function(e){return"string"!==typeof e.signer})).map((function(e){return e.signer})),t.next=7,g.findLastWalletOfInitialSigner({signer:o,context:a,provider:p,requireIndex:!l});case 7:if(!(y=t.sent.wallet)){t.next=37;break}return t.next=11,g.findCurrentConfig({address:y,provider:p,context:a,knownConfigs:f});case 11:if(m=t.sent.config){t.next=14;break}throw Error("Wallet config not found");case 14:return k=(0,M.Z)(Pr,[{initialConfig:m,networks:s,context:a}].concat((0,R.Z)(w))),b=new e(r,i,s,m,a,k,h,p),t.t0=k,t.t1=Tt,t.t2=m,t.t3=c,t.next=22,v;case 22:return t.t4=t.sent,t.t5={threshold:t.t3,set:t.t4},t.t6=(0,t.t1)(t.t2,t.t5),t.t7=!d,t.next=28,t.t0.updateConfig.call(t.t0,t.t6,t.t7);case 28:return x=t.sent,C=(0,P.Z)(x,1),E=C[0],b.setConfig(E),b.setAccount((0,M.Z)(Pr,[{initialConfig:E,networks:s,context:a}].concat((0,R.Z)(w)))),b._initialAuthRequest=r?b.auth():Promise.reject("no sequence api url"),t.abrupt("return",b);case 37:return t.t8=Zt,t.t9=c,t.next=41,v;case 41:return t.t10=t.sent,I=(0,t.t8)(t.t9,t.t10),S=(0,M.Z)(Pr,[{initialConfig:I,networks:s,context:a}].concat((0,R.Z)(w))),t.next=46,S.publishConfig(!d,[o]);case 46:return(_=new e(r,i,s,I,a,S,h,p))._initialAuthRequest=r?_.auth():Promise.reject("no sequence api url"),t.abrupt("return",_);case 49:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"load",value:function(t){var n=t.sequenceApiUrl,r=t.sequenceMetadataUrl,i=t.dump,a=t.signers,s=t.networks;return new e(n,r,s,i.config,i.context,(0,M.Z)(Pr,[{initialConfig:i.config,context:i.context,networks:s}].concat((0,R.Z)(a))),i.metadata,$r(s),i.jwt)}}]),e}();function $r(e){var t,n=Ie(e);if(!n)throw Error("Auth chain not found");return null!=(t=n.provider)?t:new G.r(n.rpcUrl)}function zr(e){return(0,ge.jwtDecodeClaims)(e).exp}var Yr=function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getChainId();case 2:return r=e.sent,e.t0=U,e.next=6,t.getAddress();case 6:if(e.t1=e.sent,(i=e.t0.getAddress.call(e.t0,e.t1))&&""!==i&&"0x"!==i){e.next=10;break}throw Xr;case 10:if((a=new Q).address=i,n&&n.app&&""!==n.app){e.next=14;break}throw new Qr("authorization options requires app to be set");case 14:return a.claims.app=n.app,a.claims.ogn=n.origin,a.setExpiryIn(n.expiry?Math.max(n.expiry,200):Vr),s=a.messageTypedData(),e.next=20,t.signTypedData(s.domain,s.types,s.message,r);case 20:return a.signature=e.sent,o=new se,e.next=24,o.encodeProof(a,!0);case 24:return u=e.sent,e.abrupt("return",{typedData:s,proofString:u});case 26:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Qr=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).name="AuthError",r}return(0,m.Z)(n)}((0,A.Z)(Error)),Xr=new Qr("auth error: account address is empty"),ei=function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s,o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&void 0!==t&&void 0!==n){e.next=2;break}return e.abrupt("return",{isValid:!1});case 2:return i=r.messageDigest(),e.next=5,t.getCode(r.address);case 5:if(!("0x"===(a=e.sent)||a.length<=2)){e.next=8;break}throw new Error("ValidateSequenceDeployedWalletProof failed. unable to fetch wallet contract code");case 8:return s=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],o=new L.CH(r.address,s,t),e.next=12,o.isValidSignature(i,B.arrayify(r.signature));case 12:if(e.sent!==ne){e.next=17;break}return e.abrupt("return",{isValid:!0});case 17:return e.abrupt("return",{isValid:!1});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ti=function(e){return function(){var t=(0,D.Z)(W().mark((function t(n,r,i){var a,s,o;return W().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&void 0!==n&&void 0!==r){t.next=2;break}return t.abrupt("return",{isValid:!1});case 2:return t.t0=U,t.next=5,n.getCode(i.address);case 5:if(t.t1=t.sent,0===t.t0.arrayify.call(t.t0,t.t1).length){t.next=9;break}return t.abrupt("return",{isValid:!1});case 9:return a=i.messageDigest(),s=B.arrayify(F.keccak256(a)),t.next=13,Lr(i.address,s,i.signature,e||We,n,r);case 13:return o=t.sent,t.abrupt("return",{isValid:!!o});case 15:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()};function ni(){return ni=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ni.apply(this,arguments)}var ri="v1",ii="v0.1.0",ai="8d4d548d0af400f36ef39a21c29927fe65f9396c",si=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/GuarddService/",this.sign=function(e,t){return r.fetch(r.url("Sign"),oi(e,t)).then((function(e){return ui(e).then((function(e){return{sig:e.sig}}))}))},this.hostname=t,this.fetch=n}return(0,m.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),oi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:ni({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},ui=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},ci=n(7371),li=n(5889),fi=n(723);function di(){return di=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},di.apply(this,arguments)}var hi,pi,gi,vi=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,null,[{key:"new",value:function(e){return new URLSearchParams(e)}}]),n}((0,A.Z)(URLSearchParams));!function(e){e.OPEN="open",e.CLOSE="close",e.MESSAGE="message",e.CONNECT="connect",e.DISCONNECT="disconnect",e.ACCOUNTS_CHANGED="accountsChanged",e.CHAIN_CHANGED="chainChanged",e.NETWORKS="networks",e.WALLET_CONTEXT="walletContext",e.INIT="init",e.DEBUG="_debug"}(hi||(hi={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.OPENING=1]="OPENING",e[e.OPENED=2]="OPENED"}(pi||(pi={})),function(e){e[e.NIL=0]="NIL",e[e.SENT_NONCE=1]="SENT_NONCE",e[e.OK=2]="OK"}(gi||(gi={}));var wi=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).name="ProviderError",r}return(0,m.Z)(n)}((0,A.Z)(Error)),yi=new wi("Wallet is not signed in. Connect a wallet and try again."),mi=3e4,ki=0,bi=function(){return++ki},xi=function(){function e(){(0,y.Z)(this,e);var t=this;this.pendingMessageRequests=[],this.responseCallbacks=new Map,this.state=void 0,this.confirmationOnly=!1,this.events=new ci.EventEmitter2,this.openPayload=void 0,this.connectPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this._sessionId=void 0,this._init=void 0,this._registered=void 0,this.sendAsync=function(){var e=(0,D.Z)(W().mark((function e(n,r,i){var a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state===pi.CLOSED&&(t.confirmationOnly=!0),t.openWallet(void 0,{type:"jsonRpcRequest",method:n.method},i),e.prev=2,t.isOpened()){e.next=6;break}return e.next=6,t.waitUntilOpened();case 6:return e.next=8,t.sendMessageRequest({idx:bi(),type:hi.MESSAGE,data:n,chainId:i});case 8:a=e.sent,r(void 0,a.data),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r(e.t0);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendMessageRequest=function(){var e=(0,D.Z)(W().mark((function e(n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){(!n.idx||n.idx<=0)&&"init"!==n.type&&r(new Error("message idx not set"));var i=n.idx;t.responseCallbacks.get(i)?r(new Error("duplicate message idx, should never happen")):t.responseCallbacks.set(i,(function(t,n){if(t)r(t);else{if(!n)throw new Error("no valid response to return");e(n)}})),t.isOpened()?t.sendMessage(n):(ge.logger.debug("pushing to pending requests",n),t.pendingMessageRequests.push(n))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.waitUntilOpened=(0,D.Z)(W().mark((function e(){var n,r,i=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>0&&void 0!==i[0]?i[0]:mi,r=!1,e.abrupt("return",Promise.race([new Promise((function(e,i){var a=setTimeout((function(){clearTimeout(a),r||(t.state=pi.CLOSED,t.events.emit("close",{code:1005,message:"opening wallet timed out"})),i(new Error("opening wallet timed out"))}),n)})),new Promise((function(e){var n;if(t.isOpened())return r=!0,void e(null==(n=t.openPayload)?void 0:n.session);t.events.once("open",(function(n){t.openPayload=n,r=!0,e(n.session)}))}))]));case 3:case"end":return e.stop()}}),e)}))),this.waitUntilConnected=(0,D.Z)(W().mark((function e(){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.waitUntilOpened();case 2:return n=new Promise((function(e){t.connectPayload?e(t.connectPayload):t.events.once("connect",(function(n){t.connectPayload=n,e(n)}))})),r=new Promise((function(e,n){t.events.once("close",(function(e){n(e?new Error("wallet closed due to ".concat(JSON.stringify(e))):new Error("user closed the wallet"))}))})),e.abrupt("return",Promise.race([n,r]));case 5:case"end":return e.stop()}}),e)}))),this.state=pi.CLOSED,this._registered=!1,this._init=gi.NIL}return(0,m.Z)(e,[{key:"registered",get:function(){return this._registered}},{key:"register",value:function(){throw new Error("abstract method")}},{key:"unregister",value:function(){throw new Error("abstract method")}},{key:"openWallet",value:function(e,t,n){throw new Error("abstract method")}},{key:"closeWallet",value:function(){throw new Error("abstract method")}},{key:"isOpened",value:function(){return this.registered&&this.state===pi.OPENED}},{key:"isConnected",value:function(){var e,t=null==(e=this.openPayload)?void 0:e.session;return this.registered&&void 0!==t&&!!t.accountAddress&&42===t.accountAddress.length&&!!t.networks&&t.networks.length>0}},{key:"handleMessage",value:function(e){var t=this,n=this;if(e.type===hi.INIT){ge.logger.debug("MessageProvider, received INIT message",e);var r=e.data.nonce;if(!r||0==r.length)return void ge.logger.error("invalid init nonce");this._init=gi.OK,this.sendMessage({idx:-1,type:hi.INIT,data:{sessionId:this._sessionId,nonce:r}})}if(this._init===gi.OK){ge.logger.debug("RECEIVED MESSAGE FROM WALLET",e.idx,e);var i=e.idx,a=this.responseCallbacks.get(i);if(i&&this.responseCallbacks.delete(i),e.type!==hi.OPEN||this.isOpened()){if(e.type===hi.MESSAGE){if(this.confirmationOnly&&setTimeout((function(){0===t.responseCallbacks.size&&t.closeWallet()}),500),!a)throw new Error("impossible state");if(a)return this.events.emit("message",e),void a(e.data.error,e)}if(e.type===hi.ACCOUNTS_CHANGED)return this.accountsChangedPayload={accounts:[]},void(e.data&&e.data.length>0?(this.accountsChangedPayload={accounts:[ce.getAddress(e.data[0])],origin:e.origin},this.events.emit("accountsChanged",this.accountsChangedPayload.accounts,this.accountsChangedPayload.origin)):this.events.emit("accountsChanged",[],e.origin));if(e.type!==hi.CHAIN_CHANGED){if(e.type===hi.NETWORKS)return this.networksPayload=e.data,void this.events.emit("networks",this.networksPayload);if(e.type===hi.WALLET_CONTEXT)return this.walletContextPayload=e.data,void this.events.emit("walletContext",this.walletContextPayload);e.type===hi.CLOSE&&this.state!==pi.CLOSED&&this.close(e.data),e.type===hi.CONNECT&&(this.connectPayload=e.data,this.events.emit("connect",this.connectPayload)),e.type===hi.DISCONNECT&&this.isConnected()&&(this.events.emit("disconnect",e.data),this.close())}else this.events.emit("chainChanged",e.data)}else{var s,o;if(this._sessionId&&this._sessionId!==(null==(s=e.data)?void 0:s.sessionId))return void ge.logger.debug("open event received from wallet, but does not match sessionId",this._sessionId);if(null!=(o=e.data)&&o.error){var u,c=new Error("opening wallet failed: received ".concat(null==(u=e.data)?void 0:u.error));throw ge.logger.error(c),this.close(),c}this.state=pi.OPENED,this.openPayload=e.data,this.events.emit("open",this.openPayload),0!==this.pendingMessageRequests.length&&this.pendingMessageRequests.splice(0,this.pendingMessageRequests.length).forEach(function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.sendMessage(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}}},{key:"sendMessage",value:function(e){throw new Error("abstract method")}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=this.events).emit.apply(t,[e].concat(r))}},{key:"close",value:function(e){this.state!==pi.CLOSED&&(this.state=pi.CLOSED,this.confirmationOnly=!1,this._sessionId=void 0,ge.logger.info("closing wallet and flushing!"),this.pendingMessageRequests.length=0,this.responseCallbacks.forEach((function(e){e(di({},new Error("wallet closed"),{code:4001}))})),this.responseCallbacks.clear(),this.connectPayload=void 0,this.openPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this.events.emit("close",e))}}]),e}(),Ci=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];(0,y.Z)(this,e);var a=this;this.signer=void 0,this.signerReadyCallbacks=[],this.prompter=void 0,this.mainnetNetworks=void 0,this.testnetNetworks=void 0,this._openIntent=void 0,this._connectOptions=void 0,this._defaultNetworkId=void 0,this._chainId=void 0,this.events=new ci.EventEmitter2,this.promptConnect=function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||a._connectOptions){e.next=2;break}throw new Error("prompter connect options are empty");case 2:if(a.prompter){e.next=4;break}return e.abrupt("return",a.connect(t));case 4:return e.next=6,a.prompter.promptConnect(t||a._connectOptions).catch((function(e){return{connected:!1}}));case 6:if(n=e.sent,!(r=n).connected||r.session){e.next=12;break}return e.next=11,a.walletSession();case 11:r.session=e.sent;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendAsync=function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,s,o,u,c,l,f,d,h,p,g,v,w,y,m,k,b,x,C,E,I,S,_,O,N,T,Z,A,M,R,D,q,L,B,F,G,j,H,V,K,J,$,z,Y,Q,X,ee,te,ne,re,ie,ae,se,oe,le;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={jsonrpc:"2.0",id:t.id,result:null},e.next=3,a.getSigner();case 3:if(e.prev=3,a.signer&&null!==a.signer||Ei.includes(t.method)){e.next=6;break}throw yi;case 6:if(s=a.signer){e.next=9;break}throw new Error("WalletRequestHandler: wallet signer is not configured");case 9:return e.next=11,s.getProvider(r);case 11:if(o=e.sent){e.next=14;break}throw new Error("WalletRequestHandler: wallet provider is not configured for chainId ".concat(r));case 14:e.t0=t.method,e.next="net_version"===e.t0?17:"eth_chainId"===e.t0?22:"eth_accounts"===e.t0?27:"eth_getBalance"===e.t0?32:"personal_sign"===e.t0||"eth_sign"===e.t0?38:"eth_signTypedData"===e.t0||"eth_signTypedData_v4"===e.t0?60:"eth_sendTransaction"===e.t0?85:"eth_signTransaction"===e.t0?103:"eth_sendRawTransaction"===e.t0?121:"eth_getTransactionCount"===e.t0?138:"eth_blockNumber"===e.t0?157:"eth_getBlockByNumber"===e.t0?161:"eth_getBlockByHash"===e.t0?165:"eth_getTransactionByHash"===e.t0?169:"eth_call"===e.t0?173:"eth_getCode"===e.t0?178:"eth_estimateGas"===e.t0?183:"eth_gasPrice"===e.t0?188:"wallet_switchEthereumChain"===e.t0?193:"sequence_getWalletContext"===e.t0?204:"sequence_getWalletConfig"===e.t0?208:"sequence_getWalletState"===e.t0?213:"sequence_getNetworks"===e.t0?218:"sequence_updateConfig"===e.t0?222:"sequence_publishConfig"===e.t0?224:"sequence_estimateGasLimits"===e.t0?226:"sequence_gasRefundOptions"===e.t0?227:"sequence_getNonce"===e.t0?228:"sequence_relay"===e.t0?229:"sequence_setDefaultNetwork"===e.t0?230:242;break;case 17:return e.next=19,o.send("net_version",[]);case 19:return u=e.sent,i.result=u,e.abrupt("break",246);case 22:return e.next=24,o.send("eth_chainId",[]);case 24:return c=e.sent,i.result=c,e.abrupt("break",246);case 27:return e.next=29,s.getAddress();case 29:return l=e.sent,i.result=[l],e.abrupt("break",246);case 32:return f=(0,P.Z)(t.params,2),d=f[0],h=f[1],e.next=35,o.getBalance(d,h);case 35:return p=e.sent,i.result=p.toHexString(),e.abrupt("break",246);case 38:if("personal_sign"===t.method?(v=(0,P.Z)(t.params,2),w=v[0],v[1],g=w):(y=(0,P.Z)(t.params,2),y[0],m=y[1],g=m),k="",b=Pi(g),null!==a.prompter){e.next=47;break}return e.next=44,s.signMessage(b,r);case 44:k=e.sent,e.next=54;break;case 47:return e.next=49,a.handleConfirmWalletDeployPrompt(a.prompter,s,r);case 49:if(!e.sent){e.next=54;break}return e.next=53,a.prompter.promptSignMessage({chainId:r,message:b},a.connectOptions);case 53:k=e.sent;case 54:if(!(k&&k.length>0)){e.next=58;break}i.result=k,e.next=59;break;case 58:throw new Error("declined by user");case 59:return e.abrupt("break",246);case 60:if(x=(0,P.Z)(t.params,2),x[0],C=x[1],E=void 0,"string"===typeof C)try{E=JSON.parse(C)}catch(W){}else E=C;if(E&&E.domain&&E.types&&E.message){e.next=65;break}throw new Error("invalid typedData object");case 65:if(I="",null!==a.prompter){e.next=72;break}return e.next=69,s.signTypedData(E.domain,E.types,E.message,r);case 69:I=e.sent,e.next=79;break;case 72:return e.next=74,a.handleConfirmWalletDeployPrompt(a.prompter,s,r);case 74:if(!e.sent){e.next=79;break}return e.next=78,a.prompter.promptSignMessage({chainId:r,typedData:E},a.connectOptions);case 78:I=e.sent;case 79:if(!(I&&I.length>0)){e.next=83;break}i.result=I,e.next=84;break;case 83:throw new Error("declined by user");case 84:return e.abrupt("break",246);case 85:if(S=(0,P.Z)(t.params,1),_=S[0],O="",null!==a.prompter){e.next=94;break}return e.next=90,s.sendTransaction(_,r);case 90:N=e.sent,O=N.hash,e.next=97;break;case 94:return e.next=96,a.prompter.promptSendTransaction(_,r,a.connectOptions);case 96:O=e.sent;case 97:if(!O){e.next=101;break}i.result=O,e.next=102;break;case 101:throw new Error("declined by user");case 102:return e.abrupt("break",246);case 103:return T=(0,P.Z)(t.params,1),Z=T[0],A=ce.getAddress(Z.from),e.t1=A,e.next=108,s.getAddress();case 108:if(e.t2=e.sent,e.t1===e.t2){e.next=111;break}throw new Error("sender address does not match wallet");case 111:if(null!==a.prompter){e.next=117;break}return e.next=114,s.signTransactions(Z,r);case 114:i.result=e.sent,e.next=120;break;case 117:return e.next=119,a.prompter.promptSignTransaction(Z,r,a.connectOptions);case 119:i.result=e.sent;case 120:return e.abrupt("break",246);case 121:if(!Jn(t.params[0])){e.next=133;break}return M=ue.O$.from(t.params[0].chainId).toNumber(),e.next=125,s.getRelayer(M);case 125:return e.next=127,e.sent.relay(t.params[0]);case 127:return R=e.sent,e.next=130,R;case 130:i.result=e.sent.hash,e.next=137;break;case 133:return e.next=135,o.sendTransaction(t.params[0]);case 135:D=e.sent,i.result=D.hash;case 137:return e.abrupt("break",246);case 138:return q=ce.getAddress(t.params[0]),L=t.params[1],e.t3=U,e.next=143,s.getAddress();case 143:if(e.t4=e.sent,B=e.t3.getAddress.call(e.t3,e.t4),q!==B){e.next=152;break}return e.next=148,s.getTransactionCount(L);case 148:F=e.sent,i.result=ue.O$.from(F).toHexString(),e.next=156;break;case 152:return e.next=154,o.getTransactionCount(q,L);case 154:G=e.sent,i.result=ue.O$.from(G).toHexString();case 156:return e.abrupt("break",246);case 157:return e.next=159,o.getBlockNumber();case 159:return i.result=e.sent,e.abrupt("break",246);case 161:return e.next=163,o.getBlock(t.params[0]);case 163:return i.result=e.sent,e.abrupt("break",246);case 165:return e.next=167,o.getBlock(t.params[0]);case 167:return i.result=e.sent,e.abrupt("break",246);case 169:return e.next=171,o.getTransaction(t.params[0]);case 171:return i.result=e.sent,e.abrupt("break",246);case 173:return j=(0,P.Z)(t.params,2),H=j[0],V=j[1],e.next=176,o.call(H,V);case 176:return i.result=e.sent,e.abrupt("break",246);case 178:return K=(0,P.Z)(t.params,2),J=K[0],$=K[1],e.next=181,o.getCode(J,$);case 181:return i.result=e.sent,e.abrupt("break",246);case 183:return z=(0,P.Z)(t.params,1),Y=z[0],e.next=186,o.estimateGas(Y);case 186:return i.result=e.sent,e.abrupt("break",246);case 188:return e.next=190,o.getGasPrice();case 190:return Q=e.sent,i.result=Q.toHexString(),e.abrupt("break",246);case 193:if(X=(0,P.Z)(t.params,1),(ee=X[0]).chainId&&0!==ee.chainId.length){e.next=196;break}throw new Error("invalid chainId");case 196:return te=ue.O$.from(ee.chainId),e.next=199,a.setDefaultNetwork(te.toString(),!0);case 199:if(e.sent){e.next=202;break}throw new Error("unable to set chainId ".concat(te));case 202:return i.result=null,e.abrupt("break",246);case 204:return e.next=206,s.getWalletContext();case 206:return i.result=e.sent,e.abrupt("break",246);case 208:return ne=(0,P.Z)(t.params,1),re=ne[0],e.next=211,s.getWalletConfig(re);case 211:return i.result=e.sent,e.abrupt("break",246);case 213:return ie=(0,P.Z)(t.params,1),ae=ie[0],e.next=216,s.getWalletState(ae);case 216:return i.result=e.sent,e.abrupt("break",246);case 218:return e.next=220,a.getNetworks(!0);case 220:return i.result=e.sent,e.abrupt("break",246);case 222:throw new Error("sequence_updateConfig method is not allowed from a dapp");case 224:throw new Error("sequence_publishConfig method is not allowed from a dapp");case 226:case 227:case 228:case 229:return e.abrupt("break",246);case 230:if(se=(0,P.Z)(t.params,1),oe=se[0]){e.next=233;break}throw new Error("invalid request, method argument defaultNetworkId cannot be empty");case 233:return e.next=235,a.setDefaultNetwork(oe);case 235:if(e.sent){e.next=238;break}throw new Error("unable to set default network ".concat(oe));case 238:return e.next=240,a.getNetworks(!0);case 240:return i.result=e.sent,e.abrupt("break",246);case 242:return e.next=244,o.send(t.method,t.params);case 244:le=e.sent,i.result=le;case 246:e.next=253;break;case 248:e.prev=248,e.t5=e.catch(3),ge.logger.error(e.t5),i.result=null,i.error=di({},new Error(e.t5),{code:4001});case 253:n(void 0,i);case 254:case"end":return e.stop()}}),e,null,[[3,248]])})));return function(t,n,r){return e.apply(this,arguments)}}(),this.isSignedIn=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.signerReady();case 2:return e.abrupt("return",!!a.signer);case 3:case"end":return e.stop()}}),e)}))),this.getSigner=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.signerReady();case 2:if(void 0!==a.signer){e.next=4;break}throw new Error("signerReady failed resolve");case 4:return e.abrupt("return",a.signer);case 5:case"end":return e.stop()}}),e)}))),this.signer=t,this.prompter=n,this.mainnetNetworks=r,this.testnetNetworks=i}return(0,m.Z)(e,[{key:"signIn",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s,o,u,c,l=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},this.setSigner(t),r=n.connect,i=n.mainnetNetworks,a=n.testnetNetworks,s=n.defaultNetworkId,i&&i.length>0&&(this.mainnetNetworks=i),a&&a.length>0&&(this.testnetNetworks=a),this.mainnetNetworks&&0!==this.mainnetNetworks.length||this.testnetNetworks&&0!==this.testnetNetworks.length){e.next=7;break}throw new Error("signIn failed as network configuration is empty");case 7:if(!(o=s||this._defaultNetworkId)){e.next=13;break}return e.next=11,this.setDefaultNetwork(o,!1);case 11:if(e.sent){e.next=13;break}throw new Error("WalletRequestHandler setup unable to set defaultNetworkId ".concat(o));case 13:if(!r){e.next=20;break}return u=this._connectOptions,e.next=17,this.connect(u);case 17:c=e.sent,this.notifyConnect(c),u&&!0===u.keepWalletOpened||this.notifyClose();case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){this.setSigner(null)}},{key:"signerReset",value:function(){this.signer=void 0}},{key:"signerReady",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return new Promise((function(n,r){void 0!==e.signer?n():(setTimeout((function(){void 0===e.signer&&(e.signerReadyCallbacks=[],r("signerReady timed out"))}),t),e.signerReadyCallbacks.push(n))}))}},{key:"connect",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=2;break}return e.abrupt("return",{connected:!1,chainId:"0x0",error:"unable to connect without signed in account"});case 2:return e.t0=U,e.next=5,this.getChainId();case 5:if(e.t1=e.sent,e.t2=e.t0.hexlify.call(e.t0,e.t1),n={connected:!0,chainId:e.t2},!t||!t.authorize){e.next=20;break}return r={app:t.app,origin:t.origin,expiry:t.expiry},e.prev=10,e.next=13,Yr(this.signer,r);case 13:n.proof=e.sent,e.next=20;break;case 16:return e.prev=16,e.t3=e.catch(10),ge.logger.warn("connect, signAuthorization failed for options: ".concat(JSON.stringify(t),", due to: ").concat(e.t3.message)),e.abrupt("return",{connected:!1,chainId:"0x0",error:"signAuthorization failed: ".concat(e.t3.message)});case 20:return e.next=22,this.walletSession();case 22:return n.session=e.sent,e.abrupt("return",n);case 24:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessageRequest",value:function(e){var t=this;return new Promise((function(n){t.sendAsync(e.data,(function(t,r){var i=di({},e,{data:r});n(i)}),e.chainId)}))}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"getAddress",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=4;break}return e.abrupt("return","");case 4:return e.abrupt("return",this.signer.getAddress());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainId",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=4;break}return e.abrupt("return",0);case 4:if(!this._chainId){e.next=6;break}return e.abrupt("return",this._chainId);case 6:return e.next=8,this.signer.getChainId();case 8:return this._chainId=e.sent,e.abrupt("return",this._chainId);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openIntent",get:function(){return this._openIntent}},{key:"setOpenIntent",value:function(e){this._openIntent=e}},{key:"connectOptions",get:function(){return this._connectOptions}},{key:"setConnectOptions",value:function(e){this._connectOptions=e}},{key:"defaultNetworkId",get:function(){return this._defaultNetworkId}},{key:"setDefaultNetwork",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(i.length>1&&void 0!==i[1])||i[1],t){e.next=3;break}return e.abrupt("return",void 0);case 3:if(this._defaultNetworkId=t,this._chainId=void 0,!this.signer||!this.signer.setNetworks){e.next=13;break}if(!(r=this.signer.setNetworks(this.mainnetNetworks,this.testnetNetworks,t))||!n){e.next=10;break}return e.next=10,this.notifyNetworks();case 10:return e.abrupt("return",r);case 13:return e.abrupt("return",void 0);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=3;break}return ge.logger.warn("signer not set: getNetworks is returning an empty list"),e.abrupt("return",[]);case 3:return e.next=5,this.signer.getNetworks();case 5:if(n=e.sent,!t){e.next=10;break}return e.abrupt("return",n.map((function(e){var t=di({},e);return t.provider=void 0,t.relayer=void 0,t})));case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"walletSession",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=4;break}e.t0=void 0,e.next=14;break;case 4:return e.next=6,this.signer.getWalletContext();case 6:return e.t1=e.sent,e.next=9,this.signer.getAddress();case 9:return e.t2=e.sent,e.next=12,this.getNetworks(!0);case 12:e.t3=e.sent,e.t0={walletContext:e.t1,accountAddress:e.t2,networks:e.t3};case 14:return e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyConnect",value:function(e,t){var n,r;(this.events.emit("connect",e),null!=(n=e.session)&&n.accountAddress)&&this.events.emit("accountsChanged",[null==(r=e.session)?void 0:r.accountAddress],t)}},{key:"notifyDisconnect",value:function(e){this.events.emit("accountsChanged",[],e),this.events.emit("disconnect")}},{key:"notifyNetworks",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t,e.t0){e.next=5;break}return e.next=4,this.getNetworks(!0);case 4:e.t0=e.sent;case 5:n=e.t0,this.events.emit("networks",n),n.length>0?(r=n.find((function(e){return e.isDefaultChain})),r&&this.events.emit("chainChanged",B.hexlify(r.chainId))):this.events.emit("chainChanged","0x0");case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"notifyWalletContext",value:function(){var e=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=3;break}return ge.logger.warn("signer not set: skipping to notify wallet context"),e.abrupt("return");case 3:return e.next=5,this.signer.getWalletContext();case 5:t=e.sent,this.events.emit("walletContext",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyClose",value:function(e){this.events.emit("close",e)}},{key:"setSigner",value:function(e){if(this.signer=e,void 0!==e){for(var t=0;t<this.signerReadyCallbacks.length;t++)this.signerReadyCallbacks[t]();this.signerReadyCallbacks=[]}}},{key:"handleConfirmWalletDeployPrompt",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,Ui(n,r);case 4:if(!e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:return e.next=9,t.promptConfirmWalletDeploy(r,this.connectOptions);case 9:if(!e.sent){e.next=20;break}return e.next=13,Ui(n,r);case 13:if(e.sent){e.next=19;break}return ge.logger.error("WalletRequestHandler: result for promptConfirmWalletDeploy is not correct"),e.abrupt("return",!1);case 19:return e.abrupt("return",!0);case 20:return e.abrupt("return",!1);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),Ei=["net_version","eth_chainId","eth_getBalance","eth_getTransactionCount","eth_blockNumber","eth_getBlockByNumber","eth_getBlockByHash","eth_getTransactionByHash","eth_getCode","eth_estimateGas","eth_gasPrice","sequence_getWalletContext","sequence_getNetworks","sequence_setDefaultNetwork"],Ii=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){var i;(0,y.Z)(this,n);var a=new Ve(e,Ee(r));return e=a,(i=t.call(this,e,"any"))._sender=void 0,i._isSequenceProvider=void 0,i._defaultChainId=void 0,i._sender=a,i._isSequenceProvider=!0,i._defaultChainId=Ee(r),i}return(0,m.Z)(n,[{key:"sendAsync",value:function(e,t,n){this._sender.sendAsync(e,t,n)}},{key:"send",value:function(e,t,n){return this._sender.send(e,t,n)}},{key:"request",value:function(e){return this.send(e.method,e.params||[],e.chainId)}},{key:"getSigner",value:function(){return new Oi(this,this._defaultChainId)}},{key:"getChainId",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send("eth_chainId",[]);case 2:if(t=e.sent,n=ue.O$.from(t).toNumber(),!this._defaultChainId||this._defaultChainId===n){e.next=6;break}throw new Error("provider chainId (".concat(n,") does not match provider-bound chainId ").concat(this._defaultChainId));case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"isSequenceProvider",value:function(e){return Si(e)}}]),n}(fi.Q);function Si(e){var t=e;return t&&void 0!==t.send&&!0===t._isSequenceProvider}var _i=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){(0,y.Z)(this,n);var i=new Ci(e,null,r||[]);return t.call(this,i)}return(0,m.Z)(n)}(Ii),Oi=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this)).provider=void 0,i.defaultChainId=void 0,i._address=void 0,i._index=void 0,i._context=void 0,i._networks=void 0,i._providers={},i.provider=e,i.defaultChainId=r,i}return(0,m.Z)(n,[{key:"getAddress",value:function(){var e=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._address){e.next=2;break}return e.abrupt("return",this._address);case 2:return e.next=4,this.provider.send("eth_accounts",[]);case 4:return t=e.sent,this._address=t[0],this._index=0,e.abrupt("return",ce.getAddress(this._address));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signTransaction",value:function(e){throw new Error("signTransaction is unsupported, use signTransactions instead")}},{key:"connect",value:function(e){throw new Error("unsupported: cannot alter JSON-RPC Signer connection")}},{key:"getProvider",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.getChainId();case 3:if((n=e.sent)===t){e.next=6;break}throw new Error("signer is attempting to access chain ".concat(t,", but is already bound to chain ").concat(n));case 6:return e.abrupt("return",this.provider);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSender",value:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&(!t||t!==this.defaultChainId)){e.next=2;break}return e.abrupt("return",this.provider);case 2:return this._providers[t]||(this._providers[t]=new Ii(new Ve(this.provider,t),t)),e.abrupt("return",this._providers[t]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayer",value:function(e){throw new Error("TODO")}},{key:"getWalletContext",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._context){e.next=4;break}return e.next=3,this.provider.send("sequence_getWalletContext",[]);case 3:this._context=e.sent;case 4:return e.abrupt("return",this._context);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWalletConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.send("sequence_getWalletConfig",[Ee(t)],Ee(t)||this.defaultChainId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletState",value:function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.send("sequence_getWalletState",[Ee(t)],Ee(t)||this.defaultChainId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._networks){e.next=4;break}return e.next=3,this.provider.send("sequence_getNetworks",[]);case 3:this._networks=e.sent;case 4:return e.abrupt("return",this._networks);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSigners",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNetworks();case 2:if(t=e.sent,n=t.find((function(e){return e.isAuthChain}))){e.next=6;break}throw new Error("authChainId could not be determined from network list");case 6:return e.next=8,this.getWalletConfig(n);case 8:if((r=e.sent)&&0!==r.length){e.next=11;break}throw new Error("walletConfig returned zero results for authChainId {authChainId}");case 11:return e.abrupt("return",r[0].signers.map((function(e){return e.address})));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signMessage",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Ee(n)||this.defaultChainId);case 2:return i=e.sent,a="string"===typeof t?Cn.Y0(t):t,e.next=6,this.getAddress();case 6:return s=e.sent,e.next=9,i.send("personal_sign",[B.hexlify(a),s]);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.provider,e.next=3,this.getAddress();case 3:return e.t1=e.sent,e.t2=j.E.getPayload(t,n,r),e.t3=[e.t1,e.t2],e.t4=Ee(i)||this.defaultChainId,e.next=9,e.t0.send.call(e.t0,"eth_signTypedData_v4",e.t3,e.t4);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Ee(n)||this.defaultChainId);case 2:return i=e.sent,a=this.sendUncheckedTransaction(t,n).then((function(e){return li.poll((function(){return i.getTransaction(e).then((function(t){if(null!==t)return i._wrapTransaction(t,e)}))}),{onceBlock:s.provider}).catch((function(t){throw t.transactionHash=e,t}))})),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendTransactionBatch",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tr(t);case 2:if((i=e.sent)&&0!==i.length){e.next=5;break}throw new Error("cannot send empty batch");case 5:if(!i.find((function(e){return void 0!==e.wait&&null!==e.wait}))){e.next=7;break}throw new Error("transaction request expected for sendTransactionBatch, transaction response found");case 7:return a=di({},i[0]),i.length>1&&(a.auxiliary=i.splice(1)),e.abrupt("return",this.sendTransaction(a,n,r));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signTransactions",value:function(e,t,n){return e=(0,ge.shallowCopy)(e),this.provider.send("eth_signTransaction",[e],Ee(t)||this.defaultChainId)}},{key:"sendSignedTransactions",value:function(e,t){throw new Error("TODO")}},{key:"updateConfig",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.send("sequence_updateConfig",[t],this.defaultChainId);case 2:if(n=e.sent,r=(0,P.Z)(n,2),i=r[0],null!==(a=r[1])){e.next=8;break}return e.abrupt("return",[i,void 0]);case 8:return e.next=10,this.getSender(this.defaultChainId);case 10:return s=e.sent,e.abrupt("return",[i,s._wrapTransaction(a,a.hash)]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishConfig",value:function(){var e=(0,D.Z)(W().mark((function e(){var t,n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(this.defaultChainId);case 2:return t=e.sent,e.next=5,t.send("sequence_publishConfig",[]);case 5:if(null!==(n=e.sent)){e.next=8;break}return e.abrupt("return",void 0);case 8:return e.abrupt("return",t._wrapTransaction(n,n.hash));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isDeployed",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Ee(t));case 2:return n=e.sent,e.t0=n,e.next=6,this.getAddress();case 6:return e.t1=e.sent,e.next=9,e.t0.getCode.call(e.t0,e.t1);case 9:return r=e.sent,e.abrupt("return",!!r&&"0x"!==r);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_legacySignMessage",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var i,a,s;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Ee(n)||this.defaultChainId);case 2:return i=e.sent,a="string"===typeof t?Cn.Y0(t):t,e.next=6,this.getAddress();case 6:return s=e.sent,e.next=9,i.send("eth_sign",[s,B.hexlify(a)]);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_signTypedData",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.signTypedData(t,n,r,i,a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"sendUncheckedTransaction",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,ge.shallowCopy)(t),r=this.getAddress(),e.next=4,this.getSender(Ee(n)||this.defaultChainId);case 4:return i=e.sent,e.t0=ge.resolveProperties,e.t1=(0,ge.resolveProperties)(t),e.next=9,r;case 9:return e.t2=e.sent,e.t3={tx:e.t1,sender:e.t2},e.abrupt("return",(0,e.t0)(e.t3).then((function(e){var n=e.tx,r=e.sender;if(null!=n.from){if(ce.getAddress(n.from)!==r)throw new Error("from address mismatch for transaction ".concat(t))}else n.from=r;var a=Ti(n);return i.send("eth_sendTransaction",[a]).then((function(e){return e}),(function(e){throw new Error("sendTransaction ".concat(e))}))})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"connectUnchecked",value:function(){throw new Error("connectUnchecked is unsupported")}},{key:"unlock",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAddress();case 2:return n=e.sent,e.abrupt("return",this.provider.send("personal_unlockAccount",[n,t,null]));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Sr),Ni={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0,from:!0,auxiliary:!0,expiration:!0,afterNonce:!0,delegateCall:!0,revertOnError:!0},Ti=function e(t,n){var r=(0,ge.shallowCopy)(Ni);if(n)for(var i in n)n[i]&&(r[i]=!0);er.checkProperties(t,r);var a={};["gasLimit","gasPrice","nonce","value"].forEach((function(e){if(t[e]){var n=B.hexValue(t[e]);"gasLimit"===e&&(e="gas"),a[e]=n}})),["from","to","data"].forEach((function(e){t[e]&&(a[e]=B.hexlify(t[e]))}));var s=t.auxiliary;return s&&s.length>0&&(a.auxiliary=[],s.forEach((function(t){a.auxiliary.push(e(t))}))),a},Zi=Cn.Y0("\x19Ethereum Signed Message:\n"),Ai=function(e){return B.isBytes(e)||B.isHexString(e)?B.arrayify(e):Cn.Y0(e)},Pi=function(e){var t=Ai(e);return B.concat([Zi,Cn.Y0(String(t.length)),t])},Mi=function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a,s){var o;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=10;break}return e.next=3,i.getNetwork();case 3:if(e.t0=o=e.sent,null!=e.t0){e.next=8;break}e.t1=void 0,e.next=9;break;case 8:e.t1=o.chainId;case 9:a=e.t1;case 10:if(s||!Ii.isSequenceProvider(i)){e.next=14;break}return e.next=13,i.getSigner().getWalletContext();case 13:s=e.sent;case 14:return e.abrupt("return",Mr(t,n,r,i,s,a));case 15:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),Ri=function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a,s){var o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Pi(n),u=(0,ge.encodeMessageDigest)(o),e.abrupt("return",Mi(t,u,r,i,a,s));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),Di=function(e,t,n,r,i,a){return Mi(e,(0,ge.encodeTypedDataDigest)(t),n,r,i,a)},qi=function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){var s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,ge.packMessageData)(t,i,n),e.next=3,Gr(s,r);case 3:if(o=e.sent,!a){e.next=11;break}if(u=It(o,a),!o.address||o.address===u){e.next=10;break}throw new Error("recovered address does not match the WalletConfig address, check the WalletContext");case 10:o.address=u;case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),Wi=function(){return"chrome-extension:"===window.location.protocol||"moz-extension:"===window.location.protocol},Ui=function(){var e=(0,D.Z)(W().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,d;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getWalletState();case 2:return i=e.sent,e.next=5,t.getNetworks();case 5:if(a=e.sent,s=i.find((function(e){return e.chainId===n}))){e.next=9;break}throw new Error("WalletRequestHandler: could not find wallet state for chainId ".concat(n));case 9:if(o=s.deployed,a){e.next=12;break}throw new Error("isWalletUpToDate util: could not get networks from signer");case 12:if(u=a.find((function(e){return e.isAuthChain})),u){e.next=15;break}throw new Error("isWalletUpToDate util: could not get auth chain network information");case 15:if(c=u.chainId,l=null==(r=i.find((function(e){return e.chainId===c})))?void 0:r.config){e.next=19;break}throw new Error("isWalletUpToDate util: could not get auth chain config");case 19:if(f=s.config){e.next=22;break}throw new Error("isWalletUpToDate util: could not get config for chainId ".concat(n));case 22:return d=Ot(l,f),e.abrupt("return",o&&d);case 24:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Li=function(){function e(){(0,y.Z)(this,e)}return(0,m.Z)(e,null,[{key:"getInstance",value:function(){return e._instance||(e._instance={getItem:function(e){return Promise.resolve(window.localStorage.getItem(e))},setItem:function(e,t){return Promise.resolve(window.localStorage.setItem(e,t))},removeItem:function(e){return Promise.resolve(window.localStorage.removeItem(e))}}),this._instance}},{key:"use",value:function(t){e._instance=t}}]),e}();Li._instance=void 0;var Bi,Fi,Gi=function(){function e(t,n){(0,y.Z)(this,e),this.def=n,this.key=void 0,this.key=t}return(0,m.Z)(e,[{key:"get",value:function(){var e=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Li.getInstance().getItem(this.key);case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",this.def);case 5:return e.prev=5,e.abrupt("return",JSON.parse(t));case 9:e.prev=9,e.t0=e.catch(5),console.error(e.t0);case 12:return e.abrupt("return");case 13:case"end":return e.stop()}}),e,this,[[5,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"set",value:function(e){e?Li.getInstance().setItem(this.key,JSON.stringify(e)):Li.getInstance().removeItem(this.key)}},{key:"del",value:function(){Li.getInstance().removeItem(this.key)}}]),e}(),ji="@sequence.transportSession",Hi=function(){function e(t){var n=this;(0,y.Z)(this,e);var r=this;this.walletRequestHandler=void 0,this._sessionId=void 0,this._registered=void 0,this._init=void 0,this._initNonce=void 0,this._initCallback=void 0,this.appOrigin=void 0,this.sendAsync=function(){var e=(0,D.Z)(W().mark((function e(t,n,r){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("abstract method");case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.handleMessage=function(){var e=(0,D.Z)(W().mark((function e(t){var n,i,a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,r._init===gi.OK){e.next=10;break}if(n.type!==hi.INIT){e.next=9;break}if(!r.isValidInitAck(t)){e.next=7;break}r._initCallback&&r._initCallback(),e.next=9;break;case 7:return r._initCallback&&r._initCallback("invalid init"),e.abrupt("return");case 9:return e.abrupt("return");case 10:e.t0=n.type,e.next=e.t0===hi.OPEN?13:e.t0===hi.CLOSE?19:e.t0===hi.MESSAGE?22:28;break;case 13:if(r._init===gi.OK){e.next=15;break}return e.abrupt("return");case 15:return i={sessionId:n.data.sessionId,intent:n.data.intent,networkId:n.data.networkId},e.next=18,r.open(i);case 18:return e.abrupt("return");case 19:if(r._init===gi.OK){e.next=21;break}return e.abrupt("return");case 21:return e.abrupt("return");case 22:return e.next=24,r.walletRequestHandler.sendMessageRequest(n);case 24:return a=e.sent,r.sendMessage(a),a.data.error,e.abrupt("return");case 28:ge.logger.error("unexpected payload type ".concat(n.type));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendMessageRequest=function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.walletRequestHandler.sendMessageRequest(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.open=function(){var e=(0,D.Z)(W().mark((function e(t){var n,i,a,s,o,u,c;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sessionId,i=t.intent,a=t.networkId,n&&(r._sessionId=(0,ge.sanitizeNumberString)(n),r.saveTransportSession({sessionId:n,intent:i,networkId:a})),r.walletRequestHandler.setOpenIntent(i),e.next=5,r.init();case 5:if(!i||"connect"!==i.type||!i.options){e.next=20;break}if(s=i.options,o=s,!r.appOrigin||null==o||!o.origin){e.next=14;break}if(Wi()){e.next=12;break}if(o.origin===r.appOrigin){e.next=12;break}throw new Error("origin is invalid");case 12:e.next=15;break;case 14:!r.appOrigin&&null!=o&&o.origin?s.origin=(0,ge.sanitizeHost)(o.origin):r.appOrigin&&(s.origin=r.appOrigin);case 15:s.app&&(s.app=(0,ge.sanitizeAlphanumeric)(s.app)),r.walletRequestHandler.setConnectOptions(s),s.networkId&&(a=s.networkId),e.next=21;break;case 20:r.walletRequestHandler.setConnectOptions(void 0);case 21:return e.next=23,r.walletRequestHandler.getSigner();case 23:return e.next=25,r.walletRequestHandler.isSignedIn();case 25:if(e.sent){e.next=30;break}return r.notifyOpen({sessionId:r._sessionId}),e.abrupt("return",!0);case 30:if(u=void 0,e.prev=31,!a){e.next=38;break}return e.next=35,r.walletRequestHandler.setDefaultNetwork(a,!1);case 35:u=e.sent,e.next=41;break;case 38:return e.next=40,r.walletRequestHandler.getChainId();case 40:u=e.sent;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(31),console.error(e.t0);case 46:if(u&&!(u<=0)){e.next=49;break}return r.notifyOpen({sessionId:r._sessionId,error:"failed to open wallet on network ".concat(a)}),e.abrupt("return",!1);case 49:if(!i||"connect"!==i.type){e.next=66;break}return r.notifyOpen({sessionId:r._sessionId}),e.prev=51,e.next=54,r.walletRequestHandler.promptConnect(i.options);case 54:(c=e.sent).connected&&r.walletRequestHandler.notifyConnect(c),e.next=61;break;case 58:e.prev=58,e.t1=e.catch(51),ge.logger.warn("promptConnect not connected:",e.t1);case 61:return e.prev=61,i.options&&!0===i.options.keepWalletOpened||r.notifyClose(),e.finish(61);case 64:e.next=74;break;case 66:return e.t2=r,e.t3=r._sessionId,e.t4="".concat(u),e.next=71,r.walletRequestHandler.walletSession();case 71:e.t5=e.sent,e.t6={sessionId:e.t3,chainId:e.t4,session:e.t5},e.t2.notifyOpen.call(e.t2,e.t6);case 74:return e.abrupt("return",!0);case 75:case"end":return e.stop()}}),e,null,[[31,43],[51,58,61,64]])})));return function(t){return e.apply(this,arguments)}}(),this.saveTransportSession=function(e){Li.getInstance().setItem(ji,JSON.stringify(e))},this.getCachedTransportSession=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Li.getInstance().getItem(ji);case 2:return t=e.sent,e.prev=3,e.abrupt("return",t?JSON.parse(t):null);case 7:return e.prev=7,e.t0=e.catch(3),console.error("unable to parse transport session: ".concat(t)),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[3,7]])}))),this.walletRequestHandler=t,this._init=gi.NIL,this.walletRequestHandler.on("connect",(function(e){n.registered&&n.notifyConnect(e)})),this.walletRequestHandler.on("disconnect",(function(e){n.registered&&n.notifyDisconnect(e)})),this.walletRequestHandler.on("accountsChanged",(function(e,t){n.registered&&n.notifyAccountsChanged(e,t)})),this.walletRequestHandler.on("networks",(function(e){n.registered&&(n.notifyNetworks(e),e&&0!==e.length?n.notifyChainChanged(B.hexlify(e.find((function(e){return e.isDefaultChain})).chainId)):n.notifyChainChanged("0x0"))})),this.walletRequestHandler.on("walletContext",(function(e){n.registered&&e&&n.notifyWalletContext(e)})),this.walletRequestHandler.on("close",(function(e){n.registered&&n.notifyClose(e)}))}return(0,m.Z)(e,[{key:"registered",get:function(){return this._registered}},{key:"register",value:function(){throw new Error("abstract method")}},{key:"unregister",value:function(){throw new Error("abstract method")}},{key:"sendMessage",value:function(e){throw new Error("abstract method")}},{key:"notifyOpen",value:function(e){var t=e.chainId,n=e.sessionId,r=e.session,i=e.error;this.sendMessage({idx:-1,type:hi.OPEN,data:{chainId:t,sessionId:n,session:r,error:i}})}},{key:"notifyClose",value:function(e){this.sendMessage({idx:-1,type:hi.CLOSE,data:e?{error:e}:null})}},{key:"notifyConnect",value:function(e){this.sendMessage({idx:-1,type:hi.CONNECT,data:e})}},{key:"notifyDisconnect",value:function(e){this.sendMessage({idx:-1,type:hi.DISCONNECT,data:e?{error:e}:null})}},{key:"notifyAccountsChanged",value:function(e,t){this.sendMessage({idx:-1,type:hi.ACCOUNTS_CHANGED,data:e,origin:t})}},{key:"notifyChainChanged",value:function(e){this.sendMessage({idx:-1,type:hi.CHAIN_CHANGED,data:e})}},{key:"notifyNetworks",value:function(e){this.sendMessage({idx:-1,type:hi.NETWORKS,data:e})}},{key:"notifyWalletContext",value:function(e){this.sendMessage({idx:-1,type:hi.WALLET_CONTEXT,data:e})}},{key:"isValidInitAck",value:function(e){if(this._init===gi.OK)return ge.logger.warn("isValidInitAck, already in init'd state, so inquiry is invalid."),!1;if(e.type!==hi.INIT)return ge.logger.warn("isValidInitAck, invalid message type, expecting init"),!1;var t=e.data,n=t.sessionId,r=t.nonce;return n&&0!==n.length&&r&&0!==r.length?n===this._sessionId&&r===this._initNonce||(ge.logger.error("invalid init ack match"),!1):(ge.logger.error("invalid init ack"),!1)}},{key:"init",value:function(){var e=this;return new Promise((function(t,n){if(e._init!==gi.OK)if(e._init!==gi.NIL||e._initCallback)n("transport init is in progress");else{var r=setTimeout((function(){ge.logger.warn("transport init timed out"),e._initCallback&&e._initCallback("transport init timed out")}),mi/2);e._initCallback=function(i){e._initCallback=void 0,clearTimeout(r),i?n(i):(e._init=gi.OK,t())},e._initNonce="".concat(performance.now()),e.sendMessage({idx:-1,type:hi.INIT,data:{nonce:e._initNonce}}),e._init=gi.SENT_NONCE}else t()}))}}]),e}(),Vi=(0,m.Z)((function e(){(0,y.Z)(this,e),this.app=void 0,this.wallet=void 0;var t=new Ki,n=new Ki;t.conn=n,n.conn=t,this.app=t,this.wallet=n})),Ki=function(){function e(){var t=this;(0,y.Z)(this,e),this.conn=void 0,this.events=new ci.EventEmitter2,this.handleMessage=function(e){throw new Error("ProxyMessageChannelPort is not registered")},this.sendMessage=function(e){t.conn.handleMessage(e),"open"===e.type&&t.events.emit("open",e),"close"===e.type&&t.events.emit("close",e),"connect"===e.type&&t.events.emit("connect",e),"disconnect"===e.type&&t.events.emit("disconnect",e)}}return(0,m.Z)(e,[{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}}]),e}(),Ji=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this)).port=void 0,r.register=function(){r.port.handleMessage=function(e){r.handleMessage(e)},r.on("open",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["open"].concat(n))})),r.on("close",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["close"].concat(n))})),r.on("connect",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["connect"].concat(n))})),r.on("disconnect",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["disconnect"].concat(n))})),r._registered=!0},r.unregister=function(){r._registered=!1,r.closeWallet(),r.events.removeAllListeners(),r.port.handleMessage=void 0},r.openWallet=function(e,t,n){if(r.state===pi.CLOSED){r.state=pi.OPENING;var i="".concat(performance.now());r._sessionId=i,r.sendMessage({idx:-1,type:hi.OPEN,data:{path:e,intent:t,networkId:n,sessionId:i}})}},r.state=pi.CLOSED,r.port=e,!e)throw new Error("port argument cannot be empty");return r._init=gi.OK,r}return(0,m.Z)(n,[{key:"closeWallet",value:function(){this.sendMessage({idx:-1,type:hi.CLOSE,data:null}),this.close()}},{key:"sendMessage",value:function(e){if(!e.idx)throw new Error("message idx is empty");this.port.sendMessage(e)}}]),n}(xi),$i=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e)).port=void 0,i.port=r,i._init=gi.OK,i}return(0,m.Z)(n,[{key:"register",value:function(){var e=this;this.port.handleMessage=function(t){e.handleMessage(t)},this._registered=!0}},{key:"restoreSession",value:function(){var e=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCachedTransportSession();case 2:(t=e.sent)&&this.open(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unregister",value:function(){this.port.handleMessage=void 0,this._registered=!1}},{key:"sendMessage",value:function(e){this.port.sendMessage(e)}}]),n}(Hi),zi=function(){function e(){var t=this;(0,y.Z)(this,e);var n=this;this.messageProviders=void 0,this.provider=void 0,this.register=function(){if(1===t.messageProviders.length)return t.provider=t.messageProviders[0],void t.provider.register();t.messageProviders.forEach((function(e){e.register(),e.once("open",(function(){t.provider||(t.provider=e,t.messageProviders.forEach((function(e){t.provider!==e&&e.unregister()})))}))}))},this.unregister=function(){t.messageProviders.forEach((function(e){return e.unregister()})),t.provider=void 0},this.openWallet=function(e,n,r){t.provider?t.provider.openWallet(e,n,r):t.messageProviders.forEach((function(t){return t.openWallet(e,n,r)}))},this.sendAsync=function(){var e=(0,D.Z)(W().mark((function e(t,r,i){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=3;break}return n.provider.sendAsync(t,r,i),e.abrupt("return");case 3:throw new Error("impossible state, wallet must be opened first");case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendMessageRequest=function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=2;break}return e.abrupt("return",n.provider.sendMessageRequest(t));case 2:throw new Error("impossible state, wallet must be opened first");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.waitUntilOpened=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=2;break}return e.abrupt("return",n.provider.waitUntilOpened());case 2:return e.abrupt("return",Promise.race(n.messageProviders.map((function(e){return e.waitUntilOpened()}))));case 3:case"end":return e.stop()}}),e)}))),this.waitUntilConnected=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=2;break}return e.abrupt("return",n.provider.waitUntilConnected());case 2:throw new Error("impossible state, wallet must be opened first");case 3:case"end":return e.stop()}}),e)})));for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];this.messageProviders=i,this.provider=void 0}return(0,m.Z)(e,[{key:"add",value:function(){var e;(e=this.messageProviders).push.apply(e,arguments)}},{key:"closeWallet",value:function(){this.provider&&this.provider.closeWallet()}},{key:"isOpened",value:function(){return!!this.provider&&this.provider.isOpened()}},{key:"isConnected",value:function(){return!!this.provider&&this.provider.isConnected()}},{key:"on",value:function(e,t){this.provider?this.provider.on(e,t):this.messageProviders.forEach((function(n){n.on(e,t)}))}},{key:"once",value:function(e,t){this.provider?this.provider.once(e,t):this.messageProviders.forEach((function(n){n.once(e,t)}))}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i;if(this.provider)return(i=this.provider).emit.apply(i,[e].concat(n));for(var a=0;a<this.messageProviders.length;a++){var s;(s=this.messageProviders[a]).emit.apply(s,[e].concat(n))}return!0}},{key:"sendMessage",value:function(e){if(!e.idx||e.idx<=0)throw new Error("message idx is empty");if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.sendMessage(e)}},{key:"handleMessage",value:function(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.handleMessage(e)}}]),e}(),Yi=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).walletURL=void 0,r.walletWindow=void 0,r.register=function(){Bi&&(Bi.unregister(),Bi=(0,ve.Z)(r)),window.addEventListener("message",r.onWindowEvent),Bi=(0,ve.Z)(r),r.on("open",(function(){var e=r.walletWindow,t=setInterval((function(){e&&e.closed&&(clearInterval(t),r.close())}),500)})),r.on("close",(function(){r.walletWindow&&(r.walletWindow.close(),r.walletWindow=null)})),r._registered=!0},r.unregister=function(){r._registered=!1,r.closeWallet(),Bi===(0,ve.Z)(r)&&(Bi=void 0),window.removeEventListener("message",r.onWindowEvent),r.events.removeAllListeners()},r.openWallet=function(e,t,n){if(r.walletWindow&&r.isOpened())r.walletWindow.focus();else{var i,a,s=new URL(r.walletURL.href),o=new vi;e&&""!==e&&(s.pathname=e.toLowerCase()),r._init=gi.NIL,r._sessionId="".concat(performance.now()),o.set("sid",r._sessionId),t&&("connect"===t.type&&(t.options||(t.options={}),Wi()||(t.options.origin=window.location.origin)),o.set("intent",(0,ge.base64EncodeObject)(t))),n&&o.set("net","".concat(n)),Wi()?(i=[450,750],a=[Math.abs(window.screen.width/2-i[0]/2),Math.abs(window.screen.height/2-i[1]/2)]):(i=[450,750],a=[Math.abs(window.screenX+window.innerWidth/2-i[0]/2),Math.abs(window.screenY+window.innerHeight/2-i[1]/2)]);var u="toolbar=0,location=0,menubar=0,scrollbars=yes,status=yes"+",width=".concat(i[0],",height=").concat(i[1])+",left=".concat(a[0],",top=").concat(a[1]);s.search=o.toString(),r.walletWindow=window.open(s.href,"sequence.app",u)}},r.onWindowEvent=function(e){if(e.origin===r.walletURL.origin){var t;try{t=JSON.parse(e.data)}catch(n){return}if(!t)throw new Error("ProviderMessage object is empty");r.handleMessage(t)}},r.walletURL=new URL(e),r}return(0,m.Z)(n,[{key:"closeWallet",value:function(){var e;this.close(),null==(e=this.walletWindow)||e.close()}},{key:"sendMessage",value:function(e){if(this.walletWindow){var t="string"!==typeof e?JSON.stringify(e):e;this.walletWindow.postMessage(t,this.walletURL.origin)}else ge.logger.warn("WindowMessageProvider: sendMessage failed as walletWindow is unavailable")}}]),n}(xi),Qi=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r,i;return(0,y.Z)(this,n),r=t.call(this,e),i=(0,ve.Z)(r),r.parentWindow=void 0,r._isPopup=!1,r.onWindowEvent=function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.origin&&""!==t.origin){e.next=2;break}return e.abrupt("return");case 2:if(!i.appOrigin||t.origin===i.appOrigin){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,n=JSON.parse(t.data),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(4),e.abrupt("return");case 11:if(ge.logger.debug("RECEIVED MESSAGE",n),i._init!==gi.OK&&i.isValidInitAck(n)&&(i.appOrigin=t.origin),i._init!==gi.OK||i.appOrigin&&!(i.appOrigin.length<8)){e.next=16;break}return ge.logger.error("impossible state, init.OK and appOrigin required"),e.abrupt("return");case 16:i.handleMessage(n);case 17:case"end":return e.stop()}}),e,null,[[4,8]])})));return function(t){return e.apply(this,arguments)}}(),r.getWindowTransportSession=function(e){var t=new vi(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:(0,ge.base64DecodeObject)(t.get("intent"))}},r._init=gi.NIL,r}return(0,m.Z)(n,[{key:"register",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null!==parent.window.opener,this._isPopup=n,!0===n){e.next=4;break}return e.abrupt("return");case 4:if(r=new URL(t||window.location.href),r.pathname,i=r.search,a=this.getWindowTransportSession(i),!!a.sessionId){e.next=11;break}return e.next=10,this.getCachedTransportSession();case 10:a=e.sent;case 11:if(a){e.next=14;break}return ge.logger.error("window session is undefined"),e.abrupt("return");case 14:this.parentWindow=parent.window.opener,window.addEventListener("message",this.onWindowEvent,!1),this._registered=!0,this.open(a).then((function(e){if(!e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId);ge.logger.error(n),s.notifyClose({message:n}),window.close()}})).catch((function(e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId,", due to: ").concat(e);ge.logger.error(n),s.notifyClose({message:n}),window.close()}));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unregister",value:function(){window.removeEventListener("message",this.onWindowEvent),this._registered=!1}},{key:"sendMessage",value:function(e){var t=JSON.stringify(e);e.type===hi.INIT?this.postMessage(t,!0):this.postMessage(t)}},{key:"isPopup",get:function(){return this._isPopup}},{key:"postMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t||this._init===gi.OK?t?this.parentWindow.postMessage(e,"*"):this.appOrigin&&this.appOrigin.length>4?this.parentWindow.postMessage(e,this.appOrigin):ge.logger.error("unable to postMessage as parentOrigin is invalid"):ge.logger.error("impossible state, should not be calling postMessage until inited")}}]),n}(Hi),Xi="sequence-extension-message-handler",ea=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e,r){var i;return(0,y.Z)(this,n),(i=t.call(this,e)).runtime=r,i.port=void 0,i._init=gi.OK,i}return(0,m.Z)(n,[{key:"register",value:function(){this._registered=!0,this.port=this.runtime.connect({name:Xi})}},{key:"sendMessage",value:function(e){ge.logger.info("[ExtensionMessageHandler send]",e),this.port.postMessage(e)}}]),n}(Hi),ta=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).register=function(){r._registered=!0},e.onConnect.addListener((function(e){e.name===Xi&&(r._init=gi.OK,e.onMessage.addListener((function(e){r.handleMessage(e)})))})),r}return(0,m.Z)(n,[{key:"sendMessage",value:function(e){}},{key:"unregister",value:function(){}},{key:"openWallet",value:function(e,t,n){}},{key:"closeWallet",value:function(){}}]),n}(xi),na=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r,i;return(0,y.Z)(this,n),r=t.call(this),i=(0,ve.Z)(r),r.stream=e,r.responseCallbacks=new Map,r._messageIdx=0,r.nextMessageIdx=function(){return++r._messageIdx},r.handleMessage=function(e){if(e.type&&e.data){ge.logger.info("[received message]",e);var t=e.idx,n=r.responseCallbacks.get(t);switch(t&&r.responseCallbacks.delete(t),e.type){case hi.MESSAGE:if(!n)throw new Error("impossible state");r.emit(hi.MESSAGE,e),n(e.data.error,e);break;case hi.DISCONNECT:case hi.ACCOUNTS_CHANGED:case hi.CHAIN_CHANGED:r.emit(e.type,e.data);break;default:console.error("unknown message type",e)}}},r.sendMessageRequest=function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){(!t.idx||t.idx<=0)&&n(new Error("message idx not set"));var r=t.idx;i.responseCallbacks.get(r)?n(new Error("duplicate message idx, should never happen")):i.responseCallbacks.set(r,(function(t,r){if(t)n(t);else{if(!r)throw new Error("no valid response to return");e(r)}})),i.sendMessage(t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.stream.on("data",r.handleMessage),r}return(0,m.Z)(n,[{key:"sendMessage",value:function(e){this.stream.writable||console.error("window post message stream is not writable"),this.stream.write(e)}}]),n}(ci.EventEmitter2);function ra(e){var t;if(null!=(t=window.ue)&&t.sequencewallettransport&&!window.logsOverriddenForUnreal){var n,r=null==(n=window.ue)?void 0:n.sequencewallettransport;console.log=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.logfromjs("".concat(e,": ").concat(ia(n)))},console.warn=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.warnfromjs("".concat(e,": ").concat(ia(n)))},console.error=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.errorfromjs("".concat(e,": ").concat(ia(n)))},window.logsOverriddenForUnreal=!0}}function ia(e){return e.map((function(e){return"object"===typeof e?e instanceof Error?e.message:JSON.stringify(e):String(e)})).join(" ")}var aa,sa=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).walletURL=void 0,r.register=function(){var e;ra("dapp"),Fi&&(Fi.unregister(),Fi=(0,ve.Z)(r)),null!=(e=window.ue)&&e.sequencewallettransport&&(window.ue.sequencewallettransport.onmessagefromwallet=r.onUnrealCallback),Fi=(0,ve.Z)(r),r._registered=!0,console.log("registering transport!")},r.unregister=function(){var e,t;r._registered=!1,r.closeWallet(),Fi===(0,ve.Z)(r)&&(Fi=void 0),(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromwallet)===r.onUnrealCallback&&delete window.ue.sequencewallettransport.onmessagefromwallet,r.events.removeAllListeners()},r.openWallet=function(e,t,n){if(r.isOpened())console.log("wallet already open!");else{console.log("opening wallet!");var i=new URL(r.walletURL.href),a=new vi;e&&(i.pathname=e.toLowerCase()),r._init=gi.NIL,r._sessionId="".concat(performance.now()),a.set("sid",r._sessionId),t&&a.set("intent",(0,ge.base64EncodeObject)(t)),n&&a.set("net","".concat(n)),i.search=a.toString(),console.log("opening wallet to",i.href),window.open(i.href)}},r.onUnrealCallback=function(e){if(!e)throw new Error("ProviderMessage object is empty");r.handleMessage(e)},r.walletURL=new URL(e),r}return(0,m.Z)(n,[{key:"closeWallet",value:function(){this.close()}},{key:"sendMessage",value:function(e){var t,n,r="string"!==typeof e?JSON.stringify(e):e;console.log("Sending message to wallet:",r),null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetowallet(r)}}]),n}(xi),oa=function(e){(0,v.Z)(n,e);var t=(0,w.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).onMessageFromUnreal=function(e){ge.logger.debug("RECEIVED MESSAGE",e),r.handleMessage(e)},r.getUnrealTransportSession=function(e){var t=new vi(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:(0,ge.base64DecodeObject)(t.get("intent"))}},r._init=gi.NIL,r}return(0,m.Z)(n,[{key:"register",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n,r,i,a,s=this;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==(n=window.ue)?void 0:n.sequencewallettransport)){e.next=2;break}return e.abrupt("return");case 2:if(ra("wallet"),r=new URL(t||window.location.href),i=r.search,a=this.getUnrealTransportSession(i),!!a.sessionId){e.next=10;break}return e.next=9,this.getCachedTransportSession();case 9:a=e.sent;case 10:if(a){e.next=13;break}return ge.logger.error("unreal session is undefined"),e.abrupt("return");case 13:window.ue.sequencewallettransport.onmessagefromsequencejs=this.onMessageFromUnreal,this._registered=!0,this.open(a).then((function(e){if(!e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId);ge.logger.error(n),s.notifyClose({message:n}),window.close()}})).catch((function(e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId,", due to: ").concat(e);ge.logger.error(n),s.notifyClose({message:n}),window.close()}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unregister",value:function(){var e,t;(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromsequencejs)===this.onMessageFromUnreal&&delete window.ue.sequencewallettransport.onmessagefromsequencejs,this._registered=!1}},{key:"sendMessage",value:function(e){var t,n;if(e.type===hi.INIT||this._init===gi.OK){var r=JSON.stringify(e);null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetosequencejs(r)}else ge.logger.error("impossible state, should not be calling postMessage until inited")}}]),n}(Hi),ua=function(){function e(t){(0,y.Z)(this,e);var n=this;this.wallet=void 0,this.recoverWalletConfig=function(){var e=(0,D.Z)(W().mark((function e(t,r,i,a,s){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=s,e.t0){e.next=5;break}return e.next=4,n.wallet.getWalletContext();case 4:e.t0=e.sent;case 5:return s=e.t0,e.abrupt("return",qi(t,r,i,a,s));case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),this.recoverWalletConfigFromMessage=function(){var e=(0,D.Z)(W().mark((function e(t,r,i,a,s){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=s,e.t0){e.next=5;break}return e.next=4,n.wallet.getWalletContext();case 4:e.t0=e.sent;case 5:return s=e.t0,e.abrupt("return",qi(t,(0,ge.encodeMessageDigest)(Pi(r)),i,a,s));case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),this.recoverWalletConfigFromTypedData=function(){var e=(0,D.Z)(W().mark((function e(t,r,i,a,s){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=s,e.t0){e.next=5;break}return e.next=4,n.wallet.getWalletContext();case 4:e.t0=e.sent;case 5:return s=e.t0,e.abrupt("return",qi(t,(0,ge.encodeTypedDataDigest)(r),i,a,s));case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),this.wallet=t}return(0,m.Z)(e,[{key:"signMessage",value:function(e,t,n){var r=this.wallet.getSigner();if(!r)throw new Error("unable to get signer");return r.signMessage(e,t,n)}},{key:"signAuthMessage",value:function(){var e=(0,D.Z)(W().mark((function e(t,n){var r;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wallet.getAuthSigner();case 2:if(r=e.sent){e.next=5;break}throw new Error("unable to get AuthChain signer");case 5:return e.t0=r,e.t1=t,e.next=9,r.getChainId();case 9:return e.t2=e.sent,e.t3=n,e.abrupt("return",e.t0.signMessage.call(e.t0,e.t1,e.t2,e.t3));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(e,t,n,r,i){var a=this.wallet.getSigner();if(!a)throw new Error("unable to get signer");return a.signTypedData(e,t,n,r,i)}},{key:"signAuthTypedData",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i){var a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wallet.getAuthSigner();case 2:if(a=e.sent){e.next=5;break}throw new Error("unable to get AuthChain signer");case 5:return e.t0=a,e.t1=t,e.t2=n,e.t3=r,e.next=11,a.getChainId();case 11:return e.t4=e.sent,e.t5=i,e.abrupt("return",e.t0.signTypedData.call(e.t0,e.t1,e.t2,e.t3,e.t4,e.t5));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"isValidSignature",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){var s;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.wallet.getProvider(i)){e.next=3;break}throw new Error("unable to get provider for chainId ".concat(i));case 3:return e.abrupt("return",Mi(t,n,r,s,i,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"isValidMessageSignature",value:function(){var e=(0,D.Z)(W().mark((function e(t,n,r,i,a){var s,o,u;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.wallet.getProvider(i)){e.next=3;break}throw new Error("unable to get provider for chainId ".concat(i));case 3:return o=Pi(n),u=(0,ge.encodeMessageDigest)(o),e.abrupt("return",Mi(t,u,r,s,i,a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"isValidTypedDataSignature",value:function(e,t,n,r,i){return this.isValidSignature(e,(0,ge.encodeTypedDataDigest)(t),n,r,i)}}]),e}(),ca=function(){function e(t,n){var r=this;(0,y.Z)(this,e);var i=this;this.utils=void 0,this.config=void 0,this.session=void 0,this.connectedSites=void 0,this.transport=void 0,this.networks=void 0,this.providers=void 0,this.init=function(){var e,t,n,i,a,s,o,u;r.transport.provider||(r.transport.messageProvider=new zi,null!=(e=r.config.transports)&&null!=(t=e.windowTransport)&&t.enabled&&(r.transport.windowMessageProvider=new Yi(r.config.walletAppURL),r.transport.messageProvider.add(r.transport.windowMessageProvider)),null!=(n=r.config.transports)&&null!=(i=n.proxyTransport)&&i.enabled&&(r.transport.proxyMessageProvider=new Ji(r.config.transports.proxyTransport.appPort),r.transport.messageProvider.add(r.transport.proxyMessageProvider)),null!=(a=r.config.transports)&&null!=(s=a.extensionTransport)&&s.enabled&&(r.transport.extensionMessageProvider=new ta(r.config.transports.extensionTransport.runtime),r.transport.messageProvider.add(r.transport.extensionMessageProvider)),null!=(o=r.config.transports)&&null!=(u=o.unrealTransport)&&u.enabled&&(r.transport.unrealMessageProvider=new sa(r.config.walletAppURL),r.transport.messageProvider.add(r.transport.unrealMessageProvider)),r.transport.messageProvider.register(),r.transport.allowProvider=$e((function(e){if("sequence_setDefaultNetwork"===e.method)return!0;var t=r.isConnected();if(!t)throw new Error("Sequence: wallet not connected");return t})),r.transport.networkProvider=et((function(e){return r.networks&&0!==r.networks.length?r.networks.find((function(e){return e.isDefaultChain})).chainId:0})),r.transport.cachedProvider=new ze,r.transport.cachedProvider.onUpdate((function(){r.session||(r.session={providerCache:{}}),r.session.providerCache=r.transport.cachedProvider.getCache(),r.saveSession(r.session)})),r.transport.router=new Le([Xe,r.transport.networkProvider,r.transport.allowProvider,Qe,r.transport.cachedProvider],r.transport.messageProvider),r.transport.provider=new Ii(r.transport.router),r.transport.messageProvider.on("open",(function(e){var t=e.session;t?r.useSession(t,!0):(r.session&&r.session.accountAddress&&r.transport.messageProvider.emit("disconnect"),r.clearSession())})),r.transport.messageProvider.on("accountsChanged",(function(e,t){t?e.length>0&&r.useSession({accountAddress:e[0]},!0):e&&0!==e.length&&""!==e[0]?r.useSession({accountAddress:e[0]},!0):r.clearSession()})),r.transport.messageProvider.on("networks",(function(e){r.useSession({networks:e},!0)})),r.transport.messageProvider.on("walletContext",(function(e){r.useSession({walletContext:e},!0)})))},this.loadSession=(0,D.Z)(W().mark((function e(){var t,n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Li.getInstance().getItem("@sequence.session");case 2:if((t=e.sent)&&""!==t){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.prev=5,(n=JSON.parse(t))&&i.useSession(n,!1),e.abrupt("return",n);case 11:return e.prev=11,e.t0=e.catch(5),ge.logger.warn("loadSession failed, unable to parse session payload from storage."),e.abrupt("return",void 0);case 15:case"end":return e.stop()}}),e,null,[[5,11]])}))),this.connect=function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0===(null==t?void 0:t.refresh)&&i.disconnect(),e.t3=i.isConnected(),!e.t3){e.next=6;break}return e.next=5,i.isSiteConnected(null==t?void 0:t.origin);case 5:e.t3=e.sent;case 6:if(e.t2=e.t3,!e.t2){e.next=9;break}e.t2=!!i.session;case 9:if(e.t1=e.t2,!e.t1){e.next=12;break}e.t1=!(null!=t&&t.authorize);case 12:if(e.t0=e.t1,!e.t0){e.next=15;break}e.t0=!(null!=t&&t.askForEmail);case 15:if(!e.t0){e.next=23;break}return e.t4=i.session,e.t5=U,e.next=20,i.getChainId();case 20:return e.t6=e.sent,e.t7=e.t5.hexlify.call(e.t5,e.t6),e.abrupt("return",{connected:!0,session:e.t4,chainId:e.t7});case 23:if(!t){e.next=26;break}if(!t.authorize||t.app&&""!==t.app){e.next=26;break}throw new Error("connecting with 'authorize' option also requires 'app' to be set");case 26:return e.next=28,i.openWallet(void 0,{type:"connect",options:t});case 28:return e.next=30,i.transport.messageProvider.waitUntilConnected().catch((function(e){return{connected:!1}}));case 30:if(!(n=e.sent).connected){e.next=38;break}if(!n.session){e.next=37;break}i.useSession(n.session,!0),i.addConnectedSite(null==t?void 0:t.origin),e.next=38;break;case 37:throw new Error("impossible state, connect response is missing session");case 38:return e.abrupt("return",n);case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.authorize=function(){var e=(0,D.Z)(W().mark((function e(t){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.connect(di({},t,{authorize:!0})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getSession=function(){if(r.isConnected())return r.session},this.getAddress=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isConnected()){e.next=2;break}throw new Error("connect first");case 2:return t=i.getSession(),e.abrupt("return",t.accountAddress);case 4:case"end":return e.stop()}}),e)}))),this.getNetworks=function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isConnected()&&i.networks){e.next=2;break}throw new Error("connect first");case 2:if(!t){e.next=5;break}return n=Ze(i.networks,t),e.abrupt("return",n?[n]:[]);case 5:return e.abrupt("return",i.networks);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getChainId=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.networks&&!(i.networks.length<1)){e.next=2;break}throw new Error("networks have not been set by session. connect first.");case 2:if(t=i.networks.find((function(e){return e.isDefaultChain}))){e.next=5;break}throw new Error("networks must have a default chain specified");case 5:return e.abrupt("return",t.chainId);case 6:case"end":return e.stop()}}),e)}))),this.getAuthChainId=(0,D.Z)(W().mark((function e(){var t;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.networks&&!(i.networks.length<1)){e.next=2;break}throw new Error("networks have not been set by session. connect first.");case 2:if(t=i.networks.find((function(e){return e.isAuthChain}))){e.next=5;break}throw new Error("networks must have an auth chain specified");case 5:return e.abrupt("return",t.chainId);case 6:case"end":return e.stop()}}),e)}))),this.openWallet=function(){var e=(0,D.Z)(W().mark((function e(t,n,r){var a;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("connect"===(null==n?void 0:n.type)||i.isConnected()){e.next=2;break}throw new Error("connect first");case 2:if(i.networks&&!(i.networks.length<1)){e.next=6;break}a=i.config.defaultNetworkId,e.next=9;break;case 6:return e.next=8,i.getChainId();case 8:a=e.sent;case 9:return i.transport.messageProvider.openWallet(t,n,r||a),e.next=12,i.transport.messageProvider.waitUntilOpened();case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.closeWallet=function(){r.transport.messageProvider.closeWallet()},this.saveSession=function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ge.logger.debug("wallet provider: saving session"),n=JSON.stringify(t),e.next=4,Li.getInstance().setItem("@sequence.session",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.useSession=function(){var e=(0,D.Z)(W().mark((function e(t){var n,r=arguments;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!(r.length>1&&void 0!==r[1])||r[1],i.session||(i.session={}),i.config.walletContext?i.session.walletContext=i.config.walletContext:t.walletContext&&(i.session.walletContext=t.walletContext),t.accountAddress&&i.useAccountAddress(t.accountAddress),t.networks&&i.useNetworks(t.networks),t.providerCache&&i.transport.cachedProvider.setCache(t.providerCache),n&&i.saveSession(i.session);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.config=di({},la),n&&(this.config=di({},this.config,n)),t?this.config.defaultNetworkId=t:this.config.defaultNetworkId||(this.config.defaultNetworkId="mainnet"),null!=n&&n.localStorage&&Li.use(n.localStorage),this.transport={},this.networks=[],this.providers={},this.connectedSites=new Gi("@sequence.connectedSites",[]),this.utils=new ua(this),this.init()}return(0,m.Z)(e,[{key:"addConnectedSite",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||window.location.origin,e.next=3,this.connectedSites.get();case 3:if(!(n=e.sent)){e.next=10;break}if(!n.includes(t)){e.next=7;break}return e.abrupt("return");case 7:this.connectedSites.set([].concat((0,R.Z)(n),[t])),e.next=11;break;case 10:this.connectedSites.set([t]);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeConnectedSite",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connectedSites.get();case 2:(n=e.sent)&&this.connectedSites.set(n.filter((function(e){return e!==t})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConnectedSites",value:function(){return this.connectedSites.get()}},{key:"isSiteConnected",value:function(){var e=(0,D.Z)(W().mark((function e(t){var n;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connectedSites.get();case 2:return n=e.sent,e.abrupt("return",!!n&&n.includes(t||window.location.origin));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){this.isOpened()&&this.closeWallet(),this.clearSession()}},{key:"getProviderConfig",value:function(){return this.config}},{key:"isOpened",value:function(){return this.transport.messageProvider.isOpened()}},{key:"isConnected",value:function(){return void 0!==this.session&&void 0!==this.session.networks&&this.session.networks.length>0&&void 0!==this.networks&&this.networks.length>0&&!!this.session.accountAddress&&this.session.accountAddress.startsWith("0x")}},{key:"getProvider",value:function(e){if(!this.isConnected()){if(e)throw new Error("session is empty. connect and try again.");return this.transport.provider}var t,n=this.networks.find((function(e){return e.isDefaultChain}));if(e&&!(n=Ze(this.networks,e)))throw new Error("network ".concat(e," is not in the network list"));if(this.providers[n.chainId])return this.providers[n.chainId];var r=n.provider?n.provider:new G.r(n.rpcUrl,n.chainId);if(n.isDefaultChain){var i=new Le([Xe,Qe,new Ye({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext}),new nt(this.transport.provider),this.transport.cachedProvider],new Ve(r));t=new Ii(i,n.chainId)}else{var a=new Le([Xe,Qe,new Ye({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext,chainId:n.chainId}),new nt(this.transport.provider),new ze(n.chainId)],new Ve(r));t=new Ii(a,n.chainId)}return this.providers[n.chainId]=t,t}},{key:"getAuthProvider",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.getAuthNetwork();case 3:return e.t1=e.sent.chainId,e.abrupt("return",e.t0.getProvider.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAuthNetwork",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNetworks();case 2:return e.abrupt("return",e.sent.find((function(e){return e.isAuthChain})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllProviders",value:function(){return this.providers}},{key:"getSigner",value:function(e){return this.getProvider(e).getSigner()}},{key:"getAuthSigner",value:function(){var e=(0,D.Z)(W().mark((function e(){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAuthProvider();case 2:return e.abrupt("return",e.sent.getSigner());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWalletConfig",value:function(e){return this.getSigner().getWalletConfig(e)}},{key:"getWalletState",value:function(e){return this.getSigner().getWalletState(e)}},{key:"getWalletContext",value:function(){return this.getSigner().getWalletContext()}},{key:"isDeployed",value:function(e){return this.getSigner(e).isDeployed()}},{key:"on",value:function(e,t){this.transport.messageProvider.on(e,t)}},{key:"once",value:function(e,t){this.transport.messageProvider.once(e,t)}},{key:"useAccountAddress",value:function(e){this.session||(this.session={}),this.session.accountAddress=ce.getAddress(e)}},{key:"useNetworks",value:function(e){var t=this;if(this.session||(this.session={}),this.session.networks=e,this.session.networks&&0!==this.session.networks.length)if(this.config.networks||this.config.networkRpcUrl){if(this.networks=e,this.config.networks&&(this.networks=e.map((function(e){return di({},e)})),this.config.networks.forEach((function(e){var n=Ze(t.networks,e.chainId||e.name);n&&Ne(e,n)})),_e(this.networks,!0)),this.config.networkRpcUrl){var n=this.networks.find((function(e){return e.isDefaultChain}));n&&(n.rpcUrl=this.config.networkRpcUrl)}}else this.networks=e}},{key:"clearSession",value:function(){var e;ge.logger.debug("wallet provider: clearing session"),Li.getInstance().removeItem("@sequence.session"),this.session=void 0,this.networks=[],this.providers={},null==(e=this.transport.cachedProvider)||e.clearCache()}}]),e}(),la={walletAppURL:"https://sequence.app",transports:{windowTransport:{enabled:!0},proxyTransport:{enabled:!1}}},fa=function(){var e=(0,D.Z)(W().mark((function e(t,n){return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return aa&&aa.isOpened()&&aa.closeWallet(),aa=new ca(t,n),e.next=4,aa.loadSession();case 4:return e.abrupt("return",aa);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),da=function(){if(!aa)throw new Error("Wallet has not been initialized, call sequence.initWallet(network, config) first.");return aa};function ha(e,t){return t.forEach((function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var pa=Object.freeze(ha({__proto__:null},[r])),ga=Object.freeze(ha({__proto__:null},[i])),va=Object.freeze(ha({__proto__:null},[d])),wa=Object.freeze(ha({__proto__:null},[o])),ya=Object.freeze(ha({__proto__:null},[h])),ma=Object.freeze(ha({__proto__:null},[u])),ka=Object.freeze(ha({__proto__:null},[c])),ba=Object.freeze(ha({__proto__:null},[s])),xa=Object.freeze(ha({__proto__:null},[a])),Ca=Object.freeze(ha({__proto__:null},[p])),Ea=Object.freeze(ha({__proto__:null},[f])),Ia=Object.freeze(ha({__proto__:null},[l])),Sa=Object.freeze(ha({__proto__:null,isValidSignature:Mi,isValidMessageSignature:Ri,isValidTypedDataSignature:Di,recoverWalletConfig:qi,isWalletUpToDate:Ui},[ge])),_a=Object.freeze({__proto__:null,abi:pa,api:ga,auth:va,config:wa,guard:ya,indexer:ma,metadata:ka,multicall:ba,network:xa,provider:Ca,relayer:Ea,transactions:Ia,utils:Sa,initWallet:fa,getWallet:da,Wallet:ca})}}]);
//# sourceMappingURL=25.95c9b2cd.chunk.js.map